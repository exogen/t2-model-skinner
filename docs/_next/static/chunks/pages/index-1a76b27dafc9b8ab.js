(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(1374)}])},1374:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return tY}});var r=i(5893),n=i(9008),o=i.n(n),a=i(7294);let s=a.createContext(null);s.displayName="CanvasContext";var l=function(t){var e;let i=(0,a.useContext)(s);if(!i)throw Error("No CanvasContext.Provider");return void 0===t?i:null==t?{}:null!==(e=i.canvases[t])&&void 0!==e?e:{}};let c=a.createContext(null);function h(){let t=(0,a.useContext)(c);if(!t)throw Error("No ToolsContext.Provider");return t}c.displayName="ToolsContext";var u=i(5237),f=i(6863),d=i(9352),g=i(9583),p=i(6653),v=i(2585),m=i(1649),y=i(3990);function b(){var t;let e=(0,a.useRef)(null),i=(0,a.useRef)(null),n=(0,a.useRef)(null),{activeCanvas:o,backgroundColor:s,setBackgroundColor:c,selectedObjects:b,lockedObjects:_,lockSelection:x,unlockSelection:C,bringForward:w,sendBackward:S,duplicate:T,deleteSelection:O,undo:j,redo:k,canUndo:P,canRedo:F,brushColor:E,setBrushColor:D,brushSize:M,setBrushSize:A,hueRotate:L,setHueRotate:I,saturation:R,setSaturation:B,brightness:X,setBrightness:Y,layerMode:z,setLayerMode:W,activeCanvasType:H,addImages:U,exportSkin:N}=h(),{canvas:V,isDrawingMode:G,setDrawingMode:q}=l(o),[K,J]=(0,a.useState)(!1),Z=K?"⌘":"Ctrl ",[$,Q]=(0,a.useState)(null),[tt,te]=(0,a.useState)(null),[ti,tr]=(0,a.useState)(null),[tn,to]=(0,a.useState)(!1),[ta,ts]=(0,a.useState)(!1),{styles:tl,attributes:tc}=(0,u.D)($,tt,{modifiers:[{name:"arrow",options:{element:ti}},{name:"offset",options:{offset:[0,10]}}]}),th=!!b.length&&b.every(t=>_.has(t)),tu=t=>{c(t.target.value)};return(0,a.useEffect)(()=>{navigator.platform&&navigator.platform.startsWith("Mac")?J(!0):navigator.userAgent.match(/\(Macintosh;/)&&J(!0)},[]),(0,a.useEffect)(()=>{tt&&tt.focus()},[tt]),(0,r.jsxs)("div",{className:"CanvasTools",children:[(0,r.jsxs)("div",{className:"CanvasBackgroundColor",children:[(0,r.jsx)("input",{className:"ColorSwatch",type:"radio",name:"backgroundColor",id:"canvasBackgroundColorBlack",value:"black",checked:"black"===s,onChange:tu}),(0,r.jsx)("label",{htmlFor:"canvasBackgroundColorBlack",children:(0,r.jsx)("span",{className:"HiddenLabel",children:"Black"})}),(0,r.jsx)("input",{className:"ColorSwatch",type:"radio",name:"backgroundColor",id:"canvasBackgroundColorMagenta",value:"magenta",checked:"magenta"===s,onChange:tu}),(0,r.jsx)("label",{htmlFor:"canvasBackgroundColorMagenta",children:(0,r.jsx)("span",{className:"HiddenLabel",children:"Magenta"})}),(0,r.jsx)("input",{className:"ColorSwatch",type:"radio",name:"backgroundColor",id:"canvasBackgroundColorWhite",value:"white",checked:"white"===s,onChange:tu}),(0,r.jsx)("label",{htmlFor:"canvasBackgroundColorWhite",children:(0,r.jsx)("span",{className:"HiddenLabel",children:"White"})})]}),(0,r.jsxs)("div",{className:"Buttons",children:["color"===H?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{ref:i,async onChange(t){let e=await new Promise((e,i)=>{var r;let n=null===(r=t.target.files)||void 0===r?void 0:r[0];if(n){let o=new FileReader;o.addEventListener("load",t=>{var i;e(null===(i=t.target)||void 0===i?void 0:i.result)}),o.readAsDataURL(n)}else i(Error("No input file provided."))});U([e])},type:"file",accept:".png, image/png",hidden:!0}),(0,r.jsx)("button",{type:"button","aria-label":"Add Image",title:"Add Image",onClick(){i.current&&i.current.click()},children:(0,r.jsx)(y.yAv,{style:{fontSize:14}})}),(0,r.jsx)("button",{type:"button",ref:Q,"data-active":ta?"":void 0,"aria-label":"Filters",title:"Filters",onClick(){ts(t=>!t)},children:(0,r.jsx)(y.J76,{})}),ta?(0,r.jsxs)("div",{className:"BrushToolsPopup",ref:te,style:tl.popper,tabIndex:-1,onBlur(t){let e=t.relatedTarget,i=!e||!t.currentTarget.contains(e);i&&ts(!1)},...tc.popper,children:[(0,r.jsxs)("div",{className:"Fields",children:[(0,r.jsxs)("div",{className:"Field ApplyTo",children:[(0,r.jsx)("label",{children:"Layer:"}),(0,r.jsx)("ul",{children:b.length?(0,r.jsxs)("li",{children:[(0,r.jsx)("input",{type:"radio",name:"FilterLayer",value:"SelectedLayer",id:"FilterLayer-SelectedLayer",checked:"SelectedLayer"===z,onChange(){W("SelectedLayer")}}),(0,r.jsxs)("label",{htmlFor:"FilterLayer-SelectedLayer",children:["selected (",b.length.toLocaleString(),")"]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("input",{type:"radio",name:"FilterLayer",value:"BaseLayer",id:"FilterLayer-BaseLayer",checked:"BaseLayer"===z,onChange(){W("BaseLayer")}})," ",(0,r.jsx)("label",{htmlFor:"FilterLayer-BaseLayer",children:"base"})]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("input",{type:"radio",name:"FilterLayer",value:"AllLayers",id:"FilterLayer-AllLayers",checked:"AllLayers"===z,onChange(){W("AllLayers")}}),(0,r.jsxs)("label",{htmlFor:"FilterLayer-AllLayers",children:["all (",null!==(t=null==V?void 0:V._objects.length.toLocaleString())&&void 0!==t?t:0,")"]})]})]})})]}),(0,r.jsxs)("div",{className:"Field",children:[(0,r.jsxs)("label",{children:["Hue:"," ",(0,r.jsx)("strong",{children:null==L?"MULTIPLE VALUES":(0,r.jsxs)(r.Fragment,{children:[Math.round(180*L),"\xb0"]})})]}),(0,r.jsx)("div",{className:"SliderContainer",children:(0,r.jsx)(f.Z,{min:-180,max:180,startPoint:0,value:Math.round((null!=L?L:0)*180),onChange(t){Array.isArray(t)&&(t=t[0]),I(t/180)},trackStyle:{height:8,background:"#03fccf"},handleStyle:{width:20,height:20,marginTop:-6,borderColor:"#03fccf",background:"rgb(5, 69, 76)",opacity:1},railStyle:{height:8,border:"1px solid #555",background:"rgba(255, 255, 255, 0.3)"}})})]}),(0,r.jsxs)("div",{className:"Field",children:[(0,r.jsxs)("label",{children:["Saturation:"," ",(0,r.jsx)("strong",{children:null==R?"MULTIPLE VALUES":"".concat(Math.round(100*R+100),"%")})]}),(0,r.jsx)("div",{className:"SliderContainer",children:(0,r.jsx)(f.Z,{min:-100,max:100,startPoint:0,value:Math.round((null!=R?R:0)*100),onChange(t){Array.isArray(t)&&(t=t[0]),B(t/100)},trackStyle:{height:8,background:"#03fccf"},handleStyle:{width:20,height:20,marginTop:-6,borderColor:"#03fccf",background:"rgb(5, 69, 76)",opacity:1},railStyle:{height:8,border:"1px solid #555",background:"rgba(255, 255, 255, 0.3)"}})})]}),(0,r.jsxs)("div",{className:"Field",children:[(0,r.jsxs)("label",{children:["Brightness:"," ",(0,r.jsx)("strong",{children:null==X?"MULTIPLE VALUES":"".concat(Math.round(100*X+100),"%")})]}),(0,r.jsx)("div",{className:"SliderContainer",children:(0,r.jsx)(f.Z,{min:-100,max:100,startPoint:0,value:Math.round((null!=X?X:0)*100),onChange(t){Array.isArray(t)&&(t=t[0]),Y(t/100)},trackStyle:{height:8,background:"#03fccf"},handleStyle:{width:20,height:20,marginTop:-6,borderColor:"#03fccf",background:"rgb(5, 69, 76)",opacity:1},railStyle:{height:8,border:"1px solid #555",background:"rgba(255, 255, 255, 0.3)"}})})]})]}),(0,r.jsx)("div",{className:"PopupArrow",ref:tr,style:tl.arrow})]}):null,(0,r.jsx)("button",{type:"button","aria-label":th?"Unlock":"Lock",title:th?"Unlock (L)":"Lock (L)",onClick:th?C:x,"data-locked":th?"":void 0,children:th?(0,r.jsx)(g.D5B,{style:{fontSize:14}}):(0,r.jsx)(g.kUi,{style:{fontSize:14}})}),(0,r.jsx)("button",{type:"button","aria-label":"Bring Forward",title:"Bring Forward (F)",onClick:w,children:(0,r.jsx)(p.KhA,{style:{fontSize:22}})}),(0,r.jsx)("button",{type:"button","aria-label":"Send Backward",title:"Send Backward (B)",onClick:S,children:(0,r.jsx)(p.O9L,{style:{fontSize:22}})}),(0,r.jsx)("button",{type:"button","aria-label":"Duplicate",title:"Duplicate (D)",onClick:T,children:(0,r.jsx)(d.xvH,{})}),(0,r.jsx)("button",{type:"button","aria-label":"Delete",title:"Delete (Backspace)",onClick:O,disabled:th,children:(0,r.jsx)(g.AMf,{})}),(0,r.jsx)("button",{type:"button","aria-label":"Undo",title:"Undo (".concat(Z,"Z)"),onClick:j,disabled:!P,children:(0,r.jsx)(y.UIL,{})}),(0,r.jsx)("button",{type:"button","aria-label":"Redo",title:"Redo (".concat(K?"".concat("⇧").concat(Z,"Z)"):"".concat(Z," Y"),")"),onClick:k,disabled:!F,children:(0,r.jsx)(y.rks,{})})]}):null,"metallic"===H?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{type:"button","data-active":G?void 0:"","aria-label":"Select",title:"Select (S)",onClick(){q(!1)},children:(0,r.jsx)(v.Pvc,{})}),(0,r.jsx)("button",{type:"button",ref:Q,"data-active":G?"":void 0,"aria-label":"Paint",title:"Paint (P)",onClick(){q(!0),to(t=>!t)},children:(0,r.jsx)(m.VUP,{})}),tn?(0,r.jsxs)("div",{className:"BrushToolsPopup",ref:te,style:tl.popper,tabIndex:-1,onBlur(t){let e=t.relatedTarget,i=!e||!t.currentTarget.contains(e);i&&to(!1)},...tc.popper,children:[(0,r.jsxs)("div",{className:"Fields",children:[(0,r.jsxs)("div",{className:"Field",children:[(0,r.jsx)("label",{children:"Metallic Amount"}),(0,r.jsx)("div",{className:"SliderContainer",children:(0,r.jsx)(f.Z,{min:0,max:255,trackStyle:{display:"none"},value:E,onChange(t){Array.isArray(t)&&(t=t[0]),D(t)},handleStyle:{width:20,height:20,marginTop:-6,borderColor:"rgb(20, 105, 241)",background:"rgb(".concat(E,", ").concat(E,", ").concat(E,")"),opacity:1},railStyle:{height:8,border:"1px solid #555",background:"linear-gradient(to right, black 0%, white 100%)"}})})]}),(0,r.jsxs)("div",{className:"Field",children:[(0,r.jsx)("label",{children:"Brush Size"}),(0,r.jsx)("div",{className:"SliderContainer",children:(0,r.jsx)(f.Z,{min:1,max:50,trackStyle:{height:8,background:"#03fccf"},value:M,onChange(t){Array.isArray(t)&&(t=t[0]),A(t)},handleStyle:{width:20,height:20,marginTop:-6,borderColor:"#03fccf",background:"rgb(5, 69, 76)",opacity:1},railStyle:{height:8,border:"1px solid #555",background:"rgba(255, 255, 255, 0.3)"}})})]})]}),(0,r.jsx)("div",{className:"PopupArrow",ref:tr,style:tl.arrow})]}):null]}):null]}),(0,r.jsxs)("div",{className:"Export",children:[(0,r.jsx)("input",{ref:e,type:"text",name:"CustomSkinName",placeholder:"Skin Name",size:12}),(0,r.jsx)("button",{type:"button",onClick(){let t=e.current?e.current.value:"",i=n.current?n.current.value:".png";N({name:t,format:i})},children:"Export"}),(0,r.jsxs)("select",{ref:n,defaultValue:"vl2",children:[(0,r.jsx)("option",{value:"png",children:".png"}),(0,r.jsx)("option",{value:"vl2",children:".vl2"})]})]})]})}var _=i(1752),x=i.n(_),C=i(6287);let w=a.createContext(null);function S(){let t=(0,a.useContext)(w);if(!t)throw Error("No WarriorContext.Provider");return t}function T(t){return new Promise(e=>C.fabric.Image.fromURL(t,e,{crossOrigin:"anonymous"}))}w.displayName="WarriorContext";var O=i(4375);function j(){return new Worker(i.p+"static/chunks/imageProcessing.worker-ec557200a46215b3.worker.js")}function k(){let t=(0,a.useRef)(null),e=(0,a.useRef)(null),i=(0,a.useMemo)(()=>{let t=()=>e.current;return{async combineColorAndAlphaImageUrls(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];let n=await t();return null==n?void 0:n.combineColorAndAlphaImageUrls(...i)},async removeAlphaFromArrayBuffer(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];let n=await t();return null==n?void 0:n.removeAlphaFromArrayBuffer(...i)},async convertArrayBufferAlphaToGrayscale(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];let n=await t();return null==n?void 0:n.convertArrayBufferAlphaToGrayscale(...i)},async convertGrayscaleImageUrlToMetallicRoughness(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];let n=await t();return null==n?void 0:n.convertGrayscaleImageUrlToMetallicRoughness(...i)}}},[]);return(0,a.useEffect)(()=>{let i=new j,r=O.Ud(i);return t.current=i,e.current=r,()=>{r[O.Yy](),i.terminate()}},[]),i}function P(){return{canvasPadding:64,basePath:"/t2-model-skinner"}}async function F(t){let e=await fetch(t);if(e.ok){let i=await e.arrayBuffer();return i}throw Error("Failed to load image URL: ".concat(t))}i(7113),i(31);let{publicRuntimeConfig:E}=x()(),{materials:D}=E;function M(t){var e,n;let{children:o}=t,{actualModel:s,selectedModelType:h}=S(),[u,f]=(0,a.useState)(0),d=D[s],g=null!==(e=d[u])&&void 0!==e?e:null,p=(0,a.useMemo)(()=>null!==(n=g.size)&&void 0!==n?n:[512,512],[g]),v=!(0===g.metallicFactor&&1===g.roughnessFactor),[m,y]=(0,a.useState)("color");v||"metallic"!==m||y("color");let[b,_]=(0,a.useState)("magenta"),[x,w]=(0,a.useState)(()=>new Set),[O,j]=(0,a.useState)(200),[E,M]=(0,a.useState)(10),[A,L]=(0,a.useState)(()=>new Map),[I,R]=(0,a.useState)(()=>[]),B=g?"".concat(g.name,":").concat(m):null,X=g?"".concat(g.name,":metallic"):null,{canvases:Y}=l(),{canvas:z,notifyChange:W,undo:H,redo:U,canUndo:N,canRedo:V}=l(B),{canvas:G}=l(X),[q,K]=(0,a.useState)(!1),{combineColorAndAlphaImageUrls:J}=k(),{canvasPadding:Z}=P(),[$,Q]=(0,a.useState)(()=>[]),[tt,te]=(0,a.useState)("BaseLayer");I.length?"SelectedLayer"!==tt&&te("SelectedLayer"):"SelectedLayer"===tt&&te("BaseLayer");let ti=t=>{var e,i,r,n;let o=I;if("AllLayers"===tt?o=null!==(e=null==z?void 0:z._objects)&&void 0!==e?e:[]:"BaseLayer"===tt&&(o=null!==(i=null==z?void 0:z._objects.slice(0,1))&&void 0!==i?i:[]),!o.length)return 0;{let a=e=>null!==(n=(null!==(r=A.get(o[e]))&&void 0!==r?r:{})[t])&&void 0!==n?n:0,s=a(0);return o.slice(1).every((t,e)=>a(e+1)===s)?s:null}},tr=ti("HueRotation"),tn=ti("Saturation"),to=ti("Brightness"),ta=(0,a.useCallback)((t,e)=>{var i,r,n;let o=[],a=new Map(A),s=I;for(let l of("AllLayers"===tt?s=null!==(i=null==z?void 0:z._objects)&&void 0!==i?i:[]:"BaseLayer"===tt&&(s=null!==(r=null==z?void 0:z._objects.slice(0,1))&&void 0!==r?r:[]),s)){let c=null!==(n=A.get(l))&&void 0!==n?n:{},h={...c,[t]:e};a.set(l,h),o.push([l,h])}L(a),Q(o)},[z,tt,A,I]),ts=(0,a.useCallback)(t=>ta("HueRotation",t),[ta]),tl=(0,a.useCallback)(t=>ta("Saturation",t),[ta]),tc=(0,a.useCallback)(t=>ta("Brightness",t),[ta]);(0,a.useEffect)(()=>{if($.length){for(let[t,e]of $)if(t instanceof C.fabric.Image){for(let i in t.filters=[],e){var r;let n=null!==(r=e[i])&&void 0!==r?r:0;if(0!==n)switch(i){case"HueRotation":t.filters.push(new C.fabric.Image.filters.HueRotation({rotation:n}));break;case"Saturation":t.filters.push(new C.fabric.Image.filters.Saturation({saturation:n}));break;case"Brightness":t.filters.push(new C.fabric.Image.filters.Brightness({brightness:n}))}}t.applyFilters()}Q([]),W&&W()}},[$,W]);let th=(0,a.useCallback)(()=>{I.length&&w(t=>{let e=new Set(t);for(let i of I){var r;e.add(i),(r=i).lockMovementX=!0,r.lockMovementY=!0,r.lockScalingX=!0,r.lockScalingY=!0,r.lockRotation=!0}return e})},[I]),tu=(0,a.useCallback)(()=>{I.length&&w(t=>{let e=new Set(t);for(let i of I){var r;e.delete(i),(r=i).lockMovementX=!1,r.lockMovementY=!1,r.lockScalingX=!1,r.lockScalingY=!1,r.lockRotation=!1}return e})},[I]),tf=(0,a.useCallback)(async()=>{let t=z.getActiveObject();t&&(z.bringForward(t,!0),W())},[z,W]),td=(0,a.useCallback)(async()=>{let t=z.getActiveObject();if(t){if(z._objects[0]===t||z._objects[1]===t)return;z.sendBackwards(t,!0),W()}},[z,W]),tg=(0,a.useCallback)(async t=>{let e;for(let i of t){let r=await T(i);if(!r.width||!r.height)throw Error("Zero-height image");let n=r.width/p[0],o=r.height/p[1];if(n>1||o>1){let a;a=n>o?1/n:1/o,r.scaleX=a,r.scaleY=a}if("metallic"===m){r.filters||(r.filters=[]);let s=new C.fabric.Image.filters.Grayscale;r.filters.push(s),r.applyFilters()}K(!1),z.centerObject(r),z.add(r),e=r}e&&z.setActiveObject(e)},[z,m,p]),tp=(0,a.useCallback)(async()=>{let t=z.getActiveObject();if(t){var e,i;let r=await new Promise(e=>t.clone(e));r.set({top:(null!==(e=r.top)&&void 0!==e?e:0)+20,left:(null!==(i=r.left)&&void 0!==i?i:0)+20,evented:!0}),"activeSelection"===r.type&&(r.canvas=z,r.forEachObject(t=>{z.add(t)}),r.setCoords()),z.discardActiveObject(),z.add(r),z.setActiveObject(r)}},[z]),tv=(0,a.useCallback)(async()=>{let t=z.getActiveObjects();z.discardActiveObject(),z.remove(...t),z.requestRenderAll()},[z]),tm=(0,a.useCallback)(async t=>{let{format:e,name:r=""}=t,{savePngFile:n,saveZipFile:o,createZipFile:a}=await Promise.all([i.e(354),i.e(70)]).then(i.bind(i,8070));r=r.trim()||"MyCustomSkin";let l=await Promise.all(d.filter(t=>t&&!t.hidden&&!1!==t.selectable).map(async t=>{var e,i,n,o;let a,l;let c=null===(e=Y["".concat(t.name,":color")])||void 0===e?void 0:e.canvas,u=null===(i=Y["".concat(t.name,":metallic")])||void 0===i?void 0:i.canvas,f=null!==(n=t.size)&&void 0!==n?n:[512,512],d=c.toDataURL({top:Z,left:Z,width:f[0],height:f[1]});if(u){let g=u.toDataURL({top:Z,left:Z,width:f[0],height:f[1]});a=await J({colorImageUrl:d,metallicImageUrl:g})}else a=d;switch(h){case"player":l="".concat(r,".").concat(s,".png");break;case"weapon":case"vehicle":l=t?"".concat(null!==(o=t.file)&&void 0!==o?o:t.name,".png"):"weapon"===h?"weapon_".concat(s,".png"):"".concat(s,".png")}return{imageUrl:a,filename:l}}));switch(e){case"png":{let{imageUrl:c,filename:f}=l[u];n(c,f);break}case"vl2":{let g=await Promise.all(l.map(async t=>({data:await F(t.imageUrl),name:t.filename}))),p=a(g),v=s.replace(/(?:^([a-z])|_([a-z]))/g,(t,e,i)=>(e||i).toUpperCase()),m="";switch(h){case"player":m="zPlayerSkin-".concat(r,".vl2");break;case"weapon":m="zWeapon".concat(v,"-").concat(r,".vl2");break;case"vehicle":m="z".concat(v,"-").concat(r,".vl2")}await o(p,m)}}},[s,Z,Y,J,d,u,h]),ty=(0,a.useMemo)(()=>({activeCanvas:B,activeCanvasType:m,setActiveCanvasType:y,backgroundColor:b,setBackgroundColor:_,lockedObjects:x,setLockedObjects:w,brushColor:O,setBrushColor:j,brushSize:E,setBrushSize:M,hueRotate:tr,setHueRotate:ts,saturation:tn,setSaturation:tl,brightness:to,setBrightness:tc,layerMode:tt,setLayerMode:te,selectedObjects:I,lockSelection:th,unlockSelection:tu,bringForward:tf,sendBackward:td,addImages:tg,duplicate:tp,deleteSelection:tv,undo:H,redo:U,canUndo:N,canRedo:V,exportSkin:tm,isDrawingMode:q,setDrawingMode:K,selectedMaterialIndex:u,setSelectedMaterialIndex:f,textureSize:p,hasMetallic:v}),[B,m,b,x,O,E,tr,tn,to,tt,ts,tl,tc,I,th,tu,tf,td,tg,tp,tv,H,U,N,V,tm,q,u,p,v]);return(0,a.useEffect)(()=>{if(z){let t=()=>{R(z.getActiveObjects())};return z.on("selection:cleared",t),z.on("selection:updated",t),z.on("selection:created",t),t(),()=>{z.off("selection:cleared",t),z.off("selection:updated",t),z.off("selection:created",t)}}},[z]),(0,a.useEffect)(()=>{G&&(G.freeDrawingBrush.width=E)},[G,E]),(0,a.useEffect)(()=>{G&&(G.freeDrawingBrush.color="rgb(".concat(O,", ").concat(O,", ").concat(O,")"))},[G,O]),(0,r.jsx)(c.Provider,{value:ty,children:o})}function A(){let{backgroundColor:t,textureSize:e}=h(),{canvasPadding:i}=P();return e?(0,r.jsx)("div",{className:"CanvasBackdrop",style:{backgroundColor:t,top:i,width:e[0],height:e[1]}}):null}function L(t){let{children:e}=t,[i,n]=(0,a.useState)({}),o=(0,a.useCallback)((t,e)=>{n(i=>({...i,[t]:e}))},[]),l=(0,a.useCallback)(t=>{n(e=>{let{[t]:i,...r}=e;return r})},[]),c=(0,a.useMemo)(()=>({canvases:i,registerCanvas:o,unregisterCanvas:l}),[i,o,l]);return(0,r.jsx)(s.Provider,{value:c,children:e})}function I(t){let{children:e}=t,i=(0,a.useRef)(null),{activeCanvas:n,bringForward:o,sendBackward:s,duplicate:c,deleteSelection:u,addImages:f,undo:d,redo:g}=h(),{canvas:p,notifyChange:v,setDrawingMode:m}=l(n),y=async function(){let{top:t=0,left:e=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=p.getActiveObjects();for(let r of i){var n,o;r.top=(null!==(n=r.top)&&void 0!==n?n:0)+t,r.left=(null!==(o=r.left)&&void 0!==o?o:0)+e}v()};return(0,r.jsx)("div",{className:"CanvasInteractions",tabIndex:0,ref:i,async onDrop(t){t.preventDefault(),i.current&&i.current.focus();let{items:e}=t.dataTransfer,r=Array.from(e).filter(t=>"file"===t.kind&&t.type.match(/^image\//)),n=await Promise.all(r.map(async t=>{let e=t.getAsFile();if(!e)throw Error("Not a file.");let i=new FileReader,r=await new Promise((t,r)=>{i.onload=async e=>{e.target&&"string"==typeof e.target.result?t(e.target.result):r(Error("Failed to load image data."))},i.readAsDataURL(e)});return r}).filter(Boolean));await f(n)},async onKeyDown(t){let e=t.target;if("INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName){if(t.ctrlKey||t.metaKey)switch(t.key){case"z":if(t.altKey)return;if(t.shiftKey){t.preventDefault(),g();return}t.preventDefault(),d();return;case"y":if(t.altKey||t.shiftKey)return;t.preventDefault(),g();return}if(!t.altKey&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey)switch(t.key){case"Backspace":case"Delete":t.preventDefault(),await u();break;case"ArrowLeft":t.preventDefault(),await y({left:-1});break;case"ArrowRight":t.preventDefault(),await y({left:1});break;case"ArrowUp":t.preventDefault(),await y({top:-1});break;case"ArrowDown":t.preventDefault(),await y({top:1});break;case"d":t.preventDefault(),await c();break;case"f":t.preventDefault(),await o();break;case"b":t.preventDefault(),await s();break;case"p":"metallic"===n&&(t.preventDefault(),m(!0));break;case"s":"color"===n&&(t.preventDefault(),m(!1))}}},children:e})}function R(){let{activeCanvasType:t,setActiveCanvasType:e,hasMetallic:i}=h();return(0,r.jsxs)("div",{className:"CanvasToggle",children:[(0,r.jsx)("button",{type:"button","data-selected":"color"===t?"":void 0,onClick(){e("color")},children:"Color"}),i?(0,r.jsx)("button",{type:"button","data-selected":"metallic"===t?"":void 0,onClick(){e("metallic")},children:"Metallic"}):null]})}var B=i(8193);let{publicRuntimeConfig:X}=x()(),{defaultSkins:Y,customSkins:z,modelDefaults:W,materials:H}=X;function U(){var t,e,i;let{selectedModel:n,setSelectedModel:o,selectedModelType:s,setSelectedModelType:l,selectedSkin:c,setSelectedSkin:u,setSelectedSkinType:f,actualModel:d,setSelectedAnimation:g,setSkinImageUrls:p,setAnimationPaused:v}=S(),{selectedMaterialIndex:m,setSelectedMaterialIndex:y}=h(),b=H[d],_=b[m],x=(0,a.useRef)(null);return(0,r.jsxs)("div",{className:"Toolbar",children:[(0,r.jsxs)("div",{className:"Field",children:[(0,r.jsx)("label",{htmlFor:"ModelSelect",children:"Model"}),(0,r.jsxs)("select",{id:"ModelSelect",value:n,onChange(t){var e,i,r;let n=t.target.selectedOptions[0].parentNode,a=t.target.value,{modelType:s}=n.dataset;if(!s)throw Error("No data-model-type found");let h=(null===(e=Y[a])||void 0===e?void 0:e.includes(c))||(null===(i=z[a])||void 0===i?void 0:i.includes(c))||!1;g(null),v(!1),l(s),o(a),y(0),h||(u(null!==(r=W[a])&&void 0!==r?r:null),f("default"))},children:[(0,r.jsxs)("optgroup",{label:"Players","data-model-type":"player",children:[(0,r.jsx)("option",{value:"lmale",children:"Human Male • Light"}),(0,r.jsx)("option",{value:"mmale",children:"Human Male • Medium"}),(0,r.jsx)("option",{value:"hmale",children:"Human Male • Heavy"}),(0,r.jsx)("option",{value:"lfemale",children:"Human Female • Light"}),(0,r.jsx)("option",{value:"mfemale",children:"Human Female • Medium"}),(0,r.jsx)("option",{value:"hfemale",children:"Human Female • Heavy"}),(0,r.jsx)("option",{value:"lbioderm",children:"Bioderm • Light"}),(0,r.jsx)("option",{value:"mbioderm",children:"Bioderm • Medium"}),(0,r.jsx)("option",{value:"hbioderm",children:"Bioderm • Heavy"})]}),(0,r.jsxs)("optgroup",{label:"Weapons","data-model-type":"weapon",children:[(0,r.jsx)("option",{value:"disc",children:"Disc Launcher"}),(0,r.jsx)("option",{value:"chaingun",children:"Chaingun"}),(0,r.jsx)("option",{value:"grenade_launcher",children:"Grenade Launcher"}),(0,r.jsx)("option",{value:"sniper",children:"Laser Rifle"}),(0,r.jsx)("option",{value:"plasmathrower",children:"Plasma Cannon"}),(0,r.jsx)("option",{value:"energy",children:"Blaster"}),(0,r.jsx)("option",{value:"shocklance",children:"Shocklance"}),(0,r.jsx)("option",{value:"elf",children:"ELF Projector"}),(0,r.jsx)("option",{value:"missile",children:"Missile Launcher"}),(0,r.jsx)("option",{value:"mortar",children:"Mortar"}),(0,r.jsx)("option",{value:"repair",children:"Repair Pack"}),(0,r.jsx)("option",{value:"targeting",children:"Targeting Laser"})]}),(0,r.jsxs)("optgroup",{label:"Vehicles","data-model-type":"vehicle",children:[(0,r.jsx)("option",{value:"vehicle_grav_scout",children:"Wildcat Grav Cycle"}),(0,r.jsx)("option",{value:"vehicle_grav_tank",children:"Beowulf Assault Tank"}),(0,r.jsx)("option",{value:"vehicle_land_mpbbase",children:"Jericho Mobile Point Base"}),(0,r.jsx)("option",{value:"vehicle_air_scout",children:"Shrike Scout Fighter"}),(0,r.jsx)("option",{value:"vehicle_air_bomber",children:"Thundersword Bomber"}),(0,r.jsx)("option",{value:"vehicle_air_hapc",children:"HAVOC Gunship Transport"})]})]})]}),(0,r.jsxs)("div",{className:"Field",children:[(0,r.jsx)("label",{htmlFor:"SkinSelect",children:"Skin"}),(0,r.jsxs)("div",{className:"Buttons",children:[(0,r.jsxs)("select",{id:"SkinSelect",value:null!=c?c:"",async onChange(t){var e;let i=t.target.selectedOptions[0].parentNode,r=t.target.value&&null!==(e=i.dataset.skinType)&&void 0!==e?e:null;u(t.target.value||null),f(r)},children:[(0,r.jsx)("option",{value:"",children:"Select a skin…"}),"player"===s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("optgroup",{label:"Default Skins","data-skin-type":"default",children:null===(t=Y[d])||void 0===t?void 0:t.map(t=>(0,r.jsx)("option",{value:t,children:t},t))}),(0,r.jsx)("optgroup",{label:"Custom Skins","data-skin-type":"custom",children:null===(e=z[d])||void 0===e?void 0:e.map(t=>(0,r.jsx)("option",{value:t,children:t},t))})]}):null,"weapon"===s||"vehicle"===s?(0,r.jsxs)(r.Fragment,{children:[W[d]?(0,r.jsx)("optgroup",{label:"Default Skins","data-skin-type":"default",children:(0,r.jsx)("option",{value:W[d],children:"Default"})}):null,(null===(i=z[d])||void 0===i?void 0:i.length)?(0,r.jsx)("optgroup",{label:"Custom Skins","data-skin-type":"custom",children:z[d].map(t=>(0,r.jsx)("option",{value:t,children:t},t))}):null]}):null]}),(0,r.jsx)("button",{type:"button","aria-label":"Load Skin",title:"Load a Skin",onClick(){x.current&&x.current.click()},children:(0,r.jsx)(B.FjK,{style:{fontSize:18}})}),(0,r.jsx)("input",{ref:x,async onChange(t){var e;let i=await new Promise((e,i)=>{var r;let n=null===(r=t.target.files)||void 0===r?void 0:r[0];if(n){let o=new FileReader;o.addEventListener("load",t=>{var i;e(null===(i=t.target)||void 0===i?void 0:i.result)}),o.readAsDataURL(n)}else i(Error("No input file provided."))});u(null),p({[null!==(e=_.file)&&void 0!==e?e:_.name]:i})},type:"file",accept:".png, image/png",hidden:!0})]})]})]})}let{publicRuntimeConfig:N}=x()(),{materials:V,modelDefaults:G}=N,q="https://exogen.github.io/t2-skins/skins";function K(t){let{basePath:e,actualModel:i,selectedModelType:r,selectedSkin:n,selectedSkinType:o}=t,a=V[i];switch(r){case"player":switch(o){case"default":return{base:"".concat(e,"/textures/").concat(n,".").concat(i,".png")};case"custom":return{base:"".concat(q,"/").concat(n,".").concat(i,".png")}}break;case"weapon":case"vehicle":return a.reduce((t,i)=>{if(i){var r,a,s,l;switch(o){case"default":!1!==i.hasDefault&&(t[null!==(r=i.file)&&void 0!==r?r:i.name]="".concat(e,"/textures/").concat(null!==(a=i.file)&&void 0!==a?a:i.name,".png"));break;case"custom":t[null!==(s=i.file)&&void 0!==s?s:i.name]="".concat(q,"/").concat(n,"/").concat(null!==(l=i.file)&&void 0!==l?l:i.name,".png")}}return t},{})}return{}}function J(t){let{children:e}=t,[i,n]=(0,a.useState)("lmale"),[o,s]=(0,a.useState)("player"),[l,c]=(0,a.useState)("Blood Eagle"),[h,u]=(0,a.useState)("default"),[f,d]=(0,a.useState)(null),[g,p]=(0,a.useState)(!1),{basePath:v}=P(),m="hfemale"===i?"hmale":i,y="".concat(v,"/").concat(m).concat(f?".anim":"",".glb"),[b,_]=(0,a.useState)(()=>K({basePath:v,actualModel:m,selectedModelType:o,selectedSkin:l,selectedSkinType:h})),x=(0,a.useMemo)(()=>K({basePath:v,actualModel:m,selectedModelType:o,selectedSkin:G[m],selectedSkinType:"default"}),[m,v,o]),C=(0,a.useMemo)(()=>({selectedModel:i,setSelectedModel:n,selectedModelType:o,setSelectedModelType:s,actualModel:m,selectedModelUrl:y,animationPaused:g,setAnimationPaused:p,selectedSkin:l,setSelectedSkin:c,selectedSkinType:h,setSelectedSkinType:u,selectedAnimation:f,setSelectedAnimation:d,skinImageUrls:b,setSkinImageUrls:_,defaultSkinImageUrls:x}),[i,n,o,s,m,y,g,p,l,c,h,u,f,d,b,_,x]);return(0,a.useEffect)(()=>{l&&_(K({basePath:v,actualModel:m,selectedModelType:o,selectedSkin:l,selectedSkinType:h}))},[v,m,o,l,h]),(0,r.jsx)(w.Provider,{value:C,children:e})}var Z=i(5152),$=i.n(Z);let Q=a.createContext(null);function tt(){let t=(0,a.useContext)(Q);if(!t)throw Error("No EnvironmentContext.Provider");return t}Q.displayName="EnvironmentContext";let te=a.createContext(null);function ti(){let t=(0,a.useContext)(te);if(!t)throw Error("No SkinContext.Provider");return t}te.displayName="SkinContext";var tr=i(8496);function tn(t){let{material:e,materialDef:i,textureType:r,imageUrl:n}=t,{modelViewer:o}=(0,tr.Z)(),{basePath:s}=P();(0,a.useEffect)(()=>{let t=!1,a=async()=>{if(!i||i.hidden)"metallicRoughnessTexture"!==r&&(e.setAlphaMode("BLEND"),e.pbrMetallicRoughness.setBaseColorFactor([0,0,0,0]));else{let{alphaMode:a,alphaCutoff:l,baseColorFactor:c,emissiveFactor:h,emissiveTexture:u=!1,metallicFactor:f=1,roughnessFactor:d=1}=i,g=null!=n?n:"".concat(s,"/white.png");switch(r){case"baseColorTexture":c&&e.pbrMetallicRoughness.setBaseColorFactor(c),a&&e.setAlphaMode(a),l&&e.setAlphaCutoff(l),h&&e.setEmissiveFactor(h);break;case"metallicRoughnessTexture":e.pbrMetallicRoughness.setMetallicFactor(f),e.pbrMetallicRoughness.setRoughnessFactor(d),0===f&&1===d&&(g="".concat(s,"/green.png"))}let p=await o.createTexture(g);!t&&(e.pbrMetallicRoughness[r].setTexture(p),"baseColorTexture"===r&&u&&e.emissiveTexture.setTexture(p))}};return a(),()=>{t=!0}},[s,o,e,i,r,n])}function to(t){var e,i;let{material:r,materialDef:n}=t,{getSkinImages:o}=ti(),{colorImageUrl:a,metallicImageUrl:s}=null!==(i=o(null!==(e=null==n?void 0:n.file)&&void 0!==e?e:r.name))&&void 0!==i?i:{};return tn({material:r,materialDef:n,textureType:"baseColorTexture",imageUrl:a}),tn({material:r,materialDef:n,textureType:"metallicRoughnessTexture",imageUrl:s}),null}let{publicRuntimeConfig:ta}=x()(),{materials:ts}=ta;function tl(){let{actualModel:t}=S(),{model:e}=(0,tr.Z)(),i=ts[t];return(0,r.jsx)(r.Fragment,{children:e.materials.map((t,e)=>{var n;let o=null!==(n=i.find(t=>t.index===e))&&void 0!==n?n:i[e];return(0,r.jsx)(to,{material:t,materialDef:o},t.name)})})}let tc=$()(()=>Promise.all([i.e(737),i.e(258),i.e(990)]).then(i.bind(i,85)),{loadableGenerated:{webpack:()=>[85]},ssr:!1}),{publicRuntimeConfig:th}=x()(),{cameraOverrides:tu}=th;function tf(){var t,e;let{selectedModel:i,selectedModelUrl:n,selectedModelType:o,selectedAnimation:a,animationPaused:s}=S(),{environmentImageUrl:l,showEnvironment:c,exposure:h}=tt();return(0,r.jsx)(tc,{modelUrl:n,environmentImageUrl:l,showEnvironment:c,animationName:a,animationPaused:s,cameraOrbit:"weapon"===o?"315deg 70deg 105%":void 0,cameraTarget:null===(t=tu[i])||void 0===t?void 0:t.target,fieldOfView:null===(e=tu[i])||void 0===e?void 0:e.fov,exposure:h,children:(0,r.jsx)(tl,{})})}function td(){let{selectedEnvironment:t,setSelectedEnvironment:e}=tt();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("label",{htmlFor:"EnvMapSelect",children:"Environment"}),(0,r.jsxs)("select",{id:"EnvMapSelect",value:null!=t?t:"",onChange(t){e(t.target.value||null)},children:[(0,r.jsx)("option",{value:"",children:"Default"}),(0,r.jsx)("option",{value:"clarens_night_02_1k.hdr",children:"Clarens Night"}),(0,r.jsx)("option",{value:"dry_cracked_lake_1k.hdr",children:"Dry Cracked Lake"}),(0,r.jsx)("option",{value:"fouriesburg_mountain_midday_1k.hdr",children:"Fouriesburg Mountain"}),(0,r.jsx)("option",{value:"goegap_1k.hdr",children:"Goegap"}),(0,r.jsx)("option",{value:"hilly_terrain_01_1k.hdr",children:"Hilly Terrain"}),(0,r.jsx)("option",{value:"kloofendal_48d_partly_cloudy_puresky_1k.hdr",children:"Kloofendal Partly Cloudy"}),(0,r.jsx)("option",{value:"kloppenheim_06_puresky_1k.hdr",children:"Kloppenheim"}),(0,r.jsx)("option",{value:"lilienstein_1k.hdr",children:"Lilienstein"}),(0,r.jsx)("option",{value:"spruit_sunrise_1k_HDR.hdr",children:"Spruit Sunrise"}),(0,r.jsx)("option",{value:"umhlanga_sunrise_1k.hdr",children:"Umhlanga Sunrise"})]})]})}function tg(){let{exposure:t,setExposure:e}=tt();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("label",{htmlFor:"EnvExposure",children:(0,r.jsx)(y.MXq,{size:16})}),(0,r.jsx)("input",{"aria-label":"Exposure",id:"EnvExposure",type:"range",min:.2,max:2.2,step:.1,value:t,onChange(t){e(parseFloat(t.target.value))}})]})}let{publicRuntimeConfig:tp}=x()(),{animations:tv,animationLabels:tm,animationLabelOverrides:ty}=tp;function tb(){var t;let{actualModel:e,selectedModelType:i,selectedAnimation:n,setSelectedAnimation:o,animationPaused:s,setAnimationPaused:l}=S(),c=(0,a.useMemo)(()=>[..."player"===i?tv.global:[],...null!==(t=tv[e])&&void 0!==t?t:[]],[e,i]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("label",{children:"Animation"}),(0,r.jsxs)("div",{className:"Buttons",children:[(0,r.jsxs)("select",{value:null!=n?n:"",onChange(t){o(t.target.value||null),l(!1)},children:[(0,r.jsx)("option",{value:"",children:"None"}),c.map(t=>{var i,n;let o=null!==(n=null===(i=ty[e])||void 0===i?void 0:i[t])&&void 0!==n?n:tm[t];return(0,r.jsx)("option",{value:t,children:null!=o?o:t},t)})]}),(0,r.jsx)("button",{type:"button",disabled:!n,onClick(){l(t=>!t)},children:s||!n?(0,r.jsx)(m.v$e,{}):(0,r.jsx)(m.IWN,{})})]})]})}function t_(t){let{children:e}=t,[i,n]=(0,a.useState)(null),[o,s]=(0,a.useState)(!1),[l,c]=(0,a.useState)(1),{basePath:h}=P(),u=(0,a.useMemo)(()=>{let t=i?"".concat(h,"/").concat(i):null;return{selectedEnvironment:i,setSelectedEnvironment:n,showEnvironment:o,setShowEnvironment:s,exposure:l,setExposure:c,environmentImageUrl:t}},[h,i,o,l]);return(0,r.jsx)(Q.Provider,{value:u,children:e})}function tx(t){let{children:e}=t,[i,n]=(0,a.useState)({}),o=(0,a.useMemo)(()=>({setSkinImages(t,e){n(i=>({...i,[t]:e}))},setColorImageUrl(t,e){n(i=>({...i,[t]:{...i[t],colorImageUrl:e}}))},setMetallicImageUrl(t,e){n(i=>({...i,[t]:{...i[t],metallicImageUrl:e}}))}}),[]),s=(0,a.useMemo)(()=>({materialSkins:i,getSkinImages:t=>i[t],getColorImageUrl:t=>i[t].colorImageUrl,getMetallicImageUrl:t=>i[t].metallicImageUrl,...o}),[i,o]);return(0,r.jsx)(te.Provider,{value:s,children:e})}let{publicRuntimeConfig:tC}=x()(),{materials:tw}=tC;function tS(){var t;let{actualModel:e}=S(),{selectedMaterialIndex:i,setSelectedMaterialIndex:n}=h(),o=tw[e];return(0,r.jsx)("select",{value:i,onChange(t){n(parseInt(t.target.value,10))},children:o.map((e,i)=>e&&!e.hidden&&!1!==e.selectable?(0,r.jsx)("option",{value:i,children:null!==(t=e.label)&&void 0!==t?t:e.name},e.name):null)})}function tT(t){let{canvasId:e,onChange:i,baseImageUrl:n,textureSize:o,defaultDrawingMode:s=!1}=t,c=(0,a.useRef)(null),[u,f]=(0,a.useState)(null),{activeCanvas:d}=h(),{canvasPadding:g}=P(),{registerCanvas:p,unregisterCanvas:v}=l(),[m,y]=(0,a.useState)(s),b=(0,a.useRef)(),_=(0,a.useRef)(!0),[x,w]=(0,a.useState)(()=>[]),[S,O]=(0,a.useState)(()=>[]),j=x.length>1,k=S.length>0,F=(0,a.useCallback)(t=>{let e=b.current;e&&e(t)},[]),E=(0,a.useCallback)(async()=>{if(u&&x.length>1){let[t,e]=x.slice(-2);_.current=!1,u.renderOnAddRemove=!1,u.clear(),u.loadFromJSON(t,()=>{u.renderAll(),_.current=!0,u.renderOnAddRemove=!0}),w(t=>t.slice(0,-1)),O(t=>[e,...t])}},[u,x]),D=(0,a.useCallback)(()=>{if(u&&S.length>0){let t=S[0];_.current=!1,u.renderOnAddRemove=!1,u.clear(),u.loadFromJSON(t,()=>{u.renderAll(),_.current=!0,u.renderOnAddRemove=!0}),w(e=>[...e,t]),O(t=>t.slice(1))}},[u,S]);(0,a.useEffect)(()=>{b.current=i},[i]);let M=d===e;return(0,a.useEffect)(()=>{let t;C.fabric.Object.prototype.set({transparentCorners:!1,borderColor:"#8afff1",cornerSize:9,cornerStyle:"circle",cornerColor:"#8afff1",cornerStrokeColor:"#1c9f7c",strokeWidth:10,perPixelTargetFind:!0});let e=new C.fabric.Canvas(c.current,{preserveObjectStacking:!0,targetFindTolerance:2}),i=!1,r=()=>{F(e)},n=()=>{!i&&_.current&&(clearTimeout(t),t=setTimeout(()=>{let t=o();w(e=>[...e.slice(-5),t]),O([])},150))},o=()=>{i=!0;let t=e.toJSON(["lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","selectable","hoverCursor","moveCursor"]);return i=!1,t};return e.on("object:modified",r),e.on("object:added",r),e.on("object:removed",r),e.on("after:render",n),f(e),()=>{clearTimeout(t),f(null),e.dispose()}},[F]),(0,a.useEffect)(()=>{u&&(u.isDrawingMode=m)},[u,m]),(0,a.useEffect)(()=>{u&&M&&u.calcOffset()},[u,M]),(0,a.useEffect)(()=>{if(u)return p(e,{canvas:u,notifyChange(){u.renderAll(),F(u)},undo:E,redo:D,canUndo:j,canRedo:k,isDrawingMode:m,setDrawingMode:y}),()=>{v(e)}},[u,p,v,e,F,m,y,E,D,j,k]),(0,a.useEffect)(()=>{if(u&&o&&(_.current=!1,u.clear(),n)){let t=!1,e=async()=>{let e=await T(n);if(!t){if(!e.width||!e.height)throw Error("Zero-height image");e.selectable=!1,e.lockMovementX=!0,e.lockMovementY=!0,e.lockScalingX=!0,e.lockScalingY=!0,e.lockRotation=!0,e.hoverCursor="default",e.moveCursor="default";let[i,r]=o,a=e.width===i?1:i/e.width,s=e.height===r?1:r/e.height;(1!==a||1!==s)&&(e.scaleX=a,e.scaleY=s),u.centerObject(e),u.add(e)}_.current=!0,u.requestRenderAll()};return e(),()=>{t=!0}}},[u,n,o]),(0,r.jsx)("div",{className:"CanvasContainer","data-active":M?"true":"false",children:(0,r.jsx)("canvas",{width:o[0]+2*g,height:o[1]+2*g,ref:c})})}let tO=a.createContext(null);function tj(){let t=(0,a.useContext)(tO);if(!t)throw Error("ImageLoaderContext.Provider not found!");return t}tO.displayName="ImageLoaderContext";let tk=[512,512];function tP(t){var e,i,n;let{materialDef:o}=t,{skinImageUrls:s,defaultSkinImageUrls:l}=S(),c=s[null!==(e=o.file)&&void 0!==e?e:o.name],h=l[null!==(i=o.file)&&void 0!==i?i:o.name],{setColorImageUrl:u}=ti(),{canvasPadding:f}=P(),[d,g]=(0,a.useState)(null),{removeAlphaFromArrayBuffer:p}=k(),{loadImage:v}=tj(),m=(0,a.useMemo)(()=>null!==(n=o.size)&&void 0!==n?n:tk,[o]),y=(0,a.useCallback)(async t=>{var e;let i=t.toDataURL({top:f,left:f,width:m[0],height:m[1]});u(null!==(e=o.file)&&void 0!==e?e:o.name,i)},[m,f,u,o]);(0,a.useEffect)(()=>{if(c){let t=!1,e=async()=>{let e;try{e=await v(c)}catch(i){if(!1===o.hasDefault)return;e=await v(h)}let r=await p(e);t||g(r)};return e(),()=>{t=!0}}g(null)},[o,c,h,p,v]);let b="".concat(o.name,":color");return m?(0,r.jsx)(tT,{canvasId:b,canvasType:"color",onChange:y,baseImageUrl:d,textureSize:m},b):null}let tF=[512,512];function tE(t){var e,i,n;let{materialDef:o}=t,{skinImageUrls:s,defaultSkinImageUrls:l}=S(),c=s[null!==(e=o.file)&&void 0!==e?e:o.name],h=l[null!==(i=o.file)&&void 0!==i?i:o.name],{setMetallicImageUrl:u}=ti(),{canvasPadding:f}=P(),[d,g]=(0,a.useState)(null),p=(0,a.useRef)(0),{convertGrayscaleImageUrlToMetallicRoughness:v,convertArrayBufferAlphaToGrayscale:m}=k(),{loadImage:y}=tj(),b=(0,a.useMemo)(()=>null!==(n=o.size)&&void 0!==n?n:tF,[o]),_=(0,a.useCallback)(async t=>{let e;p.current+=1;let i=t.toDataURL({top:f,left:f,width:b[0],height:b[1]});try{e=await v(i)}finally{p.current-=1}if(0===p.current){var r;u(null!==(r=o.file)&&void 0!==r?r:o.name,e)}},[b,f,u,v,o]);(0,a.useEffect)(()=>{if(c){let t=!1,e=async()=>{let e;try{e=await y(c)}catch(i){if(!1===o.hasDefault)return;e=await y(h)}let r=await m(e);t||g(r)};return e(),()=>{t=!0}}g(null)},[o,c,h,b,m,y]);let x="".concat(o.name,":metallic");return b?(0,r.jsx)(tT,{canvasId:x,canvasType:"metallic",onChange:_,baseImageUrl:d,textureSize:b,defaultDrawingMode:!0},x):null}let{publicRuntimeConfig:tD}=x()(),{materials:tM}=tD;function tA(){let{actualModel:t}=S(),e=tM[t];return(0,r.jsx)(r.Fragment,{children:e.map(e=>{if(!e)return null;let i=!(0===e.metallicFactor&&1===e.roughnessFactor);return(0,r.jsxs)(a.Fragment,{children:[(0,r.jsx)(tP,{materialDef:e}),i?(0,r.jsx)(tE,{materialDef:e}):null]},"".concat(t,"-").concat(e.name))})})}var tL=i(5945);function tI(t){let{children:e}=t,i=(0,tL.NL)(),n=(0,a.useMemo)(()=>({async loadImage(t){if(t.startsWith("data:"))return F(t);{let e=await i.fetchQuery({queryKey:[t]});return e}}}),[i]);return(0,r.jsx)(tO.Provider,{value:n,children:e})}var tR=i(8709);async function tB(t){let{queryKey:e}=t,[i]=e;return F(i)}let tX=new tR.S({defaultOptions:{queries:{queryFn:tB,staleTime:1/0,cacheTime:6e4,refetchOnWindowFocus:!1,refetchOnReconnect:!1}}});function tY(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o(),{children:(0,r.jsx)("title",{children:"T2 Model Viewer & Skinner"})}),(0,r.jsx)(tL.aH,{client:tX,children:(0,r.jsx)("main",{children:(0,r.jsx)(tI,{children:(0,r.jsx)(J,{children:(0,r.jsx)(t_,{children:(0,r.jsxs)(tx,{children:[(0,r.jsxs)("div",{className:"Viewport",children:[(0,r.jsxs)("div",{className:"ModelTools",children:[(0,r.jsx)("div",{className:"Field",children:(0,r.jsx)(td,{})}),(0,r.jsx)("div",{className:"Field SliderField",children:(0,r.jsx)(tg,{})}),(0,r.jsx)("div",{className:"Field",children:(0,r.jsx)(tb,{})})]}),(0,r.jsx)(tf,{})]}),(0,r.jsx)(L,{children:(0,r.jsx)(M,{children:(0,r.jsxs)(I,{children:[(0,r.jsx)(U,{}),(0,r.jsxs)("div",{className:"CanvasViewport",children:[(0,r.jsxs)("div",{className:"CanvasSelector",children:[(0,r.jsx)(R,{}),(0,r.jsx)(tS,{})]}),(0,r.jsx)(A,{}),(0,r.jsx)(tA,{})]}),(0,r.jsx)(b,{})]})})})]})})})})})})]})}},8496:function(t,e,i){"use strict";i.d(e,{K:function(){return n},Z:function(){return o}});var r=i(7294);let n=r.createContext(null);function o(){let t=(0,r.useContext)(n);if(!t)throw Error("No ModelViewerContext.Provider");return t}n.displayName="ModelViewerContext"},6287:function(t,e,i){var r,n,o,a,s,l,c,h,u,f,d,g,p,v,m,y,b,_,x,C,w,S,T,O,j,k,P,F,E,D,M,A,L,I,R,B,X,Y,z,W,H,U,N,V,G,q,K,J,Z,$,Q,tt,te,ti,tr,tn,to,ta,ts,tl,tc,th,tu,tf,td,tg,tp,tv,tm,ty,tb,t_,tx,tC,tw,tS,tT,tO,tj,tk,tP,tF,tE,tD,tM,tA,tL,tI,tR,tB,tX,tY,tz,tW,tH,tU,tN,tV,tG,tq,tK,tJ,tZ,t$,tQ,t0,t1,t2,t5,t3,t4,t8,t6,t9,t7,et,ee,ei,er,en,eo,ea,es,el=i(1876).Buffer,ec=ec||{version:"5.2.1"};if(e.fabric=ec,"undefined"!=typeof document)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?ec.document=document:ec.document=document.implementation.createHTMLDocument(""),ec.window=window;else{var eh=new(i(6734)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;ec.document=eh.document,ec.jsdomImplForWrapper=i(6907).implForWrapper,ec.nodeCanvas=i(4866).Canvas,ec.window=eh,DOMParser=ec.window.DOMParser}function eu(t,e){var i=t.canvas,r=e.targetCanvas,n=r.getContext("2d");n.translate(0,r.height),n.scale(1,-1);var o=i.height-r.height;n.drawImage(i,0,o,r.width,r.height,0,0,r.width,r.height)}function ef(t,e){var i=e.targetCanvas.getContext("2d"),r=e.destinationWidth,n=e.destinationHeight,o=r*n*4,a=new Uint8Array(this.imageBuffer,0,o),s=new Uint8ClampedArray(this.imageBuffer,0,o);t.readPixels(0,0,r,n,t.RGBA,t.UNSIGNED_BYTE,a);var l=new ImageData(s,r,n);i.putImageData(l,0,0)}ec.isTouchSupported="ontouchstart"in ec.window||"ontouchstart"in ec.document||ec.window&&ec.window.navigator&&ec.window.navigator.maxTouchPoints>0,ec.isLikelyNode=void 0!==el&&!1,ec.DPI=96,ec.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",ec.commaWsp="(?:\\s+,?\\s*|,\\s*)",ec.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,ec.reNonWord=/[ \n\.,;!\?\-]/,ec.fontPaths={},ec.iMatrix=[1,0,0,1,0,0],ec.svgNS="http://www.w3.org/2000/svg",ec.perfLimitSizeTotal=2097152,ec.maxCacheSideLimit=4096,ec.minCacheSideLimit=256,ec.charWidthsCache={},ec.textureSize=2048,ec.disableStyleCopyPaste=!1,ec.enableGLFiltering=!0,ec.devicePixelRatio=ec.window.devicePixelRatio||ec.window.webkitDevicePixelRatio||ec.window.mozDevicePixelRatio||1,ec.browserShadowBlurConstant=1,ec.arcToSegmentsCache={},ec.boundsOfCurveCache={},ec.cachesBoundsOfCurve=!0,ec.forceGLPutImageData=!1,ec.initFilterBackend=function(){return ec.enableGLFiltering&&ec.isWebglSupported&&ec.isWebglSupported(ec.textureSize)?(console.log("max texture size: "+ec.maxTextureSize),new ec.WebglFilterBackend({tileSize:ec.textureSize})):ec.Canvas2dFilterBackend?new ec.Canvas2dFilterBackend:void 0},function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:ec.util.array.fill(i,!1)}}function e(t,e){var i=(function(){e.apply(this,arguments),this.off(t,i)}).bind(this);this.on(t,i)}ec.Observable={fire:function(t,e){if(!this.__eventListeners)return this;var i=this.__eventListeners[t];if(!i)return this;for(var r=0,n=i.length;r<n;r++)i[r]&&i[r].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this},on:function(t,e){if(this.__eventListeners||(this.__eventListeners={}),1==arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this},once:function(t,i){if(1==arguments.length)for(var r in t)e.call(this,r,t[r]);else e.call(this,t,i);return this},off:function(e,i){if(!this.__eventListeners)return this;if(0==arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1==arguments.length&&"object"==typeof arguments[0])for(var r in e)t.call(this,r,e[r]);else t.call(this,e,i);return this}}}(),ec.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(t,e,i){var r=this._objects;return i?r[e]=t:r.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t,e=this._objects,i=!1,r=0,n=arguments.length;r<n;r++)t=e.indexOf(arguments[r]),-1!==t&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[r]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),r=0,n=i.length;r<n;r++)t.call(e,i[r],r,i);return this},getObjects:function(t){return void 0===t?this._objects.concat():this._objects.filter(function(e){return e.type===t})},item:function(t){return this._objects[t]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(t,e){return this._objects.indexOf(t)>-1||!!e&&this._objects.some(function(e){return"function"==typeof e.contains&&e.contains(t,!0)})},complexity:function(){return this._objects.reduce(function(t,e){return t+(e.complexity?e.complexity():0)},0)}},ec.CommonMethods={_setOptions:function(t){for(var e in t)this.set(e,t[e])},_initGradient:function(t,e){!t||!t.colorStops||t instanceof ec.Gradient||this.set(e,new ec.Gradient(t))},_initPattern:function(t,e,i){!t||!t.source||t instanceof ec.Pattern?i&&i():this.set(e,new ec.Pattern(t,i))},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this},_set:function(t,e){this[t]=e},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},get:function(t){return this[t]}},m=Math.sqrt,y=Math.atan2,b=Math.pow,_=Math.PI/180,x=Math.PI/2,ec.util={cos:function(t){if(0===t)return 1;switch(t<0&&(t=-t),t/x){case 1:case 3:return 0;case 2:return -1}return Math.cos(t)},sin:function(t){if(0===t)return 0;var e=1;switch(t<0&&(e=-1),t/x){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(t)},removeFromArray:function(t,e){var i=t.indexOf(e);return -1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*_},radiansToDegrees:function(t){return t/_},rotatePoint:function(t,e,i){var r=new ec.Point(t.x-e.x,t.y-e.y),n=ec.util.rotateVector(r,i);return new ec.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=ec.util.sin(e),r=ec.util.cos(e);return{x:t.x*r-t.y*i,y:t.x*i+t.y*r}},createVector:function(t,e){return new ec.Point(e.x-t.x,e.y-t.y)},calcAngleBetweenVectors:function(t,e){return Math.acos((t.x*e.x+t.y*e.y)/(Math.hypot(t.x,t.y)*Math.hypot(e.x,e.y)))},getHatVector:function(t){return new ec.Point(t.x,t.y).multiply(1/Math.hypot(t.x,t.y))},getBisector:function(t,e,i){var r=ec.util.createVector(t,e),n=ec.util.createVector(t,i),o=ec.util.calcAngleBetweenVectors(r,n),a=ec.util.calcAngleBetweenVectors(ec.util.rotateVector(r,o),n);return{vector:ec.util.getHatVector(ec.util.rotateVector(r,o*(0===a?1:-1)/2)),angle:o}},projectStrokeOnPoints:function(t,e,i){var r=[],n=e.strokeWidth/2,o=e.strokeUniform?new ec.Point(1/e.scaleX,1/e.scaleY):new ec.Point(1,1),a=function(t){var e=n/Math.hypot(t.x,t.y);return new ec.Point(t.x*e*o.x,t.y*e*o.y)};return t.length<=1||t.forEach(function(s,l){var c,h,u=new ec.Point(s.x,s.y);0===l?(h=t[l+1],c=i?a(ec.util.createVector(h,u)).addEquals(u):t[t.length-1]):l===t.length-1?(c=t[l-1],h=i?a(ec.util.createVector(c,u)).addEquals(u):t[0]):(c=t[l-1],h=t[l+1]);var f,d,g=ec.util.getBisector(u,c,h),p=g.vector,v=g.angle;if("miter"===e.strokeLineJoin&&(f=-n/Math.sin(v/2),Math.hypot((d=new ec.Point(p.x*f*o.x,p.y*f*o.y)).x,d.y)/n<=e.strokeMiterLimit)){r.push(u.add(d)),r.push(u.subtract(d));return}f=-n*Math.SQRT2,d=new ec.Point(p.x*f*o.x,p.y*f*o.y),r.push(u.add(d)),r.push(u.subtract(d))}),r},transformPoint:function(t,e,i){return i?new ec.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new ec.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t,e){if(e)for(var i=0;i<t.length;i++)t[i]=ec.util.transformPoint(t[i],e);var r=[t[0].x,t[1].x,t[2].x,t[3].x],n=ec.util.array.min(r),o=ec.util.array.max(r),a=[t[0].y,t[1].y,t[2].y,t[3].y],s=ec.util.array.min(a),l=ec.util.array.max(a);return{left:n,top:s,width:o-n,height:l-s}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],r=ec.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-r.x,i[5]=-r.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),r=parseFloat(t);switch(e||(e=ec.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return r*ec.DPI/25.4;case"cm":return r*ec.DPI/2.54;case"in":return r*ec.DPI;case"pt":return r*ec.DPI/72;case"pc":return r*ec.DPI/72*12;case"em":return r*e;default:return r}},falseFunction:function(){return!1},getKlass:function(t,e){return t=ec.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),ec.util.resolveNamespace(e)[t]},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},resolveNamespace:function(t){if(!t)return ec;var i,r=t.split("."),n=r.length,o=e||ec.window;for(i=0;i<n;++i)o=o[r[i]];return o},loadImage:function(t,e,i,r){if(!t){e&&e.call(i,t);return}var n=ec.util.createImage(),o=function(){e&&e.call(i,n,!1),n=n.onload=n.onerror=null};n.onload=o,n.onerror=function(){ec.log("Error loading "+n.src),e&&e.call(i,null,!0),n=n.onload=n.onerror=null},0!==t.indexOf("data")&&null!=r&&(n.crossOrigin=r),"data:image/svg"===t.substring(0,14)&&(n.onload=null,ec.util.loadImageInDom(n,o)),n.src=t},loadImageInDom:function(t,e){var i=ec.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(t),ec.document.querySelector("body").appendChild(i),t.onload=function(){e(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(t,e,i,r){var n=[],o=0,a=(t=t||[]).length;function s(){++o===a&&e&&e(n.filter(function(t){return t}))}if(!a){e&&e(n);return}t.forEach(function(t,e){if(!t||!t.type){s();return}ec.util.getKlass(t.type,i).fromObject(t,function(i,o){o||(n[e]=i),r&&r(t,i,o),s()})})},enlivenObjectEnlivables:function(t,e,i){var r=ec.Object.ENLIVEN_PROPS.filter(function(e){return!!t[e]});ec.util.enlivenObjects(r.map(function(e){return t[e]}),function(t){var n={};r.forEach(function(i,r){n[i]=t[r],e&&(e[i]=t[r])}),i&&i(n)})},enlivenPatterns:function(t,e){function i(){++n===o&&e&&e(r)}var r=[],n=0,o=(t=t||[]).length;if(!o){e&&e(r);return}t.forEach(function(t,e){t&&t.source?new ec.Pattern(t,function(t){r[e]=t,i()}):(r[e]=t,i())})},groupSVGElements:function(t,e,i){var r;return t&&1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),r=new ec.Group(t,e),void 0!==i&&(r.sourcePath=i),r)},populateWithProperties:function(t,e,i){if(i&&Array.isArray(i))for(var r=0,n=i.length;r<n;r++)i[r]in t&&(e[i[r]]=t[i[r]])},createCanvasElement:function(){return ec.document.createElement("canvas")},copyCanvasElement:function(t){var e=ec.util.createCanvasElement();return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e},toDataURL:function(t,e,i){return t.toDataURL("image/"+e,i)},createImage:function(){return ec.document.createElement("img")},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var e=y(t[1],t[0]),i=b(t[0],2)+b(t[1],2),r=m(i),n=(t[0]*t[3]-t[2]*t[1])/r;return{angle:e/_,scaleX:r,scaleY:n,skewX:y(t[0]*t[2]+t[1]*t[3],i)/_,skewY:0,translateX:t[4],translateY:t[5]}},calcRotateMatrix:function(t){if(!t.angle)return ec.iMatrix.concat();var e=ec.util.degreesToRadians(t.angle),i=ec.util.cos(e),r=ec.util.sin(e);return[i,r,-r,i,0,0]},calcDimensionsMatrix:function(t){var e=void 0===t.scaleX?1:t.scaleX,i=void 0===t.scaleY?1:t.scaleY,r=[t.flipX?-e:e,0,0,t.flipY?-i:i,0,0],n=ec.util.multiplyTransformMatrices,o=ec.util.degreesToRadians;return t.skewX&&(r=n(r,[1,0,Math.tan(o(t.skewX)),1],!0)),t.skewY&&(r=n(r,[1,Math.tan(o(t.skewY)),0,1],!0)),r},composeMatrix:function(t){var e=[1,0,0,1,t.translateX||0,t.translateY||0],i=ec.util.multiplyTransformMatrices;return t.angle&&(e=i(e,ec.util.calcRotateMatrix(t))),(1!==t.scaleX||1!==t.scaleY||t.skewX||t.skewY||t.flipX||t.flipY)&&(e=i(e,ec.util.calcDimensionsMatrix(t))),e},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},saveObjectTransform:function(t){return{scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}},isTransparent:function(t,e,i,r){r>0&&(e>r?e-=r:e=0,i>r?i-=r:i=0);var n,o=!0,a=t.getImageData(e,i,2*r||1,2*r||1),s=a.data.length;for(n=3;n<s&&!1!=(o=a.data[n]<=0);n+=4);return a=null,o},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",r="Mid",n="Mid",o=t.split(" ");return o&&o.length&&("meet"!==(i=o.pop())&&"slice"!==i?(e=i,i="meet"):o.length&&(e=o.pop())),r="none"!==e?e.slice(1,4):"none",n="none"!==e?e.slice(5,8):"none",{meetOrSlice:i,alignX:r,alignY:n}},clearFabricFontCache:function(t){(t=(t||"").toLowerCase())?ec.charWidthsCache[t]&&delete ec.charWidthsCache[t]:ec.charWidthsCache={}},limitDimsByArea:function(t,e){var i=Math.sqrt(e*t);return{x:Math.floor(i),y:Math.floor(e/i)}},capValue:function(t,e,i){return Math.max(t,Math.min(e,i))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)},matrixToSVG:function(t){return"matrix("+t.map(function(t){return ec.util.toFixed(t,ec.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(t,e){var i=ec.util.invertTransform(e),r=ec.util.multiplyTransformMatrices(i,t.calcOwnMatrix());ec.util.applyTransformToObject(t,r)},addTransformToObject:function(t,e){ec.util.applyTransformToObject(t,ec.util.multiplyTransformMatrices(e,t.calcOwnMatrix()))},applyTransformToObject:function(t,e){var i=ec.util.qrDecompose(e),r=new ec.Point(i.translateX,i.translateY);t.flipX=!1,t.flipY=!1,t.set("scaleX",i.scaleX),t.set("scaleY",i.scaleY),t.skewX=i.skewX,t.skewY=i.skewY,t.angle=i.angle,t.setPositionByOrigin(r,"center","center")},sizeAfterTransform:function(t,e,i){var r=t/2,n=e/2,o=ec.util.calcDimensionsMatrix(i),a=ec.util.makeBoundingBoxFromPoints([{x:-r,y:-n},{x:r,y:-n},{x:-r,y:n},{x:r,y:n}],o);return{x:a.width,y:a.height}},mergeClipPaths:function(t,e){var i=t,r=e;i.inverted&&!r.inverted&&(i=e,r=t),ec.util.applyTransformToObject(r,ec.util.multiplyTransformMatrices(ec.util.invertTransform(i.calcTransformMatrix()),r.calcTransformMatrix()));var n=i.inverted&&r.inverted;return n&&(i.inverted=r.inverted=!1),new ec.Group([i],{clipPath:r,inverted:n})},hasStyleChanged:function(t,e,i){return i=i||!1,t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.deltaY!==e.deltaY||i&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough)},stylesToArray:function(t,e){for(var t=ec.util.object.clone(t,!0),i=e.split("\n"),r=-1,n={},o=[],a=0;a<i.length;a++){if(!t[a]){r+=i[a].length;continue}for(var s=0;s<i[a].length;s++){r++;var l=t[a][s];l&&(ec.util.hasStyleChanged(n,l,!0)?o.push({start:r,end:r+1,style:l}):o[o.length-1].end++),n=l||{}}}return o},stylesFromArray:function(t,e){if(!Array.isArray(t))return t;for(var i=e.split("\n"),r=-1,n=0,o={},a=0;a<i.length;a++)for(var s=0;s<i[a].length;s++)r++,t[n]&&t[n].start<=r&&r<t[n].end&&(o[a]=o[a]||{},o[a][s]=Object.assign({},t[n].style),r===t[n].end-1&&n++);return o}},function(){var t=Array.prototype.join,e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};function r(t,e,i,r){var n=Math.atan2(e,t),o=Math.atan2(r,i);return o>=n?o-n:2*Math.PI-(n-o)}function n(t,e,i,r){return Math.sqrt((i-t)*(i-t)+(r-e)*(r-e))}function o(t,e,i){var r,o,a={x:e,y:i},s=0;for(o=1;o<=100;o+=1)r=t(o/100),s+=n(a.x,a.y,r.x,r.y),a=r;return s}function a(t){for(var e,i,r,a,s=0,l=t.length,c=0,h=0,u=0,f=0,d=[],g=0;g<l;g++){switch(r={x:c,y:h,command:(e=t[g])[0]},e[0]){case"M":r.length=0,u=c=e[1],f=h=e[2];break;case"L":r.length=n(c,h,e[1],e[2]),c=e[1],h=e[2];break;case"C":i=function(t,e,i,r,n,o,a,s){return function(l){var c=l*l*l,h=3*l*l*(1-l),u=3*l*(1-l)*(1-l),f=(1-l)*(1-l)*(1-l);return{x:a*c+n*h+i*u+t*f,y:s*c+o*h+r*u+e*f}}}(c,h,e[1],e[2],e[3],e[4],e[5],e[6]),a=function(t,e,i,r,n,o,a,s){return function(l){var c=1-l;return Math.atan2(3*c*c*(r-e)+6*c*l*(o-r)+3*l*l*(s-o),3*c*c*(i-t)+6*c*l*(n-i)+3*l*l*(a-n))}}(c,h,e[1],e[2],e[3],e[4],e[5],e[6]),r.iterator=i,r.angleFinder=a,r.length=o(i,c,h),c=e[5],h=e[6];break;case"Q":i=function(t,e,i,r,n,o){return function(a){var s=a*a,l=2*a*(1-a),c=(1-a)*(1-a);return{x:n*s+i*l+t*c,y:o*s+r*l+e*c}}}(c,h,e[1],e[2],e[3],e[4]),a=function(t,e,i,r,n,o){return function(a){var s=1-a;return Math.atan2(2*s*(r-e)+2*a*(o-r),2*s*(i-t)+2*a*(n-i))}}(c,h,e[1],e[2],e[3],e[4]),r.iterator=i,r.angleFinder=a,r.length=o(i,c,h),c=e[3],h=e[4];break;case"Z":case"z":r.destX=u,r.destY=f,r.length=n(c,h,u,f),c=u,h=f}s+=r.length,d.push(r)}return d.push({length:s,x:c,y:h}),d}ec.util.joinPath=function(t){return t.map(function(t){return t.join(" ")}).join(" ")},ec.util.parsePath=function(t){var r,n,o,a,s,l=[],c=[],h=ec.rePathCommand,u="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",f="("+u+")"+ec.commaWsp,d="([01])"+ec.commaWsp+"?",g=RegExp(f+"?"+f+"?"+f+d+d+f+"?("+u+")","g");if(!t||!t.match)return l;s=t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var p,v=0,m=s.length;v<m;v++){a=(r=s[v]).slice(1).trim(),c.length=0;var y,b=r.charAt(0);if(p=[b],"a"===b.toLowerCase())for(;y=g.exec(a);)for(var _=1;_<y.length;_++)c.push(y[_]);else for(;o=h.exec(a);)c.push(o[0]);for(var _=0,x=c.length;_<x;_++)isNaN(n=parseFloat(c[_]))||p.push(n);var C=e[b.toLowerCase()],w=i[b]||b;if(p.length-1>C)for(var S=1,T=p.length;S<T;S+=C)l.push([b].concat(p.slice(S,S+C))),b=w;else l.push(p)}return l},ec.util.makePathSimpler=function(t){var e,i,n,o,a,s,l=0,c=0,h=t.length,u=0,f=0,d=[];for(i=0;i<h;++i){switch(n=!1,(e=t[i].slice(0))[0]){case"l":e[0]="L",e[1]+=l,e[2]+=c;case"L":l=e[1],c=e[2];break;case"h":e[1]+=l;case"H":e[0]="L",e[2]=c,l=e[1];break;case"v":e[1]+=c;case"V":e[0]="L",c=e[1],e[1]=l,e[2]=c;break;case"m":e[0]="M",e[1]+=l,e[2]+=c;case"M":l=e[1],c=e[2],u=e[1],f=e[2];break;case"c":e[0]="C",e[1]+=l,e[2]+=c,e[3]+=l,e[4]+=c,e[5]+=l,e[6]+=c;case"C":a=e[3],s=e[4],l=e[5],c=e[6];break;case"s":e[0]="S",e[1]+=l,e[2]+=c,e[3]+=l,e[4]+=c;case"S":"C"===o?(a=2*l-a,s=2*c-s):(a=l,s=c),l=e[3],c=e[4],e[0]="C",e[5]=e[3],e[6]=e[4],e[3]=e[1],e[4]=e[2],e[1]=a,e[2]=s,a=e[3],s=e[4];break;case"q":e[0]="Q",e[1]+=l,e[2]+=c,e[3]+=l,e[4]+=c;case"Q":a=e[1],s=e[2],l=e[3],c=e[4];break;case"t":e[0]="T",e[1]+=l,e[2]+=c;case"T":"Q"===o?(a=2*l-a,s=2*c-s):(a=l,s=c),e[0]="Q",l=e[1],c=e[2],e[1]=a,e[2]=s,e[3]=l,e[4]=c;break;case"a":e[0]="A",e[6]+=l,e[7]+=c;case"A":n=!0,d=d.concat(function(t,e,i){for(var n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=function(t,e,i,n,o,a,s){var l=Math.PI,c=s*l/180,h=ec.util.sin(c),u=ec.util.cos(c),f=0,d=0,g=-u*t*.5-h*e*.5,p=-u*e*.5+h*t*.5,v=(i=Math.abs(i))*i,m=(n=Math.abs(n))*n,y=p*p,b=g*g,_=v*m-v*y-m*b,x=0;if(_<0){var C=Math.sqrt(1-_/(v*m));i*=C,n*=C}else x=(o===a?-1:1)*Math.sqrt(_/(v*y+m*b));var w=x*i*p/n,S=-x*n*g/i,T=u*w-h*S+.5*t,O=h*w+u*S+.5*e,j=r(1,0,(g-w)/i,(p-S)/n),k=r((g-w)/i,(p-S)/n,(-g-w)/i,(-p-S)/n);0===a&&k>0?k-=2*l:1===a&&k<0&&(k+=2*l);for(var P=Math.ceil(Math.abs(k/l*2)),F=[],E=k/P,D=8/3*Math.sin(E/4)*Math.sin(E/4)/Math.sin(E/2),M=j+E,A=0;A<P;A++)F[A]=function(t,e,i,r,n,o,a,s,l,c,h){var u=ec.util.cos(t),f=ec.util.sin(t),d=ec.util.cos(e),g=ec.util.sin(e),p=i*n*d-r*o*g+a,v=r*n*d+i*o*g+s;return["C",c+l*(-i*n*f-r*o*u),h+l*(-r*n*f+i*o*u),p+l*(i*n*g+r*o*d),v+l*(r*n*g-i*o*d),p,v]}(j,M,u,h,i,n,T,O,D,f,d),f=F[A][5],d=F[A][6],j=M,M+=E;return F}(i[6]-t,i[7]-e,n,o,s,l,a),h=0,u=c.length;h<u;h++)c[h][1]+=t,c[h][2]+=e,c[h][3]+=t,c[h][4]+=e,c[h][5]+=t,c[h][6]+=e;return c}(l,c,e)),l=e[6],c=e[7];break;case"z":case"Z":l=u,c=f}n||d.push(e),o=e[0]}return d},ec.util.getSmoothPathFromPoints=function(t,e){var i,r=[],n=new ec.Point(t[0].x,t[0].y),o=new ec.Point(t[1].x,t[1].y),a=t.length,s=1,l=0,c=a>2;for(e=e||0,c&&(s=t[2].x<o.x?-1:t[2].x===o.x?0:1,l=t[2].y<o.y?-1:t[2].y===o.y?0:1),r.push(["M",n.x-s*e,n.y-l*e]),i=1;i<a;i++){if(!n.eq(o)){var h=n.midPointFrom(o);r.push(["Q",n.x,n.y,h.x,h.y])}n=t[i],i+1<t.length&&(o=t[i+1])}return c&&(s=n.x>t[i-2].x?1:n.x===t[i-2].x?0:-1,l=n.y>t[i-2].y?1:n.y===t[i-2].y?0:-1),r.push(["L",n.x+s*e,n.y+l*e]),r},ec.util.getPathSegmentsInfo=a,ec.util.getBoundsOfCurve=function(e,i,r,n,o,a,s,l){if(ec.cachesBoundsOfCurve&&(c=t.call(arguments),ec.boundsOfCurveCache[c]))return ec.boundsOfCurveCache[c];var c,h,u,f,d,g,p,v,m,y=Math.sqrt,b=Math.min,_=Math.max,x=Math.abs,C=[],w=[[],[]];u=6*e-12*r+6*o,h=-3*e+9*r-9*o+3*s,f=3*r-3*e;for(var S=0;S<2;++S){if(S>0&&(u=6*i-12*n+6*a,h=-3*i+9*n-9*a+3*l,f=3*n-3*i),1e-12>x(h)){if(1e-12>x(u))continue;0<(d=-f/u)&&d<1&&C.push(d);continue}!((v=u*u-4*f*h)<0)&&(0<(g=(-u+(m=y(v)))/(2*h))&&g<1&&C.push(g),0<(p=(-u-m)/(2*h))&&p<1&&C.push(p))}for(var T,O,j,k=C.length,P=k;k--;)T=(j=1-(d=C[k]))*j*j*e+3*j*j*d*r+3*j*d*d*o+d*d*d*s,w[0][k]=T,O=j*j*j*i+3*j*j*d*n+3*j*d*d*a+d*d*d*l,w[1][k]=O;w[0][P]=e,w[1][P]=i,w[0][P+1]=s,w[1][P+1]=l;var F=[{x:b.apply(null,w[0]),y:b.apply(null,w[1])},{x:_.apply(null,w[0]),y:_.apply(null,w[1])}];return ec.cachesBoundsOfCurve&&(ec.boundsOfCurveCache[c]=F),F},ec.util.getPointOnPath=function(t,e,i){i||(i=a(t));for(var r=0;e-i[r].length>0&&r<i.length-2;)e-=i[r].length,r++;var o,s=i[r],l=e/s.length,c=s.command,h=t[r];switch(c){case"M":return{x:s.x,y:s.y,angle:0};case"Z":case"z":return(o=new ec.Point(s.x,s.y).lerp(new ec.Point(s.destX,s.destY),l)).angle=Math.atan2(s.destY-s.y,s.destX-s.x),o;case"L":return(o=new ec.Point(s.x,s.y).lerp(new ec.Point(h[1],h[2]),l)).angle=Math.atan2(h[2]-s.y,h[1]-s.x),o;case"C":case"Q":return function(t,e){for(var i,r,o,a=0,s=0,l=t.iterator,c={x:t.x,y:t.y},h=.01,u=t.angleFinder;s<e&&h>1e-4;)i=l(a),o=a,(r=n(c.x,c.y,i.x,i.y))+s>e?(a-=h,h/=2):(c=i,a+=h,s+=r);return i.angle=u(o),i}(s,e)}},ec.util.transformPath=function(t,e,i){return i&&(e=ec.util.multiplyTransformMatrices(e,[1,0,0,1,-i.x,-i.y])),t.map(function(t){for(var i=t.slice(0),r={},n=1;n<t.length-1;n+=2)r.x=t[n],r.y=t[n+1],r=ec.util.transformPoint(r,e),i[n]=r.x,i[n+1]=r.y;return i})}}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var r=t.length-1,n=e?t[r][e]:t[r];if(e)for(;r--;)i(t[r][e],n)&&(n=t[r][e]);else for(;r--;)i(t[r],n)&&(n=t[r]);return n}}ec.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var r=t.call(arguments,2),n=[],o=0,a=e.length;o<a;o++)n[o]=r.length?e[o][i].apply(e[o],r):e[o][i].call(e[o]);return n},min:function(t,i){return e(t,i,function(t,e){return t<e})},max:function(t,i){return e(t,i,function(t,e){return t>=e})}}}(),function(){function t(e,i,r){if(r){if(!ec.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var n=0,o=i.length;n<o;n++)e[n]=t({},i[n],r)}else if(i&&"object"==typeof i)for(var a in i)"canvas"===a||"group"===a?e[a]=null:i.hasOwnProperty(a)&&(e[a]=t({},i[a],r));else e=i}else for(var a in i)e[a]=i[a];return e}ec.util.object={extend:t,clone:function(e,i){return t({},e,i)}},ec.util.object.extend(ec.util,ec.Observable)}(),ec.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var e,i=0,r=[];for(i=0;i<t.length;i++)!1!==(e=function(t,e){var i=t.charCodeAt(e);if(isNaN(i))return"";if(i<55296||i>57343)return t.charAt(e);if(55296<=i&&i<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";var r=t.charCodeAt(e+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var n=t.charCodeAt(e-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1}(t,i))&&r.push(e);return r}},function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),r=function(t,e,r){for(var n in e)n in t.prototype&&"function"==typeof t.prototype[n]&&(e[n]+"").indexOf("callSuper")>-1?t.prototype[n]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=r;var n=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return n}}(n):t.prototype[n]=e[n],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function n(){}function o(e){for(var i=null,r=this;r.constructor.superclass;){var n=r.constructor.superclass.prototype[e];if(r[e]!==n){i=n;break}r=r.constructor.superclass.prototype}return i?arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this):console.log("tried to callSuper "+e+", method not found in prototype chain",this)}ec.util.createClass=function(){var i=null,a=t.call(arguments,0);function s(){this.initialize.apply(this,arguments)}"function"==typeof a[0]&&(i=a.shift()),s.superclass=i,s.subclasses=[],i&&(n.prototype=i.prototype,s.prototype=new n,i.subclasses.push(s));for(var l=0,c=a.length;l<c;l++)r(s,a[l],i);return s.prototype.initialize||(s.prototype.initialize=e),s.prototype.constructor=s,s.prototype.callSuper=o,s}}(),C=!!ec.document.createElement("div").attachEvent,w=["touchstart","touchmove","touchend"],ec.util.addListener=function(t,e,i,r){t&&t.addEventListener(e,i,!C&&r)},ec.util.removeListener=function(t,e,i,r){t&&t.removeEventListener(e,i,!C&&r)},ec.util.getPointer=function(t){var e,i=t.target,r=ec.util.getScrollLeftTop(i),n=(e=t.changedTouches)&&e[0]?e[0]:t;return{x:n.clientX+r.left,y:n.clientY+r.top}},ec.util.isTouchEvent=function(t){return w.indexOf(t.type)>-1||"touch"===t.pointerType},T="string"==typeof(S=ec.document.createElement("div")).style.opacity,O="string"==typeof S.style.filter,j=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,k=function(t){return t},T?k=function(t,e){return t.style.opacity=e,t}:O&&(k=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),j.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(j,e)):i.filter+=" alpha(opacity="+100*e+")",t}),ec.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?k(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var r in e)if("opacity"===r)k(t,e[r]);else{var n="float"===r||"cssFloat"===r?void 0===i.styleFloat?"cssFloat":"styleFloat":r;i.setProperty(n,e[r])}return t},function(){var t,e,i,r,n=Array.prototype.slice,o=function(t){return n.call(t,0)};try{r=o(ec.document.childNodes) instanceof Array}catch(a){}function s(t,e){var i=ec.document.createElement(t);for(var r in e)"class"===r?i.className=e[r]:"for"===r?i.htmlFor=e[r]:i.setAttribute(r,e[r]);return i}function l(t){for(var e=0,i=0,r=ec.document.documentElement,n=ec.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===ec.document?(e=n.scrollLeft||r.scrollLeft||0,i=n.scrollTop||r.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:i}}r||(o=function(t){for(var e=Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),i=ec.document.defaultView&&ec.document.defaultView.getComputedStyle?function(t,e){var i=ec.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},e="userSelect"in(t=ec.document.documentElement.style)?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"",ec.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=ec.util.falseFunction),e?t.style[e]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},ec.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),e?t.style[e]="":"string"==typeof t.unselectable&&(t.unselectable=""),t},ec.util.setImageSmoothing=function(t,e){t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=e},ec.util.getById=function(t){return"string"==typeof t?ec.document.getElementById(t):t},ec.util.toArray=o,ec.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},ec.util.makeElement=s,ec.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=s(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},ec.util.getScrollLeftTop=l,ec.util.getElementOffset=function(t){var e,r,n=t&&t.ownerDocument,o={left:0,top:0},a={left:0,top:0},s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return a;for(var c in s)a[s[c]]+=parseInt(i(t,c),10)||0;return e=n.documentElement,void 0!==t.getBoundingClientRect&&(o=t.getBoundingClientRect()),r=l(t),{left:o.left+r.left-(e.clientLeft||0)+a.left,top:o.top+r.top-(e.clientTop||0)+a.top}},ec.util.getNodeCanvas=function(t){var e=ec.jsdomImplForWrapper(t);return e._canvas||e._image},ec.util.cleanUpJsdomNode=function(t){if(ec.isLikelyNode){var e=ec.jsdomImplForWrapper(t);e&&(e._image=null,e._canvas=null,e._currentSrc=null,e._attributes=null,e._classList=null)}}}(),function(){function t(){}ec.util.request=function(e,i){i||(i={});var r,n,o=i.method?i.method.toUpperCase():"GET",a=i.onComplete||function(){},s=new ec.window.XMLHttpRequest,l=i.body||i.parameters;return s.onreadystatechange=function(){4===s.readyState&&(a(s),s.onreadystatechange=t)},"GET"===o&&(l=null,"string"==typeof i.parameters)&&(r=e,n=i.parameters,e=r+(/\?/.test(r)?"&":"?")+n),s.open(o,e,!0),("POST"===o||"PUT"===o)&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(l),s}}(),ec.log=console.log,ec.warn=console.warn,function(){var t=ec.util.object.extend,e=ec.util.object.clone,i=[];function r(){return!1}function n(t,e,i,r){return-i*Math.cos(t/r*(Math.PI/2))+i+e}ec.util.object.extend(i,{cancelAll:function(){var t=this.splice(0);return t.forEach(function(t){t.cancel()}),t},cancelByCanvas:function(t){if(!t)return[];var e=this.filter(function(e){return"object"==typeof e.target&&e.target.canvas===t});return e.forEach(function(t){t.cancel()}),e},cancelByTarget:function(t){var e=this.findAnimationsByTarget(t);return e.forEach(function(t){t.cancel()}),e},findAnimationIndex:function(t){return this.indexOf(this.findAnimation(t))},findAnimation:function(t){return this.find(function(e){return e.cancel===t})},findAnimationsByTarget:function(t){return t?this.filter(function(e){return e.target===t}):[]}});var o=ec.window.requestAnimationFrame||ec.window.webkitRequestAnimationFrame||ec.window.mozRequestAnimationFrame||ec.window.oRequestAnimationFrame||ec.window.msRequestAnimationFrame||function(t){return ec.window.setTimeout(t,1e3/60)},a=ec.window.cancelAnimationFrame||ec.window.clearTimeout;function s(){return o.apply(ec.window,arguments)}ec.util.animate=function(i){i||(i={});var o,a=!1,l=function(){var t=ec.runningAnimations.indexOf(o);return t>-1&&ec.runningAnimations.splice(t,1)[0]};return o=t(e(i),{cancel:function(){return a=!0,l()},currentValue:"startValue"in i?i.startValue:0,completionRate:0,durationRate:0}),ec.runningAnimations.push(o),s(function(t){var e,c=t||+new Date,h=i.duration||500,u=c+h,f=i.onChange||r,d=i.abort||r,g=i.onComplete||r,p=i.easing||n,v="startValue"in i&&i.startValue.length>0,m="startValue"in i?i.startValue:0,y="endValue"in i?i.endValue:100,b=i.byValue||(v?m.map(function(t,e){return y[e]-m[e]}):y-m);i.onStart&&i.onStart(),function t(i){var r=(e=i||+new Date)>u?h:e-c,n=r/h,_=v?m.map(function(t,e){return p(r,m[e],b[e],h)}):p(r,m,b,h),x=v?Math.abs((_[0]-m[0])/b[0]):Math.abs((_-m)/b);if(o.currentValue=v?_.slice():_,o.completionRate=x,o.durationRate=n,!a){if(d(_,x,n)){l();return}if(e>u){o.currentValue=v?y.slice():y,o.completionRate=1,o.durationRate=1,f(v?y.slice():y,1,1),g(y,1,1),l();return}f(_,x,n),s(t)}}(c)}),o.cancel},ec.util.requestAnimFrame=s,ec.util.cancelAnimFrame=function(){return a.apply(ec.window,arguments)},ec.runningAnimations=i}(),function(){function t(t,e,i){return"rgba("+parseInt(t[0]+i*(e[0]-t[0]),10)+","+parseInt(t[1]+i*(e[1]-t[1]),10)+","+parseInt(t[2]+i*(e[2]-t[2]),10)+(","+(t&&e?parseFloat(t[3]+i*(e[3]-t[3])):1))+")"}ec.util.animateColor=function(e,i,r,n){var o=new ec.Color(e).getSource(),a=new ec.Color(i).getSource(),s=n.onComplete,l=n.onChange;return n=n||{},ec.util.animate(ec.util.object.extend(n,{duration:r||500,startValue:o,endValue:a,byValue:a,easing:function(e,i,r,o){return t(i,r,n.colorEasing?n.colorEasing(e,o):1-Math.cos(e/o*(Math.PI/2)))},onComplete:function(e,i,r){if(s)return s(t(a,a,0),i,r)},onChange:function(e,i,r){if(l){if(Array.isArray(e))return l(t(e,e,0),i,r);l(e,i,r)}}}))}}(),function(t){"use strict";var e=t.fabric||(t.fabric={});if(e.Point){e.warn("fabric.Point is already defined");return}function i(t,e){this.x=t,this.y=e}e.Point=i,i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}}}(e),function(t){"use strict";var e=t.fabric||(t.fabric={});if(e.Intersection){e.warn("fabric.Intersection is already defined");return}function i(t){this.status=t,this.points=[]}e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,r,n,o){var a,s=(o.x-n.x)*(t.y-n.y)-(o.y-n.y)*(t.x-n.x),l=(r.x-t.x)*(t.y-n.y)-(r.y-t.y)*(t.x-n.x),c=(o.y-n.y)*(r.x-t.x)-(o.x-n.x)*(r.y-t.y);if(0!==c){var h=s/c,u=l/c;0<=h&&h<=1&&0<=u&&u<=1?(a=new i("Intersection")).appendPoint(new e.Point(t.x+h*(r.x-t.x),t.y+h*(r.y-t.y))):a=new i}else a=new i(0===s||0===l?"Coincident":"Parallel");return a},e.Intersection.intersectLinePolygon=function(t,e,r){var n,o,a,s,l=new i,c=r.length;for(s=0;s<c;s++)n=r[s],o=r[(s+1)%c],a=i.intersectLineLine(t,e,n,o),l.appendPoints(a.points);return l.points.length>0&&(l.status="Intersection"),l},e.Intersection.intersectPolygonPolygon=function(t,e){var r,n=new i,o=t.length;for(r=0;r<o;r++){var a=t[r],s=t[(r+1)%o],l=i.intersectLinePolygon(a,s,e);n.appendPoints(l.points)}return n.points.length>0&&(n.status="Intersection"),n},e.Intersection.intersectPolygonRectangle=function(t,r,n){var o=r.min(n),a=r.max(n),s=new e.Point(a.x,o.y),l=new e.Point(o.x,a.y),c=i.intersectLinePolygon(o,s,t),h=i.intersectLinePolygon(s,a,t),u=i.intersectLinePolygon(a,l,t),f=i.intersectLinePolygon(l,o,t),d=new i;return d.appendPoints(c.points),d.appendPoints(h.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d}}(e),function(t){"use strict";var e=t.fabric||(t.fabric={});if(e.Color){e.warn("fabric.Color is already defined.");return}function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function r(t,e,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?t+(e-t)*6*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,r){t/=255,i/=255,r/=255;var n,o,a,s=e.util.array.max([t,i,r]),l=e.util.array.min([t,i,r]);if(a=(s+l)/2,s===l)n=o=0;else{var c=s-l;switch(o=a>.5?c/(2-s-l):c/(s+l),s){case t:n=(i-r)/c+(i<r?6:0);break;case i:n=(r-t)/c+2;break;case r:n=(t-i)/c+4}n/=6}return[Math.round(360*n),Math.round(100*o),Math.round(100*a)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,r=this.getSource();return t=1===(t=r[0].toString(16)).length?"0"+t:t,e=1===(e=r[1].toString(16)).length?"0"+e:e,i=1===(i=r[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},toHexa:function(){var t;return t=1===(t=(t=Math.round(255*this.getSource()[3])).toString(16)).length?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),r=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,r]),this},overlayWith:function(t){t instanceof i||(t=new i(t));var e,r=[],n=this.getAlpha(),o=this.getSource(),a=t.getSource();for(e=0;e<3;e++)r.push(Math.round(.5*o[e]+.5*a[e]));return r[3]=n,this.setSource(r),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var r=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),n=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),o=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(r,10),parseInt(n,10),parseInt(o,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var n,o,a,s=(parseFloat(e[1])%360+360)%360/360,l=parseFloat(e[2])/(/%$/.test(e[2])?100:1),c=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===l)n=o=a=c;else{var h=c<=.5?c*(l+1):c+l-c*l,u=2*c-h;n=r(u,h,s+1/3),o=r(u,h,s),a=r(u,h,s-1/3)}return[Math.round(255*n),Math.round(255*o),Math.round(255*a),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),r=3===e.length||4===e.length,n=8===e.length||4===e.length,o=r?e.charAt(0)+e.charAt(0):e.substring(0,2),a=r?e.charAt(1)+e.charAt(1):e.substring(2,4),s=r?e.charAt(2)+e.charAt(2):e.substring(4,6),l=n?r?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(o,16),parseInt(a,16),parseInt(s,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e}}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=["e","se","s","sw","w","nw","n","ne","e"],r=["ns","nesw","ew","nwse"],n={},o="left",a="right",s="bottom",l="center",c={top:s,bottom:"top",left:a,right:o,center:l},h=e.util.radiansToDegrees,u=Math.sign||function(t){return(t>0)-(t<0)||+t};function f(t,e){return Math.round((t.angle+h(Math.atan2(e.y,e.x))+360)%360/45)}function d(t,i){var r=i.transform.target,n=r.canvas,o=e.util.object.clone(i);o.target=r,n&&n.fire("object:"+t,o),r.fire(t,i)}function g(t,e){var i=e.canvas,r=t[i.uniScaleKey];return i.uniformScaling&&!r||!i.uniformScaling&&r}function p(t){return t.originX===l&&t.originY===l}function v(t,e,i){var r=t.lockScalingX,n=t.lockScalingY;return!!r&&!!n||!e&&(!!r||!!n)&&!!i||!!r&&"x"===e||!!n&&"y"===e}function m(t,e,i,r){return{e:t,transform:e,pointer:{x:i,y:r}}}function y(t){return function(e,i,r,n){var o=i.target,a=o.getCenterPoint(),s=o.translateToOriginPoint(a,i.originX,i.originY),l=t(e,i,r,n);return o.setPositionByOrigin(s,i.originX,i.originY),l}}function b(t,e){return function(i,r,n,o){var a=e(i,r,n,o);return a&&d(t,m(i,r,n,o)),a}}function _(t,i,r,n,o){var a=t.target,s=a.controls[t.corner],l=a.canvas.getZoom(),c=a.padding/l,h=a.toLocalPoint(new e.Point(n,o),i,r);return h.x>=c&&(h.x-=c),h.x<=-c&&(h.x+=c),h.y>=c&&(h.y-=c),h.y<=c&&(h.y+=c),h.x-=s.offsetX,h.y-=s.offsetY,h}function x(t){return t.flipX!==t.flipY}function C(t,e,i,r,n){if(0!==t[e]){var o=n/t._getTransformedDimensions()[r]*t[i];t.set(i,o)}}function w(t,e,i,r){var n,l=e.target,c=l._getTransformedDimensions(0,l.skewY),u=Math.abs(2*_(e,e.originX,e.originY,i,r).x)-c.x,f=l.skewX;u<2?n=0:(n=h(Math.atan2(u/l.scaleX,c.y/l.scaleY)),e.originX===o&&e.originY===s&&(n=-n),e.originX===a&&"top"===e.originY&&(n=-n),x(l)&&(n=-n));var d=f!==n;if(d){var g=l._getTransformedDimensions().y;l.set("skewX",n),C(l,"skewY","scaleY","y",g)}return d}function S(t,e,i,r){var n,l=e.target,c=l._getTransformedDimensions(l.skewX,0),u=Math.abs(2*_(e,e.originX,e.originY,i,r).y)-c.y,f=l.skewY;u<2?n=0:(n=h(Math.atan2(u/l.scaleY,c.x/l.scaleX)),e.originX===o&&e.originY===s&&(n=-n),e.originX===a&&"top"===e.originY&&(n=-n),x(l)&&(n=-n));var d=f!==n;if(d){var g=l._getTransformedDimensions().x;l.set("skewY",n),C(l,"skewX","scaleX","x",g)}return d}function T(t,e,i,r,n){n=n||{};var o,a,s,l,h,f,d=e.target,m=d.lockScalingX,y=d.lockScalingY,b=n.by,x=g(t,d),C=v(d,b,x),w=e.gestureScale;if(C)return!1;if(w)a=e.scaleX*w,s=e.scaleY*w;else{if(o=_(e,e.originX,e.originY,i,r),h="y"!==b?u(o.x):1,f="x"!==b?u(o.y):1,e.signX||(e.signX=h),e.signY||(e.signY=f),d.lockScalingFlip&&(e.signX!==h||e.signY!==f))return!1;if(l=d._getTransformedDimensions(),x&&!b){var S=Math.abs(o.x)+Math.abs(o.y),T=e.original,O=S/(Math.abs(l.x*T.scaleX/d.scaleX)+Math.abs(l.y*T.scaleY/d.scaleY));a=T.scaleX*O,s=T.scaleY*O}else a=Math.abs(o.x*d.scaleX/l.x),s=Math.abs(o.y*d.scaleY/l.y);p(e)&&(a*=2,s*=2),e.signX!==h&&"y"!==b&&(e.originX=c[e.originX],a*=-1,e.signX=h),e.signY!==f&&"x"!==b&&(e.originY=c[e.originY],s*=-1,e.signY=f)}var j=d.scaleX,k=d.scaleY;return b?("x"===b&&d.set("scaleX",a),"y"===b&&d.set("scaleY",s)):(m||d.set("scaleX",a),y||d.set("scaleY",s)),j!==d.scaleX||k!==d.scaleY}n.scaleCursorStyleHandler=function(t,e,r){var n=g(t,r),o="";return(0!==e.x&&0===e.y?o="x":0===e.x&&0!==e.y&&(o="y"),v(r,o,n))?"not-allowed":i[f(r,e)]+"-resize"},n.skewCursorStyleHandler=function(t,e,i){return 0!==e.x&&i.lockSkewingY||0!==e.y&&i.lockSkewingX?"not-allowed":r[f(i,e)%4]+"-resize"},n.scaleSkewCursorStyleHandler=function(t,e,i){return t[i.canvas.altActionKey]?n.skewCursorStyleHandler(t,e,i):n.scaleCursorStyleHandler(t,e,i)},n.rotationWithSnapping=b("rotating",y(function(t,e,i,r){var n=e.target,o=n.translateToOriginPoint(n.getCenterPoint(),e.originX,e.originY);if(n.lockRotation)return!1;var a=Math.atan2(e.ey-o.y,e.ex-o.x),s=h(Math.atan2(r-o.y,i-o.x)-a+e.theta),l=!0;if(n.snapAngle>0){var c=n.snapAngle,u=n.snapThreshold||c,f=Math.ceil(s/c)*c,d=Math.floor(s/c)*c;Math.abs(s-d)<u?s=d:Math.abs(s-f)<u&&(s=f)}return s<0&&(s=360+s),s%=360,l=n.angle!==s,n.angle=s,l})),n.scalingEqually=b("scaling",y(function(t,e,i,r){return T(t,e,i,r)})),n.scalingX=b("scaling",y(function(t,e,i,r){return T(t,e,i,r,{by:"x"})})),n.scalingY=b("scaling",y(function(t,e,i,r){return T(t,e,i,r,{by:"y"})})),n.scalingYOrSkewingX=function(t,e,i,r){return t[e.target.canvas.altActionKey]?n.skewHandlerX(t,e,i,r):n.scalingY(t,e,i,r)},n.scalingXOrSkewingY=function(t,e,i,r){return t[e.target.canvas.altActionKey]?n.skewHandlerY(t,e,i,r):n.scalingX(t,e,i,r)},n.changeWidth=b("resizing",y(function(t,e,i,r){var n=e.target,o=_(e,e.originX,e.originY,i,r),a=n.strokeWidth/(n.strokeUniform?n.scaleX:1),s=p(e)?2:1,l=n.width,c=Math.abs(o.x*s/n.scaleX)-a;return n.set("width",Math.max(c,0)),l!==c})),n.skewHandlerX=function(t,e,i,r){var n,s=e.target,c=s.skewX,h=e.originY;return!s.lockSkewingX&&(0===c?n=_(e,l,l,i,r).x>0?o:a:(c>0&&(n="top"===h?o:a),c<0&&(n="top"===h?a:o),x(s)&&(n=n===o?a:o)),e.originX=n,b("skewing",y(w))(t,e,i,r))},n.skewHandlerY=function(t,e,i,r){var n,a=e.target,c=a.skewY,h=e.originX;return!a.lockSkewingY&&(0===c?n=_(e,l,l,i,r).y>0?"top":s:(c>0&&(n=h===o?"top":s),c<0&&(n=h===o?s:"top"),x(a)&&(n="top"===n?s:"top")),e.originY=n,b("skewing",y(S))(t,e,i,r))},n.dragHandler=function(t,e,i,r){var n=e.target,o=i-e.offsetX,a=r-e.offsetY,s=!n.get("lockMovementX")&&n.left!==o,l=!n.get("lockMovementY")&&n.top!==a;return s&&n.set("left",o),l&&n.set("top",a),(s||l)&&d("moving",m(t,e,i,r)),s||l},n.scaleOrSkewActionName=function(t,e,i){var r=t[i.canvas.altActionKey];return 0===e.x?r?"skewX":"scaleY":0===e.y?r?"skewY":"scaleX":void 0},n.rotationStyleHandler=function(t,e,i){return i.lockRotation?"not-allowed":e.cursorStyle},n.fireEvent=d,n.wrapWithFixedAnchor=y,n.wrapWithFireEvent=b,n.getLocalPoint=_,e.controlsUtils=n}(e),E=(F=(P=e).fabric||(P.fabric={})).util.degreesToRadians,(D=F.controlsUtils).renderCircleControl=function(t,e,i,r,n){r=r||{};var o,a=this.sizeX||r.cornerSize||n.cornerSize,s=this.sizeY||r.cornerSize||n.cornerSize,l=void 0!==r.transparentCorners?r.transparentCorners:n.transparentCorners,c=!l&&(r.cornerStrokeColor||n.cornerStrokeColor),h=e,u=i;t.save(),t.fillStyle=r.cornerColor||n.cornerColor,t.strokeStyle=r.cornerStrokeColor||n.cornerStrokeColor,a>s?(o=a,t.scale(1,s/a),u=i*a/s):s>a?(o=s,t.scale(a/s,1),h=e*s/a):o=a,t.lineWidth=1,t.beginPath(),t.arc(h,u,o/2,0,2*Math.PI,!1),t[l?"stroke":"fill"](),c&&t.stroke(),t.restore()},D.renderSquareControl=function(t,e,i,r,n){r=r||{};var o=this.sizeX||r.cornerSize||n.cornerSize,a=this.sizeY||r.cornerSize||n.cornerSize,s=void 0!==r.transparentCorners?r.transparentCorners:n.transparentCorners,l=!s&&(r.cornerStrokeColor||n.cornerStrokeColor),c=o/2,h=a/2;t.save(),t.fillStyle=r.cornerColor||n.cornerColor,t.strokeStyle=r.cornerStrokeColor||n.cornerStrokeColor,t.lineWidth=1,t.translate(e,i),t.rotate(E(n.angle)),t[(s?"stroke":"fill")+"Rect"](-c,-h,o,a),l&&t.strokeRect(-c,-h,o,a),t.restore()},(A=(M=e).fabric||(M.fabric={})).Control=function(t){for(var e in t)this[e]=t[e]},A.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(t,e){return e.cursorStyle},getActionName:function(t,e){return e.actionName},getVisibility:function(t,e){var i=t._controlsVisibility;return i&&void 0!==i[e]?i[e]:this.visible},setVisibility:function(t){this.visible=t},positionHandler:function(t,e){return A.util.transformPoint({x:this.x*t.x+this.offsetX,y:this.y*t.y+this.offsetY},e)},calcCornerCoords:function(t,e,i,r,n){var o,a,s,l,c=n?this.touchSizeX:this.sizeX,h=n?this.touchSizeY:this.sizeY;if(c&&h&&c!==h){var u=Math.atan2(h,c),f=Math.sqrt(c*c+h*h)/2,d=u-A.util.degreesToRadians(t),g=Math.PI/2-u-A.util.degreesToRadians(t);o=f*A.util.cos(d),a=f*A.util.sin(d),s=f*A.util.cos(g),l=f*A.util.sin(g)}else{f=.7071067812*(c&&h?c:e);var d=A.util.degreesToRadians(45-t);o=s=f*A.util.cos(d),a=l=f*A.util.sin(d)}return{tl:{x:i-l,y:r-s},tr:{x:i+o,y:r-a},bl:{x:i-o,y:r+a},br:{x:i+l,y:r+s}}},render:function(t,e,i,r,n){"circle"===((r=r||{}).cornerStyle||n.cornerStyle)?A.controlsUtils.renderCircleControl.call(this,t,e,i,r,n):A.controlsUtils.renderSquareControl.call(this,t,e,i,r,n)}},function(){"use strict";if(ec.StaticCanvas){ec.warn("fabric.StaticCanvas is already defined.");return}var t=ec.util.object.extend,e=ec.util.getElementOffset,i=ec.util.removeFromArray,r=(ec.util.toFixed,ec.util.transformPoint),n=ec.util.invertTransform,o=ec.util.getNodeCanvas,a=ec.util.createCanvasElement,s=Error("Could not initialize `canvas` element");ec.StaticCanvas=ec.util.createClass(ec.CommonMethods,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:ec.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(t,e){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return ec.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,ec.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var t=ec.devicePixelRatio;this.__initRetinaScaling(t,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(t,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(t,e,i){e.setAttribute("width",this.width*t),e.setAttribute("height",this.height*t),i.scale(t,t)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},__setBgOverlayImage:function(t,e,i,r){return"string"==typeof e?ec.util.loadImage(e,function(e,n){if(e){var o=new ec.Image(e,r);this[t]=o,o.canvas=this}i&&i(e,n)},this,r&&r.crossOrigin):(r&&e.setOptions(r),this[t]=e,e&&(e.canvas=this),i&&i(e,!1)),this},__setBgOverlayColor:function(t,e,i){return this[t]=e,this._initGradient(e,t),this._initPattern(e,t,i),this},_createCanvasElement:function(){var t=a();if(!t||(t.style||(t.style={}),void 0===t.getContext))throw s;return t},_initOptions:function(t){var e=this.lowerCanvasEl;this._setOptions(t),this.width=this.width||parseInt(e.width,10)||0,this.height=this.height||parseInt(e.height,10)||0,this.lowerCanvasEl.style&&(e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){t&&t.getContext?this.lowerCanvasEl=t:this.lowerCanvasEl=ec.util.getById(t)||this._createCanvasElement(),ec.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var r in e=e||{},t)i=t[r],e.cssOnly||(this._setBackstoreDimension(r,t[r]),i+="px",this.hasLostContext=!0),e.backstoreOnly||this._setCssDimension(r,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),e.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i,r,n=this._activeObject,o=this.backgroundImage,a=this.overlayImage;for(i=0,this.viewportTransform=t,r=this._objects.length;i<r;i++)(e=this._objects[i]).group||e.setCoords(!0);return n&&n.setCoords(),o&&o.setCoords(!0),a&&a.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(t,e){var i=t,o=this.viewportTransform.slice(0);t=r(t,n(this.viewportTransform)),o[0]=e,o[3]=e;var a=r(t,o);return o[4]+=i.x-a.x,o[5]+=i.y-a.y,this.setViewportTransform(o)},setZoom:function(t){return this.zoomToPoint(new ec.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new ec.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=ec.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var t={},e=this.width,i=this.height,o=n(this.viewportTransform);return t.tl=r({x:0,y:0},o),t.br=r({x:e,y:i},o),t.tr=new ec.Point(t.br.x,t.tl.y),t.bl=new ec.Point(t.tl.x,t.br.y),this.vptCoords=t,t},cancelRequestedRender:function(){this.isRendering&&(ec.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(t,e){var i=this.viewportTransform,r=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(t),ec.util.setImageSmoothing(t,this.imageSmoothingEnabled),this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),r&&(r.canvas=this,r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t)),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render",{ctx:t})},drawClipPathOnCanvas:function(t){var e=this.viewportTransform,i=this.clipPath;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.globalCompositeOperation="destination-in",i.transform(t),t.scale(1/i.zoomX,1/i.zoomY),t.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),t.restore()},_renderObjects:function(t,e){var i,r;for(i=0,r=e.length;i<r;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"],r=this[e+"Image"],n=this.viewportTransform,o=this[e+"Vpt"];if(i||r){if(i){t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=i.toLive?i.toLive(t,this):i,o&&t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),t.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);var a=i.gradientTransform||i.patternTransform;a&&t.transform(a[0],a[1],a[2],a[3],a[4],a[5]),t.fill(),t.restore()}r&&(t.save(),o&&t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),r.render(t),t.restore())}},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new ec.Point(this.width/2,this.height/2)},centerObjectH:function(t){return this._centerObject(t,new ec.Point(this.getCenterPoint().x,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new ec.Point(t.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(t){var e=this.getCenterPoint();return this._centerObject(t,e)},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new ec.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new ec.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){return r(this.getCenterPoint(),n(this.viewportTransform))},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var r=this.clipPath,n={version:ec.version,objects:this._toObjects(e,i)};return r&&!r.excludeFromExport&&(n.clipPath=this._toObject(this.clipPath,e,i)),t(n,this.__serializeBgOverlay(e,i)),ec.util.populateWithProperties(this,n,i),n},_toObjects:function(t,e){return this._objects.filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){this.includeDefaultValues||(r=t.includeDefaultValues,t.includeDefaultValues=!1);var r,n=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=r),n},__serializeBgOverlay:function(t,e){var i={},r=this.backgroundImage,n=this.overlayImage,o=this.backgroundColor,a=this.overlayColor;return o&&o.toObject?o.excludeFromExport||(i.background=o.toObject(e)):o&&(i.background=o),a&&a.toObject?a.excludeFromExport||(i.overlay=a.toObject(e)):a&&(i.overlay=a),r&&!r.excludeFromExport&&(i.backgroundImage=this._toObject(r,t,e)),n&&!n.excludeFromExport&&(i.overlayImage=this._toObject(n,t,e)),i},sendToBack:function(t){if(!t)return this;var e,r,n,o=this._activeObject;if(t===o&&"activeSelection"===t.type)for(e=(n=o._objects).length;e--;)r=n[e],i(this._objects,r),this._objects.unshift(r);else i(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(t){if(!t)return this;var e,r,n,o=this._activeObject;if(t===o&&"activeSelection"===t.type)for(e=0,n=o._objects;e<n.length;e++)r=n[e],i(this._objects,r),this._objects.push(r);else i(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(t,e){if(!t)return this;var r,n,o,a,s,l=this._activeObject,c=0;if(t===l&&"activeSelection"===t.type)for(r=0,s=l._objects;r<s.length;r++)n=s[r],(o=this._objects.indexOf(n))>0+c&&(a=o-1,i(this._objects,n),this._objects.splice(a,0,n)),c++;else 0!==(o=this._objects.indexOf(t))&&(a=this._findNewLowerIndex(t,o,e),i(this._objects,t),this._objects.splice(a,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(t,e,i){var r,n;if(i){for(r=e,n=e-1;n>=0;--n)if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){r=n;break}}else r=e-1;return r},bringForward:function(t,e){if(!t)return this;var r,n,o,a,s,l=this._activeObject,c=0;if(t===l&&"activeSelection"===t.type)for(r=(s=l._objects).length;r--;)n=s[r],(o=this._objects.indexOf(n))<this._objects.length-1-c&&(a=o+1,i(this._objects,n),this._objects.splice(a,0,n)),c++;else(o=this._objects.indexOf(t))!==this._objects.length-1&&(a=this._findNewUpperIndex(t,o,e),i(this._objects,t),this._objects.splice(a,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(t,e,i){var r,n,o;if(i){for(r=e,n=e+1,o=this._objects.length;n<o;++n)if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){r=n;break}}else r=e+1;return r},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(ec.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),ec.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),ec.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),t(ec.StaticCanvas.prototype,ec.Observable),t(ec.StaticCanvas.prototype,ec.Collection),t(ec.StaticCanvas.prototype,ec.DataURLExporter),t(ec.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=a();if(!e||!e.getContext)return null;var i=e.getContext("2d");return i&&"setLineDash"===t?void 0!==i.setLineDash:null}}),ec.StaticCanvas.prototype.toJSON=ec.StaticCanvas.prototype.toObject,ec.isLikelyNode&&(ec.StaticCanvas.prototype.createPNGStream=function(){var t=o(this.lowerCanvasEl);return t&&t.createPNGStream()},ec.StaticCanvas.prototype.createJPEGStream=function(t){var e=o(this.lowerCanvasEl);return e&&e.createJPEGStream(t)})}(),ec.BaseBrush=ec.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(t){t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,t.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(t){var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var t=this.canvas,e=this.shadow,i=t.contextTop,r=t.getZoom();t&&t._isRetinaScaling()&&(r*=ec.devicePixelRatio),i.shadowColor=e.color,i.shadowBlur=e.blur*r,i.shadowOffsetX=e.offsetX*r,i.shadowOffsetY=e.offsetY*r}},needsFullRender:function(){return 1>new ec.Color(this.color).getAlpha()||!!this.shadow},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0},_isOutSideCanvas:function(t){return t.x<0||t.x>this.canvas.getWidth()||t.y<0||t.y>this.canvas.getHeight()}}),ec.PencilBrush=ec.util.createClass(ec.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(t){this.canvas=t,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(t,e,i){var r=e.midPointFrom(i);return t.quadraticCurveTo(e.x,e.y,r.x,r.y),r},onMouseDown:function(t,e){this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],this._prepareForDrawing(t),this._captureDrawingPath(t),this._render())},onMouseMove:function(t,e){if(this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],!(!0===this.limitedToCanvasSize&&this._isOutSideCanvas(t))&&this._captureDrawingPath(t)&&this._points.length>1)){if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var i=this._points,r=i.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,i[r-2],i[r-1],!0),n.stroke(),n.restore()}}},onMouseUp:function(t){return!this.canvas._isMainEvent(t.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(t){var e=new ec.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){return!(this._points.length>1&&t.eq(this._points[this._points.length-1]))&&(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(t),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(t){var e=new ec.Point(t.x,t.y);return this._addPoint(e)},_render:function(t){var e,i,r=this._points[0],n=this._points[1];if(t=t||this.canvas.contextTop,this._saveAndTransform(t),t.beginPath(),2===this._points.length&&r.x===n.x&&r.y===n.y){var o=this.width/1e3;r=new ec.Point(r.x,r.y),n=new ec.Point(n.x,n.y),r.x-=o,n.x+=o}for(t.moveTo(r.x,r.y),e=1,i=this._points.length;e<i;e++)this._drawSegment(t,r,n),r=this._points[e],n=this._points[e+1];t.lineTo(r.x,r.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=this.width/1e3;return ec.util.getSmoothPathFromPoints(t,e)},_isEmptySVGPath:function(t){return"M 0 0 Q 0 0 0 0 L 0 0"===ec.util.joinPath(t)},createPath:function(t){var e=new ec.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.shadow=new ec.Shadow(this.shadow)),e},decimatePoints:function(t,e){if(t.length<=2)return t;var i,r=Math.pow(e/this.canvas.getZoom(),2),n=t.length-1,o=t[0],a=[o];for(i=1;i<n-1;i++)Math.pow(o.x-t[i].x,2)+Math.pow(o.y-t[i].y,2)>=r&&a.push(o=t[i]);return a.push(t[n]),a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(t)){this.canvas.requestRenderAll();return}var e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:e}),this.canvas.add(e),this.canvas.requestRenderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e})}}),ec.CircleBrush=ec.util.createClass(ec.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;this._saveAndTransform(i),this.dot(i,e),i.restore()},dot:function(t,e){t.fillStyle=e.fill,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),t.closePath(),t.fill()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},_render:function(){var t,e,i=this.canvas.contextTop,r=this.points;for(this._saveAndTransform(i),t=0,e=r.length;t<e;t++)this.dot(i,r[t]);i.restore()},onMouseMove:function(t){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(t)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(t),this._render()):this.drawDot(t))},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var r=[];for(t=0,e=this.points.length;t<e;t++){var n=this.points[t],o=new ec.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(o.shadow=new ec.Shadow(this.shadow)),r.push(o)}var a=new ec.Group(r);a.canvas=this.canvas,this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){var e=new ec.Point(t.x,t.y),i=ec.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new ec.Color(this.color).setAlpha(ec.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=r,this.points.push(e),e}}),ec.SprayBrush=ec.util.createClass(ec.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseMove:function(t){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(t)||(this.addSprayChunk(t),this.render(this.sprayChunkPoints))},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,r=this.sprayChunks.length;i<r;i++)for(var n=this.sprayChunks[i],o=0,a=n.length;o<a;o++){var s=new ec.Rect({width:n[o].width,height:n[o].width,left:n[o].x+1,top:n[o].y+1,originX:"center",originY:"center",fill:this.color});e.push(s)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var l=new ec.Group(e);this.shadow&&l.set("shadow",new ec.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var e,i,r,n={};for(i=0,r=t.length;i<r;i++)n[e=t[i].left+""+t[i].top]||(n[e]=t[i]);var o=[];for(e in n)o.push(n[e]);return o},render:function(t){var e,i,r=this.canvas.contextTop;for(r.fillStyle=this.color,this._saveAndTransform(r),e=0,i=t.length;e<i;e++){var n=t[e];void 0!==n.opacity&&(r.globalAlpha=n.opacity),r.fillRect(n.x,n.y,n.width,n.width)}r.restore()},_render:function(){var t,e,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),t=0,e=this.sprayChunks.length;t<e;t++)this.render(this.sprayChunks[t]);i.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var e,i,r,n,o=this.width/2;for(n=0;n<this.density;n++){e=ec.util.getRandomInt(t.x-o,t.x+o),i=ec.util.getRandomInt(t.y-o,t.y+o),r=this.dotWidthVariance?ec.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var a=new ec.Point(e,i);a.width=r,this.randomOpacity&&(a.opacity=ec.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),ec.PatternBrush=ec.util.createClass(ec.PencilBrush,{getPatternSrc:function(){var t=ec.util.createCanvasElement(),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(t){return t.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(t){this.callSuper("_setBrushStyles",t),t.strokeStyle=this.getPattern(t)},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new ec.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=ec.util.getPointer,e=ec.util.degreesToRadians,i=ec.util.isTouchEvent;for(var r in ec.Canvas=ec.util.createClass(ec.StaticCanvas,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=ec.PencilBrush&&new ec.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e,i,r=this.getActiveObjects();if(r.length>0&&!this.preserveObjectStacking){e=[],i=[];for(var n=0,o=this._objects.length;n<o;n++)t=this._objects[n],-1===r.indexOf(t)?e.push(t):i.push(t);r.length>1&&(this._activeObject._objects=i),e.push.apply(e,i)}else e=this._objects;return e},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTopLayer:function(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.renderTopLayer(t),this.fire("after:render"),this},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),r=ec.util.invertTransform(i),n=this.restorePointerVpt(e);return ec.util.transformPoint(n,r)},isTargetTransparent:function(t,e,i){if(t.shouldCache()&&t._cacheCanvas&&t!==this._activeObject){var r=this._normalizePointer(t,{x:e,y:i}),n=Math.max(t.cacheTranslationX+r.x*t.zoomX,0),o=Math.max(t.cacheTranslationY+r.y*t.zoomY,0),a=ec.util.isTransparent(t._cacheContext,Math.round(n),Math.round(o),this.targetFindTolerance);return a}var s=this.contextCache,l=t.selectionBackgroundColor,c=this.viewportTransform;t.selectionBackgroundColor="",this.clearContext(s),s.save(),s.transform(c[0],c[1],c[2],c[3],c[4],c[5]),t.render(s),s.restore(),t.selectionBackgroundColor=l;var a=ec.util.isTransparent(s,e,i,this.targetFindTolerance);return a},_isSelectionKeyPressed:function(t){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(e){return!0===t[e]}):t[this.selectionKey]},_shouldClearSelection:function(t,e){var i=this.getActiveObjects(),r=this._activeObject;return!e||e&&r&&i.length>1&&-1===i.indexOf(e)&&r!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&r&&r!==e},_shouldCenterTransform:function(t,e,i){var r;if(t)return"scale"===e||"scaleX"===e||"scaleY"===e||"resizing"===e?r=this.centeredScaling||t.centeredScaling:"rotate"===e&&(r=this.centeredRotation||t.centeredRotation),r?!i:i},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":("mr"===e||"tr"===e||"br"===e)&&(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":("bl"===e||"mb"===e||"br"===e)&&(i.y="top"),i},_getActionFromCorner:function(t,e,i,r){if(!e||!t)return"drag";var n=r.controls[e];return n.getActionName(i,n,r)},_setupCurrentTransform:function(t,i,r){if(i){var n=this.getPointer(t),o=i.__corner,a=i.controls[o],s=r&&o?a.getActionHandler(t,i,a):ec.controlsUtils.dragHandler,l=this._getActionFromCorner(r,o,t,i),c=this._getOriginFromCorner(i,o),h=t[this.centeredKey],u={target:i,action:l,actionHandler:s,corner:o,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:c.x,originY:c.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,theta:e(i.angle),width:i.width*i.scaleX,shiftKey:t.shiftKey,altKey:h,original:ec.util.saveObjectTransform(i)};this._shouldCenterTransform(i,l,h)&&(u.originX="center",u.originY="center"),u.original.originX=c.x,u.original.originY=c.y,this._currentTransform=u,this._beforeTransform(t)}},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_drawSelection:function(t){var e=this._groupSelector,i=new ec.Point(e.ex,e.ey),r=ec.util.transformPoint(i,this.viewportTransform),n=new ec.Point(e.ex+e.left,e.ey+e.top),o=ec.util.transformPoint(n,this.viewportTransform),a=Math.min(r.x,o.x),s=Math.min(r.y,o.y),l=Math.max(r.x,o.x),c=Math.max(r.y,o.y),h=this.selectionLineWidth/2;this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(a,s,l-a,c-s)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,a+=h,s+=h,l-=h,c-=h,ec.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(a,s,l-a,c-s))},findTarget:function(t,e){if(!this.skipTargetFind){var r,n,o=this.getPointer(t,!0),a=this._activeObject,s=this.getActiveObjects(),l=i(t),c=s.length>1&&!e||1===s.length;if(this.targets=[],c&&a._findTargetCorner(o,l)||s.length>1&&!e&&a===this._searchPossibleTargets([a],o))return a;if(1===s.length&&a===this._searchPossibleTargets([a],o)){if(!this.preserveObjectStacking)return a;r=a,n=this.targets,this.targets=[]}var h=this._searchPossibleTargets(this._objects,o);return t[this.altSelectionKey]&&h&&r&&h!==r&&(h=r,this.targets=n),h}},_checkTarget:function(t,e,i){if(e&&e.visible&&e.evented&&e.containsPoint(t)&&(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing||!this.isTargetTransparent(e,i.x,i.y)))return!0},_searchPossibleTargets:function(t,e){for(var i,r,n=t.length;n--;){var o=t[n],a=o.group?this._normalizePointer(o.group,e):e;if(this._checkTarget(a,o,e)){(i=t[n]).subTargetCheck&&i instanceof ec.Group&&(r=this._searchPossibleTargets(i._objects,e))&&this.targets.push(r);break}}return i},restorePointerVpt:function(t){return ec.util.transformPoint(t,ec.util.invertTransform(this.viewportTransform))},getPointer:function(e,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var r,n=t(e),o=this.upperCanvasEl,a=o.getBoundingClientRect(),s=a.width||0,l=a.height||0;(!s||!l)&&("top"in a&&"bottom"in a&&(l=Math.abs(a.top-a.bottom)),"right"in a&&"left"in a&&(s=Math.abs(a.right-a.left))),this.calcOffset(),n.x=n.x-this._offset.left,n.y=n.y-this._offset.top,i||(n=this.restorePointerVpt(n));var c=this.getRetinaScaling();return 1!==c&&(n.x/=c,n.y/=c),r=0===s||0===l?{width:1,height:1}:{width:o.width/s,height:o.height/l},{x:n.x*r.width,y:n.y*r.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),e=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),ec.util.addClass(i,"upper-canvas "+t),this.wrapperEl.appendChild(i),this._copyCanvasStyle(e,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=ec.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),ec.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),ec.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.width||t.width,i=this.height||t.height;ec.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=e,t.height=i,ec.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var t=this._activeObject;return t?"activeSelection"===t.type&&t._objects?t._objects.slice(0):[t]:[]},_onObjectRemoved:function(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),t===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",t)},_fireSelectionEvents:function(t,e){var i=!1,r=this.getActiveObjects(),n=[],o=[];t.forEach(function(t){-1===r.indexOf(t)&&(i=!0,t.fire("deselected",{e:e,target:t}),o.push(t))}),r.forEach(function(r){-1===t.indexOf(r)&&(i=!0,r.fire("selected",{e:e,target:r}),n.push(r))}),t.length>0&&r.length>0?i&&this.fire("selection:updated",{e:e,selected:n,deselected:o}):r.length>0?this.fire("selection:created",{e:e,selected:n}):t.length>0&&this.fire("selection:cleared",{e:e,deselected:o})},setActiveObject:function(t,e){var i=this.getActiveObjects();return this._setActiveObject(t,e),this._fireSelectionEvents(i,e),this},_setActiveObject:function(t,e){return!(this._activeObject===t||!this._discardActiveObject(e,t)||t.onSelect({e:e}))&&(this._activeObject=t,!0)},_discardActiveObject:function(t,e){var i=this._activeObject;if(i){if(i.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var e=this.getActiveObjects(),i=this.getActiveObject();return e.length&&this.fire("before:selection:cleared",{target:i,e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this},dispose:function(){var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(t){ec.util.cleanUpJsdomNode(this[t]),this[t]=void 0}).bind(this)),t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,ec.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this._activeObject;e&&e._renderControls(t)},_toObject:function(t,e,i){var r=this._realizeGroupTransformOnObject(t),n=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,r),n},_realizeGroupTransformOnObject:function(t){if(!t.group||"activeSelection"!==t.group.type||this._activeObject!==t.group)return null;var e={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(i){e[i]=t[i]}),ec.util.addTransformToObject(t,this._activeObject.calcOwnMatrix()),e},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var r=this._realizeGroupTransformOnObject(e);this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,r)},setViewportTransform:function(t){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),ec.StaticCanvas.prototype.setViewportTransform.call(this,t)}}),ec.StaticCanvas)"prototype"!==r&&(ec.Canvas[r]=ec.StaticCanvas[r])}(),function(){var t=ec.util.addListener,e=ec.util.removeListener,i={passive:!1};function r(t,e){return t.button&&t.button===e-1}ec.util.object.extend(ec.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(t,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(t,e){var r=this.upperCanvasEl,n=this._getEventPrefix();t(ec.window,"resize",this._onResize),t(r,n+"down",this._onMouseDown),t(r,n+"move",this._onMouseMove,i),t(r,n+"out",this._onMouseOut),t(r,n+"enter",this._onMouseEnter),t(r,"wheel",this._onMouseWheel),t(r,"contextmenu",this._onContextMenu),t(r,"dblclick",this._onDoubleClick),t(r,"dragover",this._onDragOver),t(r,"dragenter",this._onDragEnter),t(r,"dragleave",this._onDragLeave),t(r,"drop",this._onDrop),this.enablePointerEvents||t(r,"touchstart",this._onTouchStart,i),"undefined"!=typeof eventjs&&e in eventjs&&(eventjs[e](r,"gesture",this._onGesture),eventjs[e](r,"drag",this._onDrag),eventjs[e](r,"orientation",this._onOrientationChange),eventjs[e](r,"shake",this._onShake),eventjs[e](r,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(e,"remove");var t=this._getEventPrefix();e(ec.document,t+"up",this._onMouseUp),e(ec.document,"touchend",this._onTouchEnd,i),e(ec.document,t+"move",this._onMouseMove,i),e(ec.document,"touchmove",this._onMouseMove,i)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t});var i=this;this._hoveredTargets.forEach(function(r){i.fire("mouse:out",{target:e,e:t}),r&&e.fire("mouseout",{e:t})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(t){t.isEditing&&t.hiddenTextarea.focus()})},_onMouseEnter:function(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onDragOver:function(t){t.preventDefault();var e=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(e,t)},_onDrop:function(t){return this._simpleEventHandler("drop:before",t),this._simpleEventHandler("drop",t)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},getPointerId:function(t){var e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1},_isMainEvent:function(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(r){r.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(r)),this.__onMouseDown(r),this._resetTransformEventData();var n=this.upperCanvasEl,o=this._getEventPrefix();t(ec.document,"touchend",this._onTouchEnd,i),t(ec.document,"touchmove",this._onMouseMove,i),e(n,o+"down",this._onMouseDown)},_onMouseDown:function(r){this.__onMouseDown(r),this._resetTransformEventData();var n=this.upperCanvasEl,o=this._getEventPrefix();e(n,o+"move",this._onMouseMove,i),t(ec.document,o+"up",this._onMouseUp),t(ec.document,o+"move",this._onMouseMove,i)},_onTouchEnd:function(r){if(!(r.touches.length>0)){this.__onMouseUp(r),this._resetTransformEventData(),this.mainTouchId=null;var n=this._getEventPrefix();e(ec.document,"touchend",this._onTouchEnd,i),e(ec.document,"touchmove",this._onMouseMove,i);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){t(o.upperCanvasEl,n+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(r){this.__onMouseUp(r),this._resetTransformEventData();var n=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(r)&&(e(ec.document,o+"up",this._onMouseUp),e(ec.document,o+"move",this._onMouseMove,i),t(n,o+"move",this._onMouseMove,i))},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t){var e=this._activeObject;return!!e!=!!t||!!e&&!!t&&e!==t||(e&&e.isEditing,!1)},__onMouseUp:function(t){var e,i,n,o=this._currentTransform,a=this._groupSelector,s=!1,l=!a||0===a.left&&0===a.top;if(this._cacheTransformEventData(t),n=this._target,this._handleEvent(t,"up:before"),r(t,3)){this.fireRightClick&&this._handleEvent(t,"up",3,l);return}if(r(t,2)){this.fireMiddleClick&&this._handleEvent(t,"up",2,l),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(t);return}if(this._isMainEvent(t)){if(o&&(this._finalizeCurrentTransform(t),s=o.actionPerformed),!l){var c=n===this._activeObject;this._maybeGroupObjects(t),s||(s=this._shouldRender(n)||!c&&n===this._activeObject)}if(n){if(e=n._findTargetCorner(this.getPointer(t,!0),ec.util.isTouchEvent(t)),n.selectable&&n!==this._activeObject&&"up"===n.activeOn)this.setActiveObject(n,t),s=!0;else{var h=n.controls[e],u=h&&h.getMouseUpHandler(t,n,h);u&&(i=this.getPointer(t),u(t,o,i.x,i.y))}n.isMoving=!1}if(o&&(o.target!==n||o.corner!==e)){var f=o.target&&o.target.controls[o.corner],d=f&&f.getMouseUpHandler(t,n,h);i=i||this.getPointer(t),d&&d(t,o,i.x,i.y)}this._setCursorFromEvent(t,n),this._handleEvent(t,"up",1,l),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=0),s?this.requestRenderAll():l||this.renderTop()}},_simpleEventHandler:function(t,e){var i=this.findTarget(e),r=this.targets,n={e:e,target:i,subTargets:r};if(this.fire(t,n),i&&i.fire(t,n),!r)return i;for(var o=0;o<r.length;o++)r[o].fire(t,n);return i},_handleEvent:function(t,e,i,r){var n=this._target,o=this.targets||[],a={e:t,target:n,subTargets:o,button:i||1,isClick:r||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===e&&(a.currentTarget=this.findTarget(t),a.currentSubTargets=this.targets),this.fire("mouse:"+e,a),n&&n.fire("mouse"+e,a);for(var s=0;s<o.length;s++)o[s].fire("mouse"+e,a)},_finalizeCurrentTransform:function(t){var e=this._currentTransform,i=e.target,r={e:t,target:i,transform:e,action:e.action};i._scaling&&(i._scaling=!1),i.setCoords(),(e.actionPerformed||this.stateful&&i.hasStateChanged())&&this._fire("modified",r)},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll();var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){var e=this.getPointer(t);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:t,pointer:e}),this._handleEvent(t,"up")},__onMouseDown:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var e=this._target;if(r(t,3)){this.fireRightClick&&this._handleEvent(t,"down",3);return}if(r(t,2)){this.fireMiddleClick&&this._handleEvent(t,"down",2);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(t);return}if(this._isMainEvent(t)&&!this._currentTransform){var i=this._pointer;this._previousPointer=i;var n=this._shouldRender(e),o=this._shouldGroup(t,e);if(this._shouldClearSelection(t,e)?this.discardActiveObject(t):o&&(this._handleGrouping(t,e),e=this._activeObject),!this.selection||e&&(e.selectable||e.isEditing||e===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),e){var a=e===this._activeObject;e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);var s=e._findTargetCorner(this.getPointer(t,!0),ec.util.isTouchEvent(t));if(e.__corner=s,e===this._activeObject&&(s||!o)){this._setupCurrentTransform(t,e,a);var l=e.controls[s],i=this.getPointer(t),c=l&&l.getMouseDownHandler(t,e,l);c&&c(t,this._currentTransform,i.x,i.y)}}this._handleEvent(t,"down"),(n||o)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform:function(t){var e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:t,transform:e})},__onMouseMove:function(t){if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode){this._onMouseMoveInDrawingMode(t);return}if(this._isMainEvent(t)){var e,i,r=this._groupSelector;r?(i=this._absolutePointer,r.left=i.x-r.ex,r.top=i.y-r.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t)||null,this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(t,e){var i=this._hoveredTarget,r=this._hoveredTargets,n=this.targets,o=Math.max(r.length,n.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:i,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var a=0;a<o;a++)this.fireSyntheticInOutEvents(n[a],e,{oldTarget:r[a],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(t,e){var i=this._draggedoverTarget,r=this._hoveredTargets,n=this.targets,o=Math.max(r.length,n.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:i,evtOut:"dragleave",evtIn:"dragenter"});for(var a=0;a<o;a++)this.fireSyntheticInOutEvents(n[a],e,{oldTarget:r[a],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=t},fireSyntheticInOutEvents:function(t,e,i){var r,n,o=i.oldTarget,a=o!==t,s=i.canvasEvtIn,l=i.canvasEvtOut;a&&(r={e:e,target:t,previousTarget:o},n={e:e,target:o,nextTarget:t}),o&&a&&(l&&this.fire(l,n),o.fire(i.evtOut,n)),t&&a&&(s&&this.fire(s,r),t.fire(i.evtIn,r))},__onMouseWheel:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.shiftKey=t.shiftKey,i.altKey=t[this.centeredKey],this._performTransformAction(t,i,e),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,e,i){var r=i.x,n=i.y,o=e.action,a=!1,s=e.actionHandler;s&&(a=s(t,e,r,n)),"drag"===o&&a&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a},_fire:ec.controlsUtils.fireEvent,_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor,r=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,n=(!r||!r.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));n?this.setCursor(this.getCornerCursor(n,e,t)):(e.subTargetCheck&&this.targets.concat().reverse().map(function(t){i=t.hoverCursor||i}),this.setCursor(i))},getCornerCursor:function(t,e,i){var r=e.controls[t];return r.cursorStyleHandler(i,r,e)}})}(),L=Math.min,I=Math.max,ec.util.object.extend(ec.Canvas.prototype,{_shouldGroup:function(t,e){var i=this._activeObject;return i&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(i!==e||"activeSelection"===i.type)&&!e.onSelect({e:t})},_handleGrouping:function(t,e){var i=this._activeObject;!i.__corner&&(e!==i||(e=this.findTarget(t,!0))&&e.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))},_updateActiveSelection:function(t,e){var i=this._activeObject,r=i._objects.slice(0);i.contains(t)?(i.removeWithUpdate(t),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat(),1===i.size()&&this._setActiveObject(i.item(0),e)):(i.addWithUpdate(t),this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(r,e)},_createActiveSelection:function(t,e){var i=this.getActiveObjects(),r=this._createGroup(t);this._hoveredTarget=r,this._setActiveObject(r,e),this._fireSelectionEvents(i,e)},_createGroup:function(t){var e=this._objects,i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new ec.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(t){var e,i=this._collectObjects(t);1===i.length?this.setActiveObject(i[0],t):i.length>1&&(e=new ec.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(e,t))},_collectObjects:function(t){for(var e,i=[],r=this._groupSelector.ex,n=this._groupSelector.ey,o=r+this._groupSelector.left,a=n+this._groupSelector.top,s=new ec.Point(L(r,o),L(n,a)),l=new ec.Point(I(r,o),I(n,a)),c=!this.selectionFullyContained,h=r===o&&n===a,u=this._objects.length;u--&&!((e=this._objects[u])&&e.selectable&&e.visible&&(c&&e.intersectsWithRect(s,l,!0)||e.isContainedWithinRect(s,l,!0)||c&&e.containsPoint(s,null,!0)||c&&e.containsPoint(l,null,!0))&&(i.push(e),h)););return i.length>1&&(i=i.filter(function(e){return!e.onSelect({e:t})})),i},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}}),ec.util.object.extend(ec.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,r=(t.multiplier||1)*(t.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(r,t);return ec.util.toDataURL(n,e,i)},toCanvasElement:function(t,e){t=t||1;var i=((e=e||{}).width||this.width)*t,r=(e.height||this.height)*t,n=this.getZoom(),o=this.width,a=this.height,s=n*t,l=this.viewportTransform,c=(l[4]-(e.left||0))*t,h=(l[5]-(e.top||0))*t,u=this.interactive,f=this.enableRetinaScaling,d=ec.util.createCanvasElement(),g=this.contextTop;return d.width=i,d.height=r,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=[s,0,0,s,c,h],this.width=i,this.height=r,this.calcViewportBoundaries(),this.renderCanvas(d.getContext("2d"),this._objects),this.viewportTransform=l,this.width=o,this.height=a,this.calcViewportBoundaries(),this.interactive=u,this.enableRetinaScaling=f,this.contextTop=g,d}}),ec.util.object.extend(ec.StaticCanvas.prototype,{loadFromJSON:function(t,e,i){if(t){var r="string"==typeof t?JSON.parse(t):ec.util.object.clone(t),n=this,o=r.clipPath,a=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete r.clipPath,this._enlivenObjects(r.objects,function(t){n.clear(),n._setBgOverlay(r,function(){o?n._enlivenObjects([o],function(i){n.clipPath=i[0],n.__setupCanvas.call(n,r,t,a,e)}):n.__setupCanvas.call(n,r,t,a,e)})},i),this}},__setupCanvas:function(t,e,i,r){var n=this;e.forEach(function(t,e){n.insertAt(t,e)}),this.renderOnAddRemove=i,delete t.objects,delete t.backgroundImage,delete t.overlayImage,delete t.background,delete t.overlay,this._setOptions(t),this.renderAll(),r&&r()},_setBgOverlay:function(t,e){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!t.backgroundImage&&!t.overlayImage&&!t.background&&!t.overlay){e&&e();return}var r=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",t.backgroundImage,i,r),this.__setBgOverlay("overlayImage",t.overlayImage,i,r),this.__setBgOverlay("backgroundColor",t.background,i,r),this.__setBgOverlay("overlayColor",t.overlay,i,r)},__setBgOverlay:function(t,e,i,r){var n=this;if(!e){i[t]=!0,r&&r();return}"backgroundImage"===t||"overlayImage"===t?ec.util.enlivenObjects([e],function(e){n[t]=e[0],i[t]=!0,r&&r()}):this["set"+ec.util.string.capitalize(t,!0)](e,function(){i[t]=!0,r&&r()})},_enlivenObjects:function(t,e,i){if(!t||0===t.length){e&&e([]);return}ec.util.enlivenObjects(t,function(t){e&&e(t)},null,i)},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(r){i(r.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=ec.util.createCanvasElement();e.width=this.width,e.height=this.height;var i=new ec.Canvas(e);this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),o=(n=(r=e).fabric||(r.fabric={})).util.object.extend,a=n.util.object.clone,s=n.util.toFixed,l=n.util.string.capitalize,c=n.util.degreesToRadians,h=!n.isLikelyNode,n.Object||(n.Object=n.util.createClass(n.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:h,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(t){t&&this.setOptions(t)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=n.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(t){var e=n.perfLimitSizeTotal,i=t.width,r=t.height,o=n.maxCacheSideLimit,a=n.minCacheSideLimit;if(i<=o&&r<=o&&i*r<=e)return i<a&&(t.width=a),r<a&&(t.height=a),t;var s=n.util.limitDimsByArea(i/r,e),l=n.util.capValue,c=l(a,s.x,o),h=l(a,s.y,o);return i>c&&(t.zoomX/=i/c,t.width=c,t.capped=!0),r>h&&(t.zoomY/=r/h,t.height=h,t.capped=!0),t},_getCacheCanvasDimensions:function(){var t=this.getTotalObjectScaling(),e=this._getTransformedDimensions(0,0),i=e.x*t.scaleX/this.scaleX,r=e.y*t.scaleY/this.scaleY;return{width:i+2,height:r+2,zoomX:t.scaleX,zoomY:t.scaleY,x:i,y:r}},_updateCacheCanvas:function(){var t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){var e=t._currentTransform.target,i=t._currentTransform.action;if(this===e&&i.slice&&"scale"===i.slice(0,5))return!1}var r,o,a=this._cacheCanvas,s=this._limitCacheSize(this._getCacheCanvasDimensions()),l=n.minCacheSideLimit,c=s.width,h=s.height,u=s.zoomX,f=s.zoomY,d=c!==this.cacheWidth||h!==this.cacheHeight,g=this.zoomX!==u||this.zoomY!==f,p=d||g,v=0,m=0,y=!1;if(d){var b=this._cacheCanvas.width,_=this._cacheCanvas.height,x=c>b||h>_;y=x||(c<.9*b||h<.9*_)&&b>l&&_>l,x&&!s.capped&&(c>l||h>l)&&(v=.1*c,m=.1*h)}return this instanceof n.Text&&this.path&&(p=!0,y=!0,v+=this.getHeightOfLine(0)*this.zoomX,m+=this.getHeightOfLine(0)*this.zoomY),!!p&&(y?(a.width=Math.ceil(c+v),a.height=Math.ceil(h+m)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),r=s.x/2,o=s.y/2,this.cacheTranslationX=Math.round(a.width/2-r)+r,this.cacheTranslationY=Math.round(a.height/2-o)+o,this.cacheWidth=c,this.cacheHeight=h,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(u,f),this.zoomX=u,this.zoomY=f,!0)},setOptions:function(t){this._setOptions(t),this._initGradient(t.fill,"fill"),this._initGradient(t.stroke,"stroke"),this._initPattern(t.fill,"fill"),this._initPattern(t.stroke,"stroke")},transform:function(t){var e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,i=this.calcTransformMatrix(!e);t.transform(i[0],i[1],i[2],i[3],i[4],i[5])},toObject:function(t){var e=n.Object.NUM_FRACTION_DIGITS,i={type:this.type,version:n.version,originX:this.originX,originY:this.originY,left:s(this.left,e),top:s(this.top,e),width:s(this.width,e),height:s(this.height,e),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:s(this.strokeWidth,e),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:s(this.strokeMiterLimit,e),scaleX:s(this.scaleX,e),scaleY:s(this.scaleY,e),angle:s(this.angle,e),flipX:this.flipX,flipY:this.flipY,opacity:s(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:s(this.skewX,e),skewY:s(this.skewY,e)};return this.clipPath&&!this.clipPath.excludeFromExport&&(i.clipPath=this.clipPath.toObject(t),i.clipPath.inverted=this.clipPath.inverted,i.clipPath.absolutePositioned=this.clipPath.absolutePositioned),n.util.populateWithProperties(this,i,t),this.includeDefaultValues||(i=this._removeDefaultValues(i)),i},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var e=n.util.getKlass(t.type).prototype;return e.stateProperties.forEach(function(i){"left"!==i&&"top"!==i&&(t[i]===e[i]&&delete t[i],Array.isArray(t[i])&&Array.isArray(e[i])&&0===t[i].length&&0===e[i].length&&delete t[i])}),t},toString:function(){return"#<fabric."+l(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var t=n.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(t.scaleX),scaleY:Math.abs(t.scaleY)}},getTotalObjectScaling:function(){var t=this.getObjectScaling(),e=t.scaleX,i=t.scaleY;if(this.canvas){var r=this.canvas.getZoom(),n=this.canvas.getRetinaScaling();e*=r*n,i*=r*n}return{scaleX:e,scaleY:i}},getObjectOpacity:function(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t},_set:function(t,e){var i=this[t]!==e,r=!1;return("scaleX"===t||"scaleY"===t)&&(e=this._constrainScale(e)),"scaleX"===t&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof n.Shadow?"dirty"===t&&this.group&&this.group.set("dirty",e):e=new n.Shadow(e),this[t]=e,i&&(r=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(t)>-1?(this.dirty=!0,r&&this.group.set("dirty",!0)):r&&this.stateProperties.indexOf(t)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:n.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(t){!this.isNotVisible()&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),t.restore())},renderCache:function(t){t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!!("stroke"===this.paintFirst&&this.hasFill()&&this.hasStroke())&&"object"==typeof this.shadow||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(t,e){if(t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",e.absolutePositioned){var i=n.util.invertTransform(this.calcTransformMatrix());t.transform(i[0],i[1],i[2],i[3],i[4],i[5])}e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()},drawObject:function(t,e){var i=this.fill,r=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath),this.fill=i,this.stroke=r},_drawClipPath:function(t,e){e&&(e.canvas=this.canvas,e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t,e))},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(t){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!t){var e=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-i/2,e,i)}return!0}return!1},_renderBackground:function(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}},_setOpacity:function(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity},_setStrokeStyles:function(t,e){var i=e.stroke;i&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?this._applyPatternForTransformedGradient(t,i):(t.strokeStyle=i.toLive(t,this),this._applyPatternGradientTransform(t,i)):t.strokeStyle=e.stroke)},_setFillStyles:function(t,e){var i=e.fill;i&&(i.toLive?(t.fillStyle=i.toLive(t,this),this._applyPatternGradientTransform(t,e.fill)):t.fillStyle=i)},_setClippingProperties:function(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"},_setLineDash:function(t,e){e&&0!==e.length&&(1&e.length&&e.push.apply(e,e),t.setLineDash(e))},_renderControls:function(t,e){var i,r,o,a=this.getViewportTransform(),s=this.calcTransformMatrix();r=void 0!==(e=e||{}).hasBorders?e.hasBorders:this.hasBorders,o=void 0!==e.hasControls?e.hasControls:this.hasControls,s=n.util.multiplyTransformMatrices(a,s),i=n.util.qrDecompose(s),t.save(),t.translate(i.translateX,i.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(i.angle-=180),t.rotate(c(this.group?i.angle:this.angle)),e.forActiveSelection||this.group?r&&this.drawBordersInGroup(t,i,e):r&&this.drawBorders(t,e),o&&this.drawControls(t,e),t.restore()},_setShadow:function(t){if(this.shadow){var e,i=this.shadow,r=this.canvas,o=r&&r.viewportTransform[0]||1,a=r&&r.viewportTransform[3]||1;e=i.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),r&&r._isRetinaScaling()&&(o*=n.devicePixelRatio,a*=n.devicePixelRatio),t.shadowColor=i.color,t.shadowBlur=i.blur*n.browserShadowBlurConstant*(o+a)*(e.scaleX+e.scaleY)/4,t.shadowOffsetX=i.offsetX*o*e.scaleX,t.shadowOffsetY=i.offsetY*a*e.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_applyPatternGradientTransform:function(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var i=e.gradientTransform||e.patternTransform,r=-this.width/2+e.offsetX||0,n=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,r,n):t.transform(1,0,0,1,r,n),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:r,offsetY:n}},_renderPaintInOrder:function(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))},_render:function(){},_renderFill:function(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform&&this.group){var e=this.getObjectScaling();t.scale(1/e.scaleX,1/e.scaleY)}else this.strokeUniform&&t.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}},_applyPatternForTransformedGradient:function(t,e){var i,r=this._limitCacheSize(this._getCacheCanvasDimensions()),o=n.util.createCanvasElement(),a=this.canvas.getRetinaScaling(),s=r.x/this.scaleX/a,l=r.y/this.scaleY/a;o.width=s,o.height=l,(i=o.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(s,0),i.lineTo(s,l),i.lineTo(0,l),i.closePath(),i.translate(s/2,l/2),i.scale(r.zoomX/this.scaleX/a,r.zoomY/this.scaleY/a),this._applyPatternGradientTransform(i,e),i.fillStyle=e.toLive(t),i.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(a*this.scaleX/r.zoomX,a*this.scaleY/r.zoomY),t.strokeStyle=i.createPattern(o,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var t=n.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}},_removeTransformMatrix:function(t){var e=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),e=n.util.transformPoint(e,this.transformMatrix)),this.transformMatrix=null,t&&(this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this.cropX=t.cropX,this.cropY=t.cropY,e.x+=t.offsetLeft,e.y+=t.offsetTop,this.width=t.width,this.height=t.height),this.setPositionByOrigin(e,"center","center")},clone:function(t,e){var i=this.toObject(e);this.constructor.fromObject?this.constructor.fromObject(i,t):n.Object._fromObject("Object",i,t)},cloneAsImage:function(t,e){var i=this.toCanvasElement(e);return t&&t(new n.Image(i)),this},toCanvasElement:function(t){t||(t={});var e=n.util,i=e.saveObjectTransform(this),r=this.group,o=this.shadow,a=Math.abs,s=(t.multiplier||1)*(t.enableRetinaScaling?n.devicePixelRatio:1);delete this.group,t.withoutTransform&&e.resetObjectTransform(this),t.withoutShadow&&(this.shadow=null);var l,c,h,u,f=n.util.createCanvasElement(),d=this.getBoundingRect(!0,!0),g=this.shadow,p={x:0,y:0};g&&(c=g.blur,l=g.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),p.x=2*Math.round(a(g.offsetX)+c)*a(l.scaleX),p.y=2*Math.round(a(g.offsetY)+c)*a(l.scaleY)),h=d.width+p.x,u=d.height+p.y,f.width=Math.ceil(h),f.height=Math.ceil(u);var v=new n.StaticCanvas(f,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===t.format&&(v.backgroundColor="#fff"),this.setPositionByOrigin(new n.Point(v.width/2,v.height/2),"center","center");var m=this.canvas;v.add(this);var y=v.toCanvasElement(s||1,t);return this.shadow=o,this.set("canvas",m),r&&(this.group=r),this.set(i).setCoords(),v._objects=[],v.dispose(),v=null,y},toDataURL:function(t){return t||(t={}),n.util.toDataURL(this.toCanvasElement(t),t.format||"png",t.quality||1)},isType:function(t){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===t},complexity:function(){return 1},toJSON:function(t){return this.toObject(t)},rotate:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=new n.Point(e.x,e.y),r=this._getLeftTopCoords();return this.angle&&(i=n.util.rotatePoint(i,r,c(-this.angle))),{x:i.x-r.x,y:i.y-r.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){n.runningAnimations&&n.runningAnimations.cancelByTarget(this)}}),n.util.createAccessors&&n.util.createAccessors(n.Object),o(n.Object.prototype,n.Observable),n.Object.NUM_FRACTION_DIGITS=2,n.Object.ENLIVEN_PROPS=["clipPath"],n.Object._fromObject=function(t,e,i,r){var o=n[t];e=a(e,!0),n.util.enlivenPatterns([e.fill,e.stroke],function(t){void 0!==t[0]&&(e.fill=t[0]),void 0!==t[1]&&(e.stroke=t[1]),n.util.enlivenObjectEnlivables(e,e,function(){var t=r?new o(e[r],e):new o(e);i&&i(t)})})},n.Object.__uid=0),R=ec.util.degreesToRadians,B={left:-.5,center:0,right:.5},X={top:-.5,center:0,bottom:.5},ec.util.object.extend(ec.Object.prototype,{translateToGivenOrigin:function(t,e,i,r,n){var o,a,s,l=t.x,c=t.y;return"string"==typeof e?e=B[e]:e-=.5,"string"==typeof r?r=B[r]:r-=.5,o=r-e,"string"==typeof i?i=X[i]:i-=.5,"string"==typeof n?n=X[n]:n-=.5,a=n-i,(o||a)&&(s=this._getTransformedDimensions(),l=t.x+o*s.x,c=t.y+a*s.y),new ec.Point(l,c)},translateToCenterPoint:function(t,e,i){var r=this.translateToGivenOrigin(t,e,i,"center","center");return this.angle?ec.util.rotatePoint(r,t,R(this.angle)):r},translateToOriginPoint:function(t,e,i){var r=this.translateToGivenOrigin(t,"center","center",e,i);return this.angle?ec.util.rotatePoint(r,t,R(this.angle)):r},getCenterPoint:function(){var t=new ec.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(t,e,i){var r,n,o=this.getCenterPoint();return r=void 0!==e&&void 0!==i?this.translateToGivenOrigin(o,"center","center",e,i):new ec.Point(this.left,this.top),n=new ec.Point(t.x,t.y),this.angle&&(n=ec.util.rotatePoint(n,o,-R(this.angle))),n.subtractEquals(r)},setPositionByOrigin:function(t,e,i){var r=this.translateToCenterPoint(t,e,i),n=this.translateToOriginPoint(r,this.originX,this.originY);this.set("left",n.x),this.set("top",n.y)},adjustPosition:function(t){var e,i,r=R(this.angle),n=this.getScaledWidth(),o=ec.util.cos(r)*n,a=ec.util.sin(r)*n;e="string"==typeof this.originX?B[this.originX]:this.originX-.5,i="string"==typeof t?B[t]:t-.5,this.left+=o*(i-e),this.top+=a*(i-e),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),z=(Y=ec.util).degreesToRadians,W=Y.multiplyTransformMatrices,H=Y.transformPoint,Y.object.extend(ec.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(t,e){return e?t?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),t?this.aCoords:this.lineCoords)},getCoords:function(t,e){var i;return i=this._getCoords(t,e),[new ec.Point(i.tl.x,i.tl.y),new ec.Point(i.tr.x,i.tr.y),new ec.Point(i.br.x,i.br.y),new ec.Point(i.bl.x,i.bl.y)]},intersectsWithRect:function(t,e,i,r){var n=this.getCoords(i,r);return"Intersection"===ec.Intersection.intersectPolygonRectangle(n,t,e).status},intersectsWithObject:function(t,e,i){return"Intersection"===ec.Intersection.intersectPolygonPolygon(this.getCoords(e,i),t.getCoords(e,i)).status||t.isContainedWithinObject(this,e,i)||this.isContainedWithinObject(t,e,i)},isContainedWithinObject:function(t,e,i){for(var r=this.getCoords(e,i),n=e?t.aCoords:t.lineCoords,o=0,a=t._getImageLines(n);o<4;o++)if(!t.containsPoint(r[o],a))return!1;return!0},isContainedWithinRect:function(t,e,i,r){var n=this.getBoundingRect(i,r);return n.left>=t.x&&n.left+n.width<=e.x&&n.top>=t.y&&n.top+n.height<=e.y},containsPoint:function(t,e,i,r){var n=this._getCoords(i,r),e=e||this._getImageLines(n),o=this._findCrossPoints(t,e);return 0!==o&&o%2==1},isOnScreen:function(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!(this.getCoords(!0,t).some(function(t){return t.x<=i.x&&t.x>=e.x&&t.y<=i.y&&t.y>=e.y})||this.intersectsWithRect(e,i,!0,t))||this._containsCenterOfCanvas(e,i,t)},_containsCenterOfCanvas:function(t,e,i){var r={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return!!this.containsPoint(r,null,!0,i)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(e,i,!0,t)||this.getCoords(!0,t).every(function(t){return(t.x>=i.x||t.x<=e.x)&&(t.y>=i.y||t.y<=e.y)})&&this._containsCenterOfCanvas(e,i,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,r,n,o=0;for(var a in e)if((!((n=e[a]).o.y<t.y)||!(n.d.y<t.y))&&(!(n.o.y>=t.y)||!(n.d.y>=t.y))&&(n.o.x===n.d.x&&n.o.x>=t.x?r=n.o.x:(i=(n.d.y-n.o.y)/(n.d.x-n.o.x),r=-(t.y-0*t.x-(n.o.y-i*n.o.x))/(0-i)),r>=t.x&&(o+=1),2===o))break;return o},getBoundingRect:function(t,e){var i=this.getCoords(t,e);return Y.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,e){var i=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/i)},scaleToHeight:function(t,e){var i=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/i)},calcLineCoords:function(){var t=this.getViewportTransform(),e=this.padding,i=z(this.angle),r=Y.cos(i),n=Y.sin(i),o=r*e,a=n*e,s=o+a,l=o-a,c=this.calcACoords(),h={tl:H(c.tl,t),tr:H(c.tr,t),bl:H(c.bl,t),br:H(c.br,t)};return e&&(h.tl.x-=l,h.tl.y-=s,h.tr.x+=s,h.tr.y-=l,h.bl.x-=s,h.bl.y+=l,h.br.x+=l,h.br.y+=s),h},calcOCoords:function(){var t=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),i=this.getViewportTransform(),r=W(i,e),n=W(r,t),n=W(n,[1/i[0],0,0,1/i[3],0,0]),o=this._calculateCurrentDimensions(),a={};return this.forEachControl(function(t,e,i){a[e]=t.positionHandler(o,n,i)}),a},calcACoords:function(){var t=this._calcRotateMatrix(),e=W(this._calcTranslateMatrix(),t),i=this._getTransformedDimensions(),r=i.x/2,n=i.y/2;return{tl:H({x:-r,y:-n},e),tr:H({x:r,y:-n},e),bl:H({x:-r,y:n},e),br:H({x:r,y:n},e)}},setCoords:function(t){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),t||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return Y.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var e="";return!t&&this.group&&(e=this.group.transformMatrixKey(t)+"_"),e+this.top+"_"+this.left+"_"+this.scaleX+"_"+this.scaleY+"_"+this.skewX+"_"+this.skewY+"_"+this.angle+"_"+this.originX+"_"+this.originY+"_"+this.width+"_"+this.height+"_"+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){var e=this.calcOwnMatrix();if(t||!this.group)return e;var i=this.transformMatrixKey(t),r=this.matrixCache||(this.matrixCache={});return r.key===i?r.value:(this.group&&(e=W(this.group.calcTransformMatrix(!1),e)),r.key=i,r.value=e,e)},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),e=this.ownMatrixCache||(this.ownMatrixCache={});if(e.key===t)return e.value;var i=this._calcTranslateMatrix(),r={angle:this.angle,translateX:i[4],translateY:i[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return e.key=t,e.value=Y.composeMatrix(r),e.value},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,r,n,o=0===t&&0===e;if(this.strokeUniform?(r=this.width,n=this.height):(r=(i=this._getNonTransformedDimensions()).x,n=i.y),o)return this._finalizeDimensions(r*this.scaleX,n*this.scaleY);var a=Y.sizeAfterTransform(r,n,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:e});return this._finalizeDimensions(a.x,a.y)},_finalizeDimensions:function(t,e){return this.strokeUniform?{x:t+this.strokeWidth,y:e+this.strokeWidth}:{x:t,y:e}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform();return H(this._getTransformedDimensions(),t,!0).scalarAdd(2*this.padding)}}),ec.util.object.extend(ec.Object.prototype,{sendToBack:function(){return this.group?ec.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?ec.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?ec.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas&&this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?ec.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas&&this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group&&"activeSelection"!==this.group.type?ec.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas&&this.canvas.moveTo(this,t),this}}),function(){var t=ec.util.object.extend,e="stateProperties";function i(e,i,r){var n={};r.forEach(function(t){n[t]=e[t]}),t(e[i],n,!0)}ec.util.object.extend(ec.Object.prototype,{hasStateChanged:function(t){var i="_"+(t=t||e);return Object.keys(this[i]).length<this[t].length||!function t(e,i,r){if(e===i)return!0;if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var n=0,o=e.length;n<o;n++)if(!t(e[n],i[n]))return!1;return!0}if(e&&"object"==typeof e){var a,s=Object.keys(e);if(!i||"object"!=typeof i||!r&&s.length!==Object.keys(i).length)return!1;for(var n=0,o=s.length;n<o;n++)if("canvas"!==(a=s[n])&&"group"!==a&&!t(e[a],i[a]))return!1;return!0}}(this[i],this,!0)},saveState:function(t){var r=t&&t.propertySet||e,n="_"+r;return this[n]?(i(this,n,this[r]),t&&t.stateProperties&&i(this,n,t.stateProperties),this):this.setupState(t)},setupState:function(t){var i=(t=t||{}).propertySet||e;return t.propertySet=i,this["_"+i]={},this.saveState(t),this}})}(),U=ec.util.degreesToRadians,ec.util.object.extend(ec.Object.prototype,{_findTargetCorner:function(t,e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i,r,n,o=t.x,a=t.y,s=Object.keys(this.oCoords),l=s.length-1;for(this.__corner=0;l>=0;l--)if(n=s[l],this.isControlVisible(n)&&(r=this._getImageLines(e?this.oCoords[n].touchCorner:this.oCoords[n].corner),0!==(i=this._findCrossPoints({x:o,y:a},r))&&i%2==1))return this.__corner=n,n;return!1},forEachControl:function(t){for(var e in this.controls)t(this.controls[e],e,this)},_setCornerCoords:function(){var t=this.oCoords;for(var e in t){var i=this.controls[e];t[e].corner=i.calcCornerCoords(this.angle,this.cornerSize,t[e].x,t[e].y,!1),t[e].touchCorner=i.calcCornerCoords(this.angle,this.touchCornerSize,t[e].x,t[e].y,!0)}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var e=this.getCenterPoint(),i=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return t.translate(e.x,e.y),t.scale(1/r[0],1/r[3]),t.rotate(U(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore(),this},drawBorders:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),r=this.borderScaleFactor,n=i.x+r,o=i.y+r,a=void 0!==e.hasControls?e.hasControls:this.hasControls,s=!1;return t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray),t.strokeRect(-n/2,-o/2,n,o),a&&(t.beginPath(),this.forEachControl(function(e,i,r){e.withConnection&&e.getVisibility(r,i)&&(s=!0,t.moveTo(e.x*n,e.y*o),t.lineTo(e.x*n+e.offsetX,e.y*o+e.offsetY))}),s&&t.stroke()),t.restore(),this},drawBordersInGroup:function(t,e,i){i=i||{};var r=ec.util.sizeAfterTransform(this.width,this.height,e),n=this.strokeWidth,o=this.strokeUniform,a=this.borderScaleFactor,s=r.x+n*(o?this.canvas.getZoom():e.scaleX)+a,l=r.y+n*(o?this.canvas.getZoom():e.scaleY)+a;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-s/2,-l/2,s,l),t.restore(),this},drawControls:function(t,e){e=e||{},t.save();var i,r,n=this.canvas.getRetinaScaling();return t.setTransform(n,0,0,n,0,0),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(i=this.group.calcTransformMatrix()),this.forEachControl(function(n,o,a){r=a.oCoords[o],n.getVisibility(a,o)&&(i&&(r=ec.util.transformPoint(r,i)),n.render(t,r.x,r.y,e,a))}),t.restore(),this},isControlVisible:function(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)},setControlVisible:function(t,e){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},onDeselect:function(){},onSelect:function(){}}),ec.util.object.extend(ec.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},r=(e=e||{}).onComplete||i,n=e.onChange||i,o=this;return ec.util.animate({target:this,startValue:t.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.requestRenderAll(),n()},onComplete:function(){t.setCoords(),r()}})},fxCenterObjectV:function(t,e){var i=function(){},r=(e=e||{}).onComplete||i,n=e.onChange||i,o=this;return ec.util.animate({target:this,startValue:t.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.requestRenderAll(),n()},onComplete:function(){t.setCoords(),r()}})},fxRemove:function(t,e){var i=function(){},r=(e=e||{}).onComplete||i,n=e.onChange||i,o=this;return ec.util.animate({target:this,startValue:t.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){t.set("opacity",e),o.requestRenderAll(),n()},onComplete:function(){o.remove(t),r()}})}}),ec.util.object.extend(ec.Object.prototype,{animate:function(){if(!arguments[0]||"object"!=typeof arguments[0])return this._animate.apply(this,arguments);var t,e,i=[],r=[];for(t in arguments[0])i.push(t);for(var n=0,o=i.length;n<o;n++)t=i[n],e=n!==o-1,r.push(this._animate(t,arguments[0][t],arguments[1],e));return r},_animate:function(t,e,i,r){var n,o=this;e=e.toString(),i=i?ec.util.object.clone(i):{},~t.indexOf(".")&&(n=t.split("."));var a=o.colorProperties.indexOf(t)>-1||n&&o.colorProperties.indexOf(n[1])>-1,s=n?this.get(n[0])[n[1]]:this.get(t);"from"in i||(i.from=s),a||(e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e));var l={target:this,startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(t,e,r){return i.abort.call(o,t,e,r)},onChange:function(e,a,s){n?o[n[0]][n[1]]=e:o.set(t,e),!r&&i.onChange&&i.onChange(e,a,s)},onComplete:function(t,e,n){!r&&(o.setCoords(),i.onComplete&&i.onComplete(t,e,n))}};return a?ec.util.animateColor(l.startValue,l.endValue,l.duration,l):ec.util.animate(l)}}),function(t){"use strict";var e=t.fabric||(t.fabric={});if(e.util.object.extend,e.Rect){e.warn("fabric.Rect is already defined");return}e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){var e=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,n=this.height,o=-this.width/2,a=-this.height/2,s=0!==e||0!==i;t.beginPath(),t.moveTo(o+e,a),t.lineTo(o+r-e,a),s&&t.bezierCurveTo(o+r-.4477152502*e,a,o+r,a+.4477152502*i,o+r,a+i),t.lineTo(o+r,a+n-i),s&&t.bezierCurveTo(o+r,a+n-.4477152502*i,o+r-.4477152502*e,a+n,o+r-e,a+n),t.lineTo(o+e,a+n),s&&t.bezierCurveTo(o+.4477152502*e,a+n,o,a+n-.4477152502*i,o,a+n-i),t.lineTo(o,a+i),s&&t.bezierCurveTo(o,a+.4477152502*i,o+.4477152502*e,a,o+e,a),t.closePath(),this._renderPaintInOrder(t)},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))}}),e.Rect.fromObject=function(t,i){return e.Object._fromObject("Rect",t,i)}}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,r=e.util.array.min,n=e.util.array.max,o=(e.util.toFixed,e.util.projectStrokeOnPoints);if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._setPositionDimensions(e)},_projectStrokeOnPoints:function(){return o(this.points,this,!0)},_setPositionDimensions:function(t){var e,i=this._calcDimensions(t),r=this.exactBoundingBox?this.strokeWidth:0;this.width=i.width-r,this.height=i.height-r,t.fromSVG||(e=this.translateToGivenOrigin({x:i.left-this.strokeWidth/2+r/2,y:i.top-this.strokeWidth/2+r/2},"left","top",this.originX,this.originY)),void 0===t.left&&(this.left=t.fromSVG?i.left:e.x),void 0===t.top&&(this.top=t.fromSVG?i.top:e.y),this.pathOffset={x:i.left+this.width/2+r/2,y:i.top+this.height/2+r/2}},_calcDimensions:function(){var t=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,e=r(t,"x")||0,i=r(t,"y")||0;return{left:e,top:i,width:(n(t,"x")||0)-e,height:(n(t,"y")||0)-i}},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},commonRender:function(t){var e,i=this.points.length,r=this.pathOffset.x,n=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-r,this.points[0].y-n);for(var o=0;o<i;o++)e=this.points[o],t.lineTo(e.x-r,e.y-n);return!0},_render:function(t){this.commonRender(t)&&this._renderPaintInOrder(t)},complexity:function(){return this.get("points").length}}),e.Polyline.fromObject=function(t,i){return e.Object._fromObject("Polyline",t,i,"points")}}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,r=e.util.array.max,n=e.util.object.extend,o=e.util.object.clone;if(e.util.toFixed,e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(t,e){delete(e=o(e||{})).path,this.callSuper("initialize",e),this._setPath(t||[],e)},_setPath:function(t,i){this.path=e.util.makePathSimpler(Array.isArray(t)?t:e.util.parsePath(t)),e.Polyline.prototype._setPositionDimensions.call(this,i||{})},_renderPathCommands:function(t){var e,i=0,r=0,n=0,o=0,a=0,s=0,l=-this.pathOffset.x,c=-this.pathOffset.y;t.beginPath();for(var h=0,u=this.path.length;h<u;++h)switch((e=this.path[h])[0]){case"L":n=e[1],o=e[2],t.lineTo(n+l,o+c);break;case"M":n=e[1],o=e[2],i=n,r=o,t.moveTo(n+l,o+c);break;case"C":n=e[5],o=e[6],a=e[3],s=e[4],t.bezierCurveTo(e[1]+l,e[2]+c,a+l,s+c,n+l,o+c);break;case"Q":t.quadraticCurveTo(e[1]+l,e[2]+c,e[3]+l,e[4]+c),n=e[3],o=e[4],a=e[1],s=e[2];break;case"z":case"Z":n=i,o=r,t.closePath()}},_render:function(t){this._renderPathCommands(t),this._renderPaintInOrder(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return n(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()})})},toDatalessObject:function(t){var e=this.toObject(["sourcePath"].concat(t));return e.sourcePath&&delete e.path,e},complexity:function(){return this.path.length},_calcDimensions:function(){for(var t,n,o=[],a=[],s=0,l=0,c=0,h=0,u=0,f=this.path.length;u<f;++u){switch((t=this.path[u])[0]){case"L":c=t[1],h=t[2],n=[];break;case"M":c=t[1],h=t[2],s=c,l=h,n=[];break;case"C":n=e.util.getBoundsOfCurve(c,h,t[1],t[2],t[3],t[4],t[5],t[6]),c=t[5],h=t[6];break;case"Q":n=e.util.getBoundsOfCurve(c,h,t[1],t[2],t[1],t[2],t[3],t[4]),c=t[3],h=t[4];break;case"z":case"Z":c=s,h=l}n.forEach(function(t){o.push(t.x),a.push(t.y)}),o.push(c),a.push(h)}var d=i(o)||0,g=i(a)||0;return{left:d,top:g,width:(r(o)||0)-d,height:(r(a)||0)-g}}}),e.Path.fromObject=function(t,i){if("string"==typeof t.sourcePath){var r=t.sourcePath;e.loadSVGFromURL(r,function(e){var r=e[0];r.setOptions(t),i&&i(r)})}else e.Object._fromObject("Path",t,i,"path")}}(e),d=(f=(u=e).fabric||(u.fabric={})).util.array.min,g=f.util.array.max,f.Group||(f.Group=f.util.createClass(f.Object,f.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;if(i)this._updateObjectsACoords();else{var n=e&&e.centerPoint;void 0!==e.originX&&(this.originX=e.originX),void 0!==e.originY&&(this.originY=e.originY),n||this._calcBounds(),this._updateObjectsCoords(n),delete e.centerPoint,this.callSuper("initialize",e)}this.setCoords()},_updateObjectsACoords:function(){for(var t=this._objects.length;t--;)this._objects[t].setCoords(!0)},_updateObjectsCoords:function(t){for(var t=t||this.getCenterPoint(),e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){var i=t.left,r=t.top;t.set({left:i-e.x,top:r-e.y}),t.group=this,t.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){var e=!!this.group;return this._restoreObjectsState(),f.util.resetObjectTransform(this),t&&(e&&f.util.removeTransformFromObject(t,this.group.calcTransformMatrix()),this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,e?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(t){return this._restoreObjectsState(),f.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,e){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(t,e);if("canvas"===t)for(;i--;)this._objects[i]._set(t,e);f.Object.prototype._set.call(this,t,e)},toObject:function(t){var e=this.includeDefaultValues,i=this._objects.filter(function(t){return!t.excludeFromExport}).map(function(i){var r=i.includeDefaultValues;i.includeDefaultValues=e;var n=i.toObject(t);return i.includeDefaultValues=r,n}),r=f.Object.prototype.toObject.call(this,t);return r.objects=i,r},toDatalessObject:function(t){var e,i=this.sourcePath;if(i)e=i;else{var r=this.includeDefaultValues;e=this._objects.map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=r;var n=e.toDatalessObject(t);return e.includeDefaultValues=i,n})}var n=f.Object.prototype.toDatalessObject.call(this,t);return n.objects=e,n},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=f.Object.prototype.shouldCache.call(this);if(t){for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t},willDrawShadow:function(){if(f.Object.prototype.willDrawShadow.call(this))return!0;for(var t=0,e=this._objects.length;t<e;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var e=0,i=this._objects.length;e<i;e++)this._objects[e].render(t);this._drawClipPath(t,this.clipPath)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].isCacheDirty(!0)){if(this._cacheCanvas){var r=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-r/2,-n/2,r,n)}return!0}return!1},_restoreObjectsState:function(){var t=this.calcOwnMatrix();return this._objects.forEach(function(e){f.util.addTransformToObject(e,t),delete e.group,e.setCoords()}),this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var t=this._objects,e=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var r=new f.ActiveSelection([]);return r.set(i),r.type="activeSelection",e.remove(this),t.forEach(function(t){t.group=r,t.dirty=!0,e.add(t)}),r.canvas=e,r._objects=t,e._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0)}),this},_calcBounds:function(t){for(var e,i,r,n,o=[],a=[],s=["tr","br","bl","tl"],l=0,c=this._objects.length,h=s.length;l<c;++l){for(n=0,r=(e=this._objects[l]).calcACoords();n<h;n++)i=s[n],o.push(r[i].x),a.push(r[i].y);e.aCoords=r}this._getBounds(o,a,t)},_getBounds:function(t,e,i){var r=new f.Point(d(t),d(e)),n=new f.Point(g(t),g(e)),o=r.y||0,a=r.x||0,s=n.x-r.x||0,l=n.y-r.y||0;this.width=s,this.height=l,i||this.setPositionByOrigin({x:a,y:o},"left","top")}}),f.Group.fromObject=function(t,e){var i=t.objects,r=f.util.object.clone(t,!0);if(delete r.objects,"string"==typeof i){f.loadSVGFromURL(i,function(n){var o=f.util.groupSVGElements(n,t,i);o.set(r),e&&e(o)});return}f.util.enlivenObjects(i,function(i){var r=f.util.object.clone(t,!0);delete r.objects,f.util.enlivenObjectEnlivables(t,r,function(){e&&e(new f.Group(i,r,!0))})})}),(v=(p=e).fabric||(p.fabric={})).ActiveSelection||(v.ActiveSelection=v.util.createClass(v.Group,{type:"activeSelection",initialize:function(t,e){e=e||{},this._objects=t||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),this._calcBounds(),this._updateObjectsCoords(),v.Object.prototype.initialize.call(this,e),this.setCoords()},toGroup:function(){var t=this._objects.concat();this._objects=[];var e=v.Object.prototype.toObject.call(this),i=new v.Group([]);if(delete e.type,i.set(e),t.forEach(function(t){t.canvas.remove(t),t.group=i}),i._objects=t,!this.canvas)return i;var r=this.canvas;return r.add(i),r._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),i.forActiveSelection=!0;for(var r=0,n=this._objects.length;r<n;r++)this._objects[r]._renderControls(t,i);t.restore()}}),v.ActiveSelection.fromObject=function(t,e){v.util.enlivenObjects(t.objects,function(i){delete t.objects,e&&e(new v.ActiveSelection(i,t,!0))})}),function(t){"use strict";var e=ec.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image){ec.warn("fabric.Image is already defined.");return}ec.Image=ec.util.createClass(ec.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:ec.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:ec.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(t,e){e||(e={}),this.filters=[],this.cacheKey="texture"+ec.Object.__uid++,this.callSuper("initialize",e),this._initElement(t,e)},getElement:function(){return this._element||{}},setElement:function(t,e){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=t,this._originalElement=t,this._initConfig(e),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(t){var e=ec.filterBackend;e&&e.evictCachesForKey&&e.evictCachesForKey(t)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(t){ec.util.cleanUpJsdomNode(this[t]),this[t]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var t=this.getElement();return{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},toObject:function(t){var i=[];this.filters.forEach(function(t){t&&i.push(t.toObject())});var r=e(this.callSuper("toObject",["cropX","cropY"].concat(t)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},getSrc:function(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src"):e.src:this.src||""},setSrc:function(t,e,i){return ec.util.loadImage(t,function(t,r){this.setElement(t,i),this._setWidthHeight(),e&&e(this,r)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var t=this.resizeFilter,e=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),r=i.scaleX,n=i.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||r>e&&n>e){this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,this._lastScaleY=n;return}ec.filterBackend||(ec.filterBackend=ec.initFilterBackend());var a=ec.util.createCanvasElement(),s=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,l=o.width,c=o.height;a.width=l,a.height=c,this._element=a,this._lastScaleX=t.scaleX=r,this._lastScaleY=t.scaleY=n,ec.filterBackend.applyFilters([t],o,l,c,this._element,s),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height},applyFilters:function(t){if(t=(t=t||this.filters||[]).filter(function(t){return t&&!t.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===t.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var e=this._originalElement,i=e.naturalWidth||e.width,r=e.naturalHeight||e.height;if(this._element===this._originalElement){var n=ec.util.createCanvasElement();n.width=i,n.height=r,this._element=n,this._filteredEl=n}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,r),this._lastScaleX=1,this._lastScaleY=1;return ec.filterBackend||(ec.filterBackend=ec.initFilterBackend()),ec.filterBackend.applyFilters(t,this._originalElement,i,r,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(t){ec.util.setImageSmoothing(t,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)},drawCacheOnCanvas:function(t){ec.util.setImageSmoothing(t,this.imageSmoothing),ec.Object.prototype.drawCacheOnCanvas.call(this,t)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(t){var e=this._element;if(e){var i=this._filterScalingX,r=this._filterScalingY,n=this.width,o=this.height,a=Math.min,s=Math.max,l=s(this.cropX,0),c=s(this.cropY,0),h=e.naturalWidth||e.width,u=e.naturalHeight||e.height,f=l*i,d=c*r,g=a(n*i,h-f),p=a(o*r,u-d),v=a(n,h/i-l),m=a(o,u/r-c);e&&t.drawImage(e,f,d,g,p,-n/2,-o/2,v,m)}},_needsResize:function(){var t=this.getTotalObjectScaling();return t.scaleX!==this._lastScaleX||t.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(t,e){this.setElement(ec.util.getById(t),e),ec.util.addClass(this.getElement(),ec.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t)},_initFilters:function(t,e){t&&t.length?ec.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){t||(t={});var e=this.getElement();this.width=t.width||e.naturalWidth||e.width||0,this.height=t.height||e.naturalHeight||e.height||0},parsePreserveAspectRatioAttribute:function(){var t,e=ec.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,r=this._element.height,n=1,o=1,a=0,s=0,l=0,c=0,h=this.width,u=this.height,f={width:h,height:u};return e&&("none"!==e.alignX||"none"!==e.alignY)?("meet"===e.meetOrSlice&&(n=o=ec.util.findScaleToFit(this._element,f),t=(h-i*n)/2,"Min"===e.alignX&&(a=-t),"Max"===e.alignX&&(a=t),t=(u-r*o)/2,"Min"===e.alignY&&(s=-t),"Max"===e.alignY&&(s=t)),"slice"===e.meetOrSlice&&(n=o=ec.util.findScaleToCover(this._element,f),t=i-h/n,"Mid"===e.alignX&&(l=t/2),"Max"===e.alignX&&(l=t),t=r-u/o,"Mid"===e.alignY&&(c=t/2),"Max"===e.alignY&&(c=t),i=h/n,r=u/o)):(n=h/i,o=u/r),{width:i,height:r,scaleX:n,scaleY:o,offsetLeft:a,offsetTop:s,cropX:l,cropY:c}}}),ec.Image.CSS_CANVAS="canvas-img",ec.Image.prototype.getSvgSrc=ec.Image.prototype.getSrc,ec.Image.fromObject=function(t,e){var i=ec.util.object.clone(t);ec.util.loadImage(i.src,function(t,r){if(r){e&&e(null,!0);return}ec.Image.prototype._initFilters.call(i,i.filters,function(r){i.filters=r||[],ec.Image.prototype._initFilters.call(i,[i.resizeFilter],function(r){i.resizeFilter=r[0],ec.util.enlivenObjectEnlivables(i,i,function(){e(new ec.Image(t,i),!1)})})})},null,i.crossOrigin)},ec.Image.fromURL=function(t,e,i){ec.util.loadImage(t,function(t,r){e&&e(new ec.Image(t,i),r)},null,i&&i.crossOrigin)}}(e),function(){"use strict";function t(t){t&&t.tileSize&&(this.tileSize=t.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}ec.isWebglSupported=function(t){if(ec.isLikelyNode)return!1;t=t||ec.WebglFilterBackend.prototype.tileSize;var e=document.createElement("canvas"),i=e.getContext("webgl")||e.getContext("experimental-webgl"),r=!1;if(i){ec.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),r=ec.maxTextureSize>=t;for(var n=["highp","mediump","lowp"],o=0;o<3;o++)if(function(t,e){var i=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(i,"precision "+e+" float;\nvoid main(){}"),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS)}(i,n[o])){ec.webGlPrecision=n[o];break}}return this.isSupported=r,r},ec.WebglFilterBackend=t,t.prototype={tileSize:2048,resources:{},setupGLContext:function(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(t,e)},chooseFastestCopyGLTo2DMethod:function(t,e){var i,r,n,o=void 0!==window.performance;try{new ImageData(1,1),n=!0}catch(a){n=!1}var s="undefined"!=typeof ArrayBuffer,l="undefined"!=typeof Uint8ClampedArray;if(o&&n&&s&&l){var c=ec.util.createCanvasElement(),h=new ArrayBuffer(t*e*4);if(ec.forceGLPutImageData){this.imageBuffer=h,this.copyGLTo2D=ef;return}var u={imageBuffer:h,destinationWidth:t,destinationHeight:e,targetCanvas:c};c.width=t,c.height=e,i=window.performance.now(),eu.call(u,this.gl,u),r=window.performance.now()-i,i=window.performance.now(),ef.call(u,this.gl,u),r>window.performance.now()-i?(this.imageBuffer=h,this.copyGLTo2D=ef):this.copyGLTo2D=eu}},createWebGLCanvas:function(t,e){var i=ec.util.createCanvasElement();i.width=t,i.height=e;var r={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},n=i.getContext("webgl",r);n||(n=i.getContext("experimental-webgl",r)),n&&(n.clearColor(0,0,0,0),this.canvas=i,this.gl=n)},applyFilters:function(t,e,i,r,n,o){var a,s,l,c,h,u,f=this.gl;o&&(u=this.getCachedTexture(o,e));var d={originalWidth:e.width||e.originalWidth,originalHeight:e.height||e.originalHeight,sourceWidth:i,sourceHeight:r,destinationWidth:i,destinationHeight:r,context:f,sourceTexture:this.createTexture(f,i,r,!u&&e),targetTexture:this.createTexture(f,i,r),originalTexture:u||this.createTexture(f,i,r,!u&&e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},g=f.createFramebuffer();return f.bindFramebuffer(f.FRAMEBUFFER,g),t.forEach(function(t){t&&t.applyTo(d)}),s=(a=d.targetCanvas).width,l=a.height,c=d.destinationWidth,h=d.destinationHeight,(s!==c||l!==h)&&(a.width=c,a.height=h),this.copyGLTo2D(f,d),f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(d.sourceTexture),f.deleteTexture(d.targetTexture),f.deleteFramebuffer(g),n.getContext("2d").setTransform(1,0,0,1,0,0),d},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(t,e,i,r){var n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),n},getCachedTexture:function(t,e){if(this.textureCache[t])return this.textureCache[t];var i=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[t]=i,i},evictCachesForKey:function(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])},copyGLTo2D:eu,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,e={renderer:"",vendor:""};if(!t)return e;var i=t.getExtension("WEBGL_debug_renderer_info");if(i){var r=t.getParameter(i.UNMASKED_RENDERER_WEBGL),n=t.getParameter(i.UNMASKED_VENDOR_WEBGL);r&&(e.renderer=r.toLowerCase()),n&&(e.vendor=n.toLowerCase())}return this.gpuInfo=e,e}}}(),function(){"use strict";var t=function(){};function e(){}ec.Canvas2dFilterBackend=e,e.prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(t,e,i,r,n){var o=n.getContext("2d");o.drawImage(e,0,0,i,r);var a=o.getImageData(0,0,i,r),s=o.getImageData(0,0,i,r),l={sourceWidth:i,sourceHeight:r,imageData:a,originalEl:e,originalImageData:s,canvasEl:n,ctx:o,filterBackend:this};return t.forEach(function(t){t.applyTo(l)}),(l.imageData.width!==i||l.imageData.height!==r)&&(n.width=l.imageData.width,n.height=l.imageData.height),o.putImageData(l.imageData,0,0),l}}}(),ec.Image=ec.Image||{},ec.Image.filters=ec.Image.filters||{},ec.Image.filters.BaseFilter=ec.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},createProgram:function(t,e,i){e=e||this.fragmentSource,i=i||this.vertexSource,"highp"!==ec.webGlPrecision&&(e=e.replace(/precision highp float/g,"precision "+ec.webGlPrecision+" float"));var r=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw Error("Vertex shader compile error for "+this.type+": "+t.getShaderInfoLog(r));var n=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Fragment shader compile error for "+this.type+": "+t.getShaderInfoLog(n));var o=t.createProgram();if(t.attachShader(o,r),t.attachShader(o,n),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(o));var a=this.getAttributeLocations(t,o),s=this.getUniformLocations(t,o)||{};return s.uStepW=t.getUniformLocation(o,"uStepW"),s.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:a,uniformLocations:s}},getAttributeLocations:function(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(t,e,i){var r=e.aPosition,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW)},_setupFrameBuffer:function(t){var e,i,r=t.context;t.passes>1?(e=t.destinationWidth,i=t.destinationHeight,(t.sourceWidth!==e||t.sourceHeight!==i)&&(r.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(r,e,i)),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t.targetTexture,0)):(r.bindFramebuffer(r.FRAMEBUFFER,null),r.finish())},_swapTextures:function(t){t.passes--,t.pass++;var e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e},isNeutralState:function(){var t=this.mainParameter,e=ec.Image.filters[this.type].prototype;if(!t)return!1;if(!Array.isArray(e[t]))return e[t]===this[t];for(var i=e[t].length;i--;)if(this[t][i]!==e[t][i])return!1;return!0},applyTo:function(t){t.webgl?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},retrieveShader:function(t){return t.programCache.hasOwnProperty(this.type)||(t.programCache[this.type]=this.createProgram(t.context)),t.programCache[this.type]},applyToWebGL:function(t){var e=t.context,i=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.aPosition),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)},unbindAdditionalTexture:function(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(t){this[this.mainParameter]=t},sendUniformData:function(){},createHelpLayer:function(t){if(!t.helpLayer){var e=document.createElement("canvas");e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}},toObject:function(){var t={type:this.type},e=this.mainParameter;return e&&(t[e]=this[e]),t},toJSON:function(){return this.toObject()}}),ec.Image.filters.BaseFilter.fromObject=function(t,e){var i=new ec.Image.filters[t.type](t);return e&&e(i),i},G=(V=(N=e).fabric||(N.fabric={})).Image.filters,q=V.util.createClass,G.ColorMatrix=q(G.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var e,i,r,n,o,a=t.imageData.data,s=a.length,l=this.matrix,c=this.colorsOnly;for(o=0;o<s;o+=4)e=a[o],i=a[o+1],r=a[o+2],c?(a[o]=e*l[0]+i*l[1]+r*l[2]+255*l[4],a[o+1]=e*l[5]+i*l[6]+r*l[7]+255*l[9],a[o+2]=e*l[10]+i*l[11]+r*l[12]+255*l[14]):(n=a[o+3],a[o]=e*l[0]+i*l[1]+r*l[2]+n*l[3]+255*l[4],a[o+1]=e*l[5]+i*l[6]+r*l[7]+n*l[8]+255*l[9],a[o+2]=e*l[10]+i*l[11]+r*l[12]+n*l[13]+255*l[14],a[o+3]=e*l[15]+i*l[16]+r*l[17]+n*l[18]+255*l[19])},getUniformLocations:function(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}},sendUniformData:function(t,e){var i=this.matrix,r=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],n=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,r),t.uniform4fv(e.uConstants,n)}}),V.Image.filters.ColorMatrix.fromObject=V.Image.filters.BaseFilter.fromObject,Z=(J=(K=e).fabric||(K.fabric={})).Image.filters,$=J.util.createClass,Z.Brightness=$(Z.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(0!==this.brightness){var e,i=t.imageData.data,r=i.length,n=Math.round(255*this.brightness);for(e=0;e<r;e+=4)i[e]=i[e]+n,i[e+1]=i[e+1]+n,i[e+2]=i[e+2]+n}},getUniformLocations:function(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}},sendUniformData:function(t,e){t.uniform1f(e.uBrightness,this.brightness)}}),J.Image.filters.Brightness.fromObject=J.Image.filters.BaseFilter.fromObject,te=(tt=(Q=e).fabric||(Q.fabric={})).util.object.extend,ti=tt.Image.filters,tr=tt.util.createClass,ti.Convolute=tr(ti.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(t){var e=Math.sqrt(this.matrix.length),i=this.type+"_"+e+"_"+(this.opaque?1:0),r=this.fragmentSource[i];return t.programCache.hasOwnProperty(i)||(t.programCache[i]=this.createProgram(t.context,r)),t.programCache[i]},applyTo2d:function(t){var e,i,r,n,o,a,s,l,c,h,u,f,d,g=t.imageData,p=g.data,v=this.matrix,m=Math.round(Math.sqrt(v.length)),y=Math.floor(m/2),b=g.width,_=g.height,x=t.ctx.createImageData(b,_),C=x.data,w=this.opaque?1:0;for(u=0;u<_;u++)for(h=0;h<b;h++){for(d=0,o=(u*b+h)*4,e=0,i=0,r=0,n=0;d<m;d++)for(f=0;f<m;f++)s=u+d-y,a=h+f-y,s<0||s>=_||a<0||a>=b||(l=(s*b+a)*4,c=v[d*m+f],e+=p[l]*c,i+=p[l+1]*c,r+=p[l+2]*c,w||(n+=p[l+3]*c));C[o]=e,C[o+1]=i,C[o+2]=r,w?C[o+3]=p[o+3]:C[o+3]=n}t.imageData=x},getUniformLocations:function(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}},sendUniformData:function(t,e){t.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return te(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),tt.Image.filters.Convolute.fromObject=tt.Image.filters.BaseFilter.fromObject,ta=(to=(tn=e).fabric||(tn.fabric={})).Image.filters,ts=to.util.createClass,ta.Grayscale=ts(ta.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(t){var e,i,r=t.imageData.data,n=r.length,o=this.mode;for(e=0;e<n;e+=4)"average"===o?i=(r[e]+r[e+1]+r[e+2])/3:"lightness"===o?i=(Math.min(r[e],r[e+1],r[e+2])+Math.max(r[e],r[e+1],r[e+2]))/2:"luminosity"===o&&(i=.21*r[e]+.72*r[e+1]+.07*r[e+2]),r[e]=i,r[e+1]=i,r[e+2]=i},retrieveShader:function(t){var e=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(e)){var i=this.fragmentSource[this.mode];t.programCache[e]=this.createProgram(t.context,i)}return t.programCache[e]},getUniformLocations:function(t,e){return{uMode:t.getUniformLocation(e,"uMode")}},sendUniformData:function(t,e){t.uniform1i(e.uMode,1)},isNeutralState:function(){return!1}}),to.Image.filters.Grayscale.fromObject=to.Image.filters.BaseFilter.fromObject,th=(tc=(tl=e).fabric||(tl.fabric={})).Image.filters,tu=tc.util.createClass,th.Invert=tu(th.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(t){var e,i=t.imageData.data,r=i.length;for(e=0;e<r;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,e){return{uInvert:t.getUniformLocation(e,"uInvert")}},sendUniformData:function(t,e){t.uniform1i(e.uInvert,this.invert)}}),tc.Image.filters.Invert.fromObject=tc.Image.filters.BaseFilter.fromObject,tg=(td=(tf=e).fabric||(tf.fabric={})).util.object.extend,tp=td.Image.filters,tv=td.util.createClass,tp.Noise=tv(tp.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(t){if(0!==this.noise){var e,i,r=t.imageData.data,n=r.length,o=this.noise;for(e=0,n=r.length;e<n;e+=4)i=(.5-Math.random())*o,r[e]+=i,r[e+1]+=i,r[e+2]+=i}},getUniformLocations:function(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}},sendUniformData:function(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())},toObject:function(){return tg(this.callSuper("toObject"),{noise:this.noise})}}),td.Image.filters.Noise.fromObject=td.Image.filters.BaseFilter.fromObject,tb=(ty=(tm=e).fabric||(tm.fabric={})).Image.filters,t_=ty.util.createClass,tb.Pixelate=t_(tb.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(t){var e,i,r,n,o,a,s,l,c,h,u,f=t.imageData,d=f.data,g=f.height,p=f.width;for(i=0;i<g;i+=this.blocksize)for(r=0;r<p;r+=this.blocksize)for(n=d[e=4*i*p+4*r],o=d[e+1],a=d[e+2],s=d[e+3],h=Math.min(i+this.blocksize,g),u=Math.min(r+this.blocksize,p),l=i;l<h;l++)for(c=r;c<u;c++)d[e=4*l*p+4*c]=n,d[e+1]=o,d[e+2]=a,d[e+3]=s},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}},sendUniformData:function(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}),ty.Image.filters.Pixelate.fromObject=ty.Image.filters.BaseFilter.fromObject,tw=(tC=(tx=e).fabric||(tx.fabric={})).util.object.extend,tS=tC.Image.filters,tT=tC.util.createClass,tS.RemoveColor=tT(tS.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(t){var e,i,r,n,o=t.imageData.data,a=255*this.distance,s=new tC.Color(this.color).getSource(),l=[s[0]-a,s[1]-a,s[2]-a],c=[s[0]+a,s[1]+a,s[2]+a];for(e=0;e<o.length;e+=4)i=o[e],r=o[e+1],n=o[e+2],i>l[0]&&r>l[1]&&n>l[2]&&i<c[0]&&r<c[1]&&n<c[2]&&(o[e+3]=0)},getUniformLocations:function(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}},sendUniformData:function(t,e){var i=new tC.Color(this.color).getSource(),r=parseFloat(this.distance),n=[0+i[0]/255-r,0+i[1]/255-r,0+i[2]/255-r,1],o=[i[0]/255+r,i[1]/255+r,i[2]/255+r,1];t.uniform4fv(e.uLow,n),t.uniform4fv(e.uHigh,o)},toObject:function(){return tw(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),tC.Image.filters.RemoveColor.fromObject=tC.Image.filters.BaseFilter.fromObject,function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,r=e.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in n)i[o]=r(i.ColorMatrix,{type:o,matrix:n[o],mainParameter:!1,colorsOnly:!0}),e.Image.filters[o].fromObject=e.Image.filters.BaseFilter.fromObject}(e),tj=(tO=e.fabric).Image.filters,tk=tO.util.createClass,tj.BlendColor=tk(tj.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(t){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[t]+"}\n}"},retrieveShader:function(t){var e,i=this.type+"_"+this.mode;return t.programCache.hasOwnProperty(i)||(e=this.buildSource(this.mode),t.programCache[i]=this.createProgram(t.context,e)),t.programCache[i]},applyTo2d:function(t){var e,i,r,n,o,a,s,l=t.imageData.data,c=l.length,h=1-this.alpha;e=(s=new tO.Color(this.color).getSource())[0]*this.alpha,i=s[1]*this.alpha,r=s[2]*this.alpha;for(var u=0;u<c;u+=4)switch(n=l[u],o=l[u+1],a=l[u+2],this.mode){case"multiply":l[u]=n*e/255,l[u+1]=o*i/255,l[u+2]=a*r/255;break;case"screen":l[u]=255-(255-n)*(255-e)/255,l[u+1]=255-(255-o)*(255-i)/255,l[u+2]=255-(255-a)*(255-r)/255;break;case"add":l[u]=n+e,l[u+1]=o+i,l[u+2]=a+r;break;case"diff":case"difference":l[u]=Math.abs(n-e),l[u+1]=Math.abs(o-i),l[u+2]=Math.abs(a-r);break;case"subtract":l[u]=n-e,l[u+1]=o-i,l[u+2]=a-r;break;case"darken":l[u]=Math.min(n,e),l[u+1]=Math.min(o,i),l[u+2]=Math.min(a,r);break;case"lighten":l[u]=Math.max(n,e),l[u+1]=Math.max(o,i),l[u+2]=Math.max(a,r);break;case"overlay":l[u]=e<128?2*n*e/255:255-2*(255-n)*(255-e)/255,l[u+1]=i<128?2*o*i/255:255-2*(255-o)*(255-i)/255,l[u+2]=r<128?2*a*r/255:255-2*(255-a)*(255-r)/255;break;case"exclusion":l[u]=e+n-2*e*n/255,l[u+1]=i+o-2*i*o/255,l[u+2]=r+a-2*r*a/255;break;case"tint":l[u]=e+n*h,l[u+1]=i+o*h,l[u+2]=r+a*h}},getUniformLocations:function(t,e){return{uColor:t.getUniformLocation(e,"uColor")}},sendUniformData:function(t,e){var i=new tO.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,t.uniform4fv(e.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),tO.Image.filters.BlendColor.fromObject=tO.Image.filters.BaseFilter.fromObject,tF=(tP=e.fabric).Image.filters,tE=tP.util.createClass,tF.BlendImage=tE(tF.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(t){var e=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(e)||(t.programCache[e]=this.createProgram(t.context,i)),t.programCache[e]},applyToWebGL:function(t){var e=t.context,i=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,i,e.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(e,e.TEXTURE1)},createTexture:function(t,e){return t.getCachedTexture(e.cacheKey,e._element)},calculateMatrix:function(){var t=this.image,e=t._element.width,i=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/i,1]},applyTo2d:function(t){var e,i,r,n,o,a,s,l,c,h,u,f=t.imageData,d=t.filterBackend.resources,g=f.data,p=g.length,v=f.width,m=f.height,y=this.image;d.blendImage||(d.blendImage=tP.util.createCanvasElement()),h=(c=d.blendImage).getContext("2d"),c.width!==v||c.height!==m?(c.width=v,c.height=m):h.clearRect(0,0,v,m),h.setTransform(y.scaleX,0,0,y.scaleY,y.left,y.top),h.drawImage(y._element,0,0,v,m),u=h.getImageData(0,0,v,m).data;for(var b=0;b<p;b+=4)switch(o=g[b],a=g[b+1],s=g[b+2],l=g[b+3],e=u[b],i=u[b+1],r=u[b+2],n=u[b+3],this.mode){case"multiply":g[b]=o*e/255,g[b+1]=a*i/255,g[b+2]=s*r/255,g[b+3]=l*n/255;break;case"mask":g[b+3]=n}},getUniformLocations:function(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}},sendUniformData:function(t,e){var i=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),tP.Image.filters.BlendImage.fromObject=function(t,e){tP.Image.fromObject(t.image,function(i){var r=tP.util.object.clone(t);r.image=i,e(new tP.Image.filters.BlendImage(r))})},tM=(tD=e).fabric||(tD.fabric={}),tA=Math.pow,tL=Math.floor,tI=Math.sqrt,tR=Math.abs,tB=Math.round,tX=Math.sin,tY=Math.ceil,tz=tM.Image.filters,tW=tM.util.createClass,tz.Resize=tW(tz.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}},sendUniformData:function(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)},retrieveShader:function(t){var e=this.getFilterWindow(),i=this.type+"_"+e;if(!t.programCache.hasOwnProperty(i)){var r=this.generateShader(e);t.programCache[i]=this.createProgram(t.context,r)}return t.programCache[i]},getFilterWindow:function(){var t=this.tempScale;return Math.ceil(this.lanczosLobes/t)},getTaps:function(){for(var t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,i=this.getFilterWindow(),r=Array(i),n=1;n<=i;n++)r[n-1]=t(n*e);return r},generateShader:function(t){for(var e=Array(t),i=this.fragmentSourceTOP,r=1;r<=t;r++)e[r-1]=r+".0 * uDelta";return i+="uniform float uTaps["+t+"];\nvoid main() {\n  vec4 color = texture2D(uTexture, vTexCoord);\n  float sum = 1.0;\n",e.forEach(function(t,e){i+="  color += texture2D(uTexture, vTexCoord + "+t+") * uTaps["+e+"];\n"+("  color += texture2D(uTexture, vTexCoord - "+t+") * uTaps[")+e+"];\n  sum += 2.0 * uTaps["+e+"];\n"}),i+="  gl_FragColor = color / sum;\n}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(t){t.webgl?(t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceHeight=t.destinationHeight):this.applyTo2d(t)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(t){return function(e){if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-.00000011920929)return 1;var i=(e*=Math.PI)/t;return tX(e)/e*tX(i)/i}},applyTo2d:function(t){var e=t.imageData,i=this.scaleX,r=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/r;var n,o=e.width,a=e.height,s=tB(o*i),l=tB(a*r);"sliceHack"===this.resizeType?n=this.sliceByTwo(t,o,a,s,l):"hermite"===this.resizeType?n=this.hermiteFastResize(t,o,a,s,l):"bilinear"===this.resizeType?n=this.bilinearFiltering(t,o,a,s,l):"lanczos"===this.resizeType&&(n=this.lanczosResize(t,o,a,s,l)),t.imageData=n},sliceByTwo:function(t,e,i,r,n){var o,a,s=t.imageData,l=!1,c=!1,h=.5*e,u=.5*i,f=tM.filterBackend.resources,d=0,g=0,p=e,v=0;for(f.sliceByTwo||(f.sliceByTwo=document.createElement("canvas")),((o=f.sliceByTwo).width<1.5*e||o.height<i)&&(o.width=1.5*e,o.height=i),(a=o.getContext("2d")).clearRect(0,0,1.5*e,i),a.putImageData(s,0,0),r=tL(r),n=tL(n);!l||!c;)e=h,i=u,r<tL(.5*h)?h=tL(.5*h):(h=r,l=!0),n<tL(.5*u)?u=tL(.5*u):(u=n,c=!0),a.drawImage(o,d,g,e,i,p,v,h,u),d=p,g=v,v+=u;return a.getImageData(d,g,r,n)},lanczosResize:function(t,e,i,r,n){var o=t.imageData.data,a=t.ctx.createImageData(r,n),s=a.data,l=this.lanczosCreate(this.lanczosLobes),c=this.rcpScaleX,h=this.rcpScaleY,u=2/this.rcpScaleX,f=2/this.rcpScaleY,d=tY(c*this.lanczosLobes/2),g=tY(h*this.lanczosLobes/2),p={},v={},m={};return function t(y){var b,_,x,C,w,S,T,O,j,k,P;for(b=0,v.x=(y+.5)*c,m.x=tL(v.x);b<n;b++){for(v.y=(b+.5)*h,m.y=tL(v.y),w=0,S=0,T=0,O=0,j=0,_=m.x-d;_<=m.x+d;_++)if(!(_<0)&&!(_>=e)){p[k=tL(1e3*tR(_-v.x))]||(p[k]={});for(var F=m.y-g;F<=m.y+g;F++)F<0||F>=i||(P=tL(1e3*tR(F-v.y)),p[k][P]||(p[k][P]=l(tI(tA(k*u,2)+tA(P*f,2))/1e3)),(x=p[k][P])>0&&(C=(F*e+_)*4,w+=x,S+=x*o[C],T+=x*o[C+1],O+=x*o[C+2],j+=x*o[C+3]))}s[C=(b*r+y)*4]=S/w,s[C+1]=T/w,s[C+2]=O/w,s[C+3]=j/w}return++y<r?t(y):a}(0)},bilinearFiltering:function(t,e,i,r,n){var o,a,s,l,c,h,u,f,d,g,p=0,v=this.rcpScaleX,m=this.rcpScaleY,y=4*(e-1),b=t.imageData.data,_=t.ctx.createImageData(r,n),x=_.data;for(l=0;l<n;l++)for(c=0;c<r;c++)for(f=0,a=tL(v*c),s=tL(m*l),h=v*c-a,u=m*l-s,g=4*(s*e+a);f<4;f++)o=b[g+f],d=o*(1-h)*(1-u)+b[g+4+f]*h*(1-u)+b[g+y+f]*u*(1-h)+b[g+y+4+f]*h*u,x[p++]=d;return _},hermiteFastResize:function(t,e,i,r,n){for(var o=this.rcpScaleX,a=this.rcpScaleY,s=tY(o/2),l=tY(a/2),c=t.imageData.data,h=t.ctx.createImageData(r,n),u=h.data,f=0;f<n;f++)for(var d=0;d<r;d++){for(var g=(d+f*r)*4,p=0,v=0,m=0,y=0,b=0,_=0,x=0,C=(f+.5)*a,w=tL(f*a);w<(f+1)*a;w++)for(var S=tR(C-(w+.5))/l,T=(d+.5)*o,O=S*S,j=tL(d*o);j<(d+1)*o;j++){var k=tR(T-(j+.5))/s,P=tI(O+k*k);P>1&&P<-1||!((p=2*P*P*P-3*P*P+1)>0)||(x+=p*c[(k=4*(j+w*e))+3],m+=p,c[k+3]<255&&(p=p*c[k+3]/250),y+=p*c[k],b+=p*c[k+1],_+=p*c[k+2],v+=p)}u[g]=y/v,u[g+1]=b/v,u[g+2]=_/v,u[g+3]=x/m}return h},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),tM.Image.filters.Resize.fromObject=tM.Image.filters.BaseFilter.fromObject,tN=(tU=(tH=e).fabric||(tH.fabric={})).Image.filters,tV=tU.util.createClass,tN.Contrast=tV(tN.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(0!==this.contrast){var e,i,r=t.imageData.data,i=r.length,n=Math.floor(255*this.contrast),o=259*(n+255)/(255*(259-n));for(e=0;e<i;e+=4)r[e]=o*(r[e]-128)+128,r[e+1]=o*(r[e+1]-128)+128,r[e+2]=o*(r[e+2]-128)+128}},getUniformLocations:function(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}},sendUniformData:function(t,e){t.uniform1f(e.uContrast,this.contrast)}}),tU.Image.filters.Contrast.fromObject=tU.Image.filters.BaseFilter.fromObject,tK=(tq=(tG=e).fabric||(tG.fabric={})).Image.filters,tJ=tq.util.createClass,tK.Saturation=tJ(tK.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(0!==this.saturation){var e,i,r=t.imageData.data,n=r.length,o=-this.saturation;for(e=0;e<n;e+=4)i=Math.max(r[e],r[e+1],r[e+2]),r[e]+=i!==r[e]?(i-r[e])*o:0,r[e+1]+=i!==r[e+1]?(i-r[e+1])*o:0,r[e+2]+=i!==r[e+2]?(i-r[e+2])*o:0}},getUniformLocations:function(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}},sendUniformData:function(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}),tq.Image.filters.Saturation.fromObject=tq.Image.filters.BaseFilter.fromObject,tQ=(t$=(tZ=e).fabric||(tZ.fabric={})).Image.filters,t0=t$.util.createClass,tQ.Blur=t0(tQ.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var e,i,r=t.filterBackend.resources,n=t.imageData.width,o=t.imageData.height;r.blurLayer1||(r.blurLayer1=t$.util.createCanvasElement(),r.blurLayer2=t$.util.createCanvasElement()),e=r.blurLayer1,i=r.blurLayer2,(e.width!==n||e.height!==o)&&(i.width=e.width=n,i.height=e.height=o);var a,s,l,c,h=e.getContext("2d"),u=i.getContext("2d"),f=.03*this.blur;for(h.putImageData(t.imageData,0,0),u.clearRect(0,0,n,o),c=-15;c<=15;c++)a=(Math.random()-.5)/4,l=f*(s=c/15)*n+a,u.globalAlpha=1-Math.abs(s),u.drawImage(e,l,a),h.drawImage(i,0,0),u.globalAlpha=1,u.clearRect(0,0,i.width,i.height);for(c=-15;c<=15;c++)a=(Math.random()-.5)/4,l=f*(s=c/15)*o+a,u.globalAlpha=1-Math.abs(s),u.drawImage(e,a,l),h.drawImage(i,0,0),u.globalAlpha=1,u.clearRect(0,0,i.width,i.height);t.ctx.drawImage(e,0,0);var d=t.ctx.getImageData(0,0,e.width,e.height);return h.globalAlpha=1,h.clearRect(0,0,e.width,e.height),d},getUniformLocations:function(t,e){return{delta:t.getUniformLocation(e,"uDelta")}},sendUniformData:function(t,e){var i=this.chooseRightDelta();t.uniform2fv(e.delta,i)},chooseRightDelta:function(){var t,e=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(e=1/this.aspectRatio):this.aspectRatio<1&&(e=this.aspectRatio),t=e*this.blur*.12,this.horizontal?i[0]=t:i[1]=t,i}}),tQ.Blur.fromObject=t$.Image.filters.BaseFilter.fromObject,t5=(t2=(t1=e).fabric||(t1.fabric={})).Image.filters,t3=t2.util.createClass,t5.Gamma=t3(t5.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],t5.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var e,i=t.imageData.data,r=this.gamma,n=i.length,o=1/r[0],a=1/r[1],s=1/r[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),e=0,n=256;e<n;e++)this.rVals[e]=255*Math.pow(e/255,o),this.gVals[e]=255*Math.pow(e/255,a),this.bVals[e]=255*Math.pow(e/255,s);for(e=0,n=i.length;e<n;e+=4)i[e]=this.rVals[i[e]],i[e+1]=this.gVals[i[e+1]],i[e+2]=this.bVals[i[e+2]]},getUniformLocations:function(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}},sendUniformData:function(t,e){t.uniform3fv(e.uGamma,this.gamma)}}),t2.Image.filters.Gamma.fromObject=t2.Image.filters.BaseFilter.fromObject,t6=(t8=(t4=e).fabric||(t4.fabric={})).Image.filters,t9=t8.util.createClass,t6.Composed=t9(t6.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(e){e.applyTo(t)})},toObject:function(){return t8.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(t){return!t.isNeutralState()})}}),t8.Image.filters.Composed.fromObject=function(t,e){var i=(t.subFilters||[]).map(function(t){return new t8.Image.filters[t.type](t)}),r=new t8.Image.filters.Composed({subFilters:i});return e&&e(r),r},ee=(et=(t7=e).fabric||(t7.fabric={})).Image.filters,ei=et.util.createClass,ee.HueRotation=ei(ee.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,e=et.util.cos(t),i=et.util.sin(t),r=1/3,n=Math.sqrt(1/3)*i,o=1-e;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=e+o/3,this.matrix[1]=r*o-n,this.matrix[2]=r*o+n,this.matrix[5]=r*o+n,this.matrix[6]=e+r*o,this.matrix[7]=r*o-n,this.matrix[10]=r*o-n,this.matrix[11]=r*o+n,this.matrix[12]=e+r*o},isNeutralState:function(t){return this.calculateMatrix(),ee.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),ee.BaseFilter.prototype.applyTo.call(this,t)}}),et.Image.filters.HueRotation.fromObject=et.Image.filters.BaseFilter.fromObject,function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;if(e.Text){e.warn("fabric.Text is already defined");return}var r="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat(r),cacheProperties:e.Object.prototype.cacheProperties.concat(r),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(t,e){this.styles=e&&e.styles||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var t=this.path;t&&(t.segmentsInfo=e.util.getPathSegmentsInfo(t.path))},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var t,e,i,r,n,o,a,s=0,l=this._textLines.length;s<l;s++)if(!("justify"!==this.textAlign&&(s===l-1||this.isEndOfWrapping(s)))&&(r=0,n=this._textLines[s],(e=this.getLineWidth(s))<this.width&&(a=this.textLines[s].match(this._reSpacesAndTabs)))){i=a.length,t=(this.width-e)/i;for(var c=0,h=n.length;c<=h;c++)o=this.__charBounds[s][c],this._reSpaceAndTab.test(n[c])?(o.width+=t,o.kernedWidth+=t,o.left+=r,r+=t):o.left+=r}},isEndOfWrapping:function(t){return t===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions"),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t},_render:function(t){var e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")},_renderText:function(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))},_setTextStyles:function(t,e,i){if(t.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":t.textBaseline="middle";break;case"ascender":t.textBaseline="top";break;case"descender":t.textBaseline="bottom"}t.font=this._getFontDeclaration(e,i)},calcTextWidth:function(){for(var t=this.getLineWidth(0),e=1,i=this._textLines.length;e<i;e++){var r=this.getLineWidth(e);r>t&&(t=r)}return t},_renderTextLine:function(t,e,i,r,n,o){this._renderChars(t,e,i,r,n,o)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e,i,r,n,o,a,s,l=t.fillStyle,c=this._getLeftOffset(),h=this._getTopOffset(),u=0,f=0,d=this.path,g=0,p=this._textLines.length;g<p;g++){if(e=this.getHeightOfLine(g),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",g)){h+=e;continue}r=this._textLines[g],i=this._getLineLeftOffset(g),f=0,u=0,n=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(var v=0,m=r.length;v<m;v++)o=this.__charBounds[g][v],a=this.getValueOfPropertyAt(g,v,"textBackgroundColor"),d?(t.save(),t.translate(o.renderLeft,o.renderTop),t.rotate(o.angle),t.fillStyle=a,a&&t.fillRect(-o.width/2,-e/this.lineHeight*(1-this._fontSizeFraction),o.width,e/this.lineHeight),t.restore()):a!==n?(s=c+i+u,"rtl"===this.direction&&(s=this.width-s-f),t.fillStyle=n,n&&t.fillRect(s,h,f,e/this.lineHeight),u=o.left,f=o.width,n=a):f+=o.kernedWidth;a&&!d&&(s=c+i+u,"rtl"===this.direction&&(s=this.width-s-f),t.fillStyle=a,t.fillRect(s,h,f,e/this.lineHeight)),h+=e}t.fillStyle=l,this._removeShadow(t)}},getFontCache:function(t){var i=t.fontFamily.toLowerCase();e.charWidthsCache[i]||(e.charWidthsCache[i]={});var r=e.charWidthsCache[i],n=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return r[n]||(r[n]={}),r[n]},_measureChar:function(t,e,i,r){var n,o,a,s,l=this.getFontCache(e),c=this._getFontDeclaration(e),h=this._getFontDeclaration(r),u=i+t,f=c===h,d=e.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==l[i]&&(a=l[i]),void 0!==l[t]&&(s=n=l[t]),f&&void 0!==l[u]&&(s=(o=l[u])-a),void 0===n||void 0===a||void 0===o){var g=this.getMeasuringContext();this._setTextStyles(g,e,!0)}return void 0===n&&(s=n=g.measureText(t).width,l[t]=n),void 0===a&&f&&i&&(a=g.measureText(i).width,l[i]=a),f&&void 0===o&&(o=g.measureText(u).width,l[u]=o,s=o-a),{width:n*d,kernedWidth:s*d}},getHeightOfChar:function(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")},measureLine:function(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e},_measureLine:function(t){var i,r,n,o,a,s,l=0,c=this._textLines[t],h=Array(c.length),u=0,f=this.path,d="right"===this.pathSide;for(i=0,this.__charBounds[t]=h;i<c.length;i++)r=c[i],o=this._getGraphemeBox(r,t,i,n),h[i]=o,l+=o.kernedWidth,n=r;if(h[i]={left:o?o.left+o.width:0,width:0,kernedWidth:0,height:this.fontSize},f){switch(s=f.segmentsInfo[f.segmentsInfo.length-1].length,a=e.util.getPointOnPath(f.path,0,f.segmentsInfo),a.x+=f.pathOffset.x,a.y+=f.pathOffset.y,this.textAlign){case"left":u=d?s-l:0;break;case"center":u=(s-l)/2;break;case"right":u=d?0:s-l}for(u+=this.pathStartOffset*(d?-1:1),i=d?c.length-1:0;d?i>=0:i<c.length;d?i--:i++)o=h[i],u>s?u%=s:u<0&&(u+=s),this._setGraphemeOnPath(u,o,a),u+=o.kernedWidth}return{width:l,numOfSpaces:0}},_setGraphemeOnPath:function(t,i,r){var n=t+i.kernedWidth/2,o=this.path,a=e.util.getPointOnPath(o.path,n,o.segmentsInfo);i.renderLeft=a.x-r.x,i.renderTop=a.y-r.y,i.angle=a.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(t,e,i,r,n){var o,a=this.getCompleteStyleDeclaration(e,i),s=r?this.getCompleteStyleDeclaration(e,i-1):{},l=this._measureChar(t,a,r,s),c=l.kernedWidth,h=l.width;0!==this.charSpacing&&(h+=o=this._getWidthOfCharSpacing(),c+=o);var u={width:h,left:0,height:a.fontSize,kernedWidth:c,deltaY:a.deltaY};if(i>0&&!n){var f=this.__charBounds[e][i-1];u.left=f.left+f.width+l.kernedWidth-l.width}return u},getHeightOfLine:function(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var e=this._textLines[t],i=this.getHeightOfChar(t,0),r=1,n=e.length;r<n;r++)i=Math.max(this.getHeightOfChar(t,r),i);return this.__lineHeights[t]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var t,e=0,i=0,r=this._textLines.length;i<r;i++)t=this.getHeightOfLine(i),e+=i===r-1?t/this.lineHeight:t;return e},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(t,e){t.save();for(var i=0,r=this._getLeftOffset(),n=this._getTopOffset(),o=0,a=this._textLines.length;o<a;o++){var s=this.getHeightOfLine(o),l=s/this.lineHeight,c=this._getLineLeftOffset(o);this._renderTextLine(e,t,this._textLines[o],r+c,n+i+l,o),i+=s}t.restore()},_renderTextFill:function(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(!this.stroke||0===this.strokeWidth)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_renderChars:function(t,i,r,n,o,a){var s,l,c,h,u,f=this.getHeightOfLine(a),d=-1!==this.textAlign.indexOf("justify"),g="",p=0,v=this.path,m=!d&&0===this.charSpacing&&this.isEmptyStyles(a)&&!v,y="ltr"===this.direction,b="ltr"===this.direction?1:-1,_=i.canvas.getAttribute("dir");if(i.save(),_!==this.direction&&(i.canvas.setAttribute("dir",y?"ltr":"rtl"),i.direction=y?"ltr":"rtl",i.textAlign=y?"left":"right"),o-=f*this._fontSizeFraction/this.lineHeight,m){this._renderChar(t,i,a,0,r.join(""),n,o,f),i.restore();return}for(var x=0,C=r.length-1;x<=C;x++)h=x===C||this.charSpacing||v,g+=r[x],c=this.__charBounds[a][x],0===p?(n+=b*(c.kernedWidth-c.width),p+=c.width):p+=c.kernedWidth,d&&!h&&this._reSpaceAndTab.test(r[x])&&(h=!0),h||(s=s||this.getCompleteStyleDeclaration(a,x),l=this.getCompleteStyleDeclaration(a,x+1),h=e.util.hasStyleChanged(s,l,!1)),h&&(v?(i.save(),i.translate(c.renderLeft,c.renderTop),i.rotate(c.angle),this._renderChar(t,i,a,x,g,-p/2,0,f),i.restore()):(u=n,this._renderChar(t,i,a,x,g,u,o,f)),g="",s=l,n+=b*p,p=0);i.restore()},_applyPatternGradientTransformText:function(t){var i,r=e.util.createCanvasElement(),n=this.width+this.strokeWidth,o=this.height+this.strokeWidth;return r.width=n,r.height=o,(i=r.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(n,0),i.lineTo(n,o),i.lineTo(0,o),i.closePath(),i.translate(n/2,o/2),i.fillStyle=t.toLive(i),this._applyPatternGradientTransform(i,t),i.fill(),i.createPattern(r,"no-repeat")},handleFiller:function(t,e,i){var r,n;return i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?(r=-this.width/2,n=-this.height/2,t.translate(r,n),t[e]=this._applyPatternGradientTransformText(i),{offsetX:r,offsetY:n}):(t[e]=i.toLive(t,this),this._applyPatternGradientTransform(t,i)):(t[e]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(t,e){return t.lineWidth=e.strokeWidth,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",e.stroke)},_setFillStyles:function(t,e){return this.handleFiller(t,"fillStyle",e.fill)},_renderChar:function(t,e,i,r,n,o,a){var s,l,c=this._getStyleDeclaration(i,r),h=this.getCompleteStyleDeclaration(i,r),u="fillText"===t&&h.fill,f="strokeText"===t&&h.stroke&&h.strokeWidth;(f||u)&&(e.save(),u&&(s=this._setFillStyles(e,h)),f&&(l=this._setStrokeStyles(e,h)),e.font=this._getFontDeclaration(h),c&&c.textBackgroundColor&&this._removeShadow(e),c&&c.deltaY&&(a+=c.deltaY),u&&e.fillText(n,o-s.offsetX,a-s.offsetY),f&&e.strokeText(n,o-l.offsetX,a-l.offsetY),e.restore())},setSuperscript:function(t,e){return this._setScript(t,e,this.superscript)},setSubscript:function(t,e){return this._setScript(t,e,this.subscript)},_setScript:function(t,e,i){var r=this.get2DCursorLocation(t,!0),n=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),o=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),a={fontSize:n*i.size,deltaY:o+n*i.baseline};return this.setSelectionStyles(a,t,e),this},_getLineLeftOffset:function(t){var e,i=this.getLineWidth(t),r=this.width-i,n=this.textAlign,o=this.direction,a=0,e=this.isEndOfWrapping(t);return"justify"!==n&&("justify-center"!==n||e)&&("justify-right"!==n||e)&&("justify-left"!==n||e)?("center"===n&&(a=r/2),"right"===n&&(a=r),"justify-center"===n&&(a=r/2),"justify-right"===n&&(a=r),"rtl"===o&&(a-=r),a):0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t},getLineWidth:function(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];var e=this.measureLine(t).width;return this.__lineWidths[t]=e,e},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(t,e,i){var r=this._getStyleDeclaration(t,e);return r&&void 0!==r[i]?r[i]:this[i]},_renderTextDecoration:function(t,e){if(this[e]||this.styleHas(e)){for(var i,r,n,o,a,s,l,c,h,u,f,d,g,p,v,m,y=this._getLeftOffset(),b=this._getTopOffset(),_=this.path,x=this._getWidthOfCharSpacing(),C=this.offsets[e],w=0,S=this._textLines.length;w<S;w++){if(i=this.getHeightOfLine(w),!this[e]&&!this.styleHas(e,w)){b+=i;continue}l=this._textLines[w],p=i/this.lineHeight,o=this._getLineLeftOffset(w),u=0,f=0,c=this.getValueOfPropertyAt(w,0,e),m=this.getValueOfPropertyAt(w,0,"fill"),h=b+p*(1-this._fontSizeFraction),r=this.getHeightOfChar(w,0),a=this.getValueOfPropertyAt(w,0,"deltaY");for(var T=0,O=l.length;T<O;T++)if(d=this.__charBounds[w][T],g=this.getValueOfPropertyAt(w,T,e),v=this.getValueOfPropertyAt(w,T,"fill"),n=this.getHeightOfChar(w,T),s=this.getValueOfPropertyAt(w,T,"deltaY"),_&&g&&v)t.save(),t.fillStyle=m,t.translate(d.renderLeft,d.renderTop),t.rotate(d.angle),t.fillRect(-d.kernedWidth/2,C*n+s,d.kernedWidth,this.fontSize/15),t.restore();else if((g!==c||v!==m||n!==r||s!==a)&&f>0){var j=y+o+u;"rtl"===this.direction&&(j=this.width-j-f),c&&m&&(t.fillStyle=m,t.fillRect(j,h+C*r+a,f,this.fontSize/15)),u=d.left,f=d.width,c=g,m=v,r=n,a=s}else f+=d.kernedWidth;var j=y+o+u;"rtl"===this.direction&&(j=this.width-j-f),t.fillStyle=v,g&&v&&t.fillRect(j,h+C*r+a,f-x,this.fontSize/15),b+=i}this._removeShadow(t)}},_getFontDeclaration:function(t,i){var r=t||this,n=this.fontFamily,o=e.Text.genericFonts.indexOf(n.toLowerCase())>-1,a=void 0===n||n.indexOf("'")>-1||n.indexOf(",")>-1||n.indexOf('"')>-1||o?r.fontFamily:'"'+r.fontFamily+'"';return[e.isLikelyNode?r.fontWeight:r.fontStyle,e.isLikelyNode?r.fontStyle:r.fontWeight,i?this.CACHE_FONT_SIZE+"px":r.fontSize+"px",a].join(" ")},render:function(t){this.visible&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",t))},_splitTextIntoLines:function(t){for(var i=t.split(this._reNewline),r=Array(i.length),n=["\n"],o=[],a=0;a<i.length;a++)r[a]=e.util.string.graphemeSplit(i[a]),o=o.concat(r[a],n);return o.pop(),{_unwrappedLines:r,lines:i,graphemeText:o,graphemeLines:r}},toObject:function(t){var i=r.concat(t),n=this.callSuper("toObject",i);return n.styles=e.util.stylesToArray(this.styles,this.text),n.path&&(n.path=this.path.toObject()),n},set:function(t,e){this.callSuper("set",t,e);var i=!1,r=!1;if("object"==typeof t)for(var n in t)"path"===n&&this.setPathInfo(),i=i||-1!==this._dimensionAffectingProps.indexOf(n),r=r||"path"===n;else i=-1!==this._dimensionAffectingProps.indexOf(t),r="path"===t;return r&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.fromObject=function(t,r){var n=i(t),o=t.path;return delete n.path,e.Object._fromObject("Text",n,function(i){i.styles=e.util.stylesFromArray(t.styles,t.text),o?e.Object._fromObject("Path",o,function(t){i.set("path",t),r(i)},"path"):r(i)},"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}(e),ec.util.object.extend(ec.Text.prototype,{isEmptyStyles:function(t){if(!this.styles||void 0!==t&&!this.styles[t])return!0;var e=void 0===t?this.styles:{line:this.styles[t]};for(var i in e)for(var r in e[i])for(var n in e[i][r])return!1;return!0},styleHas:function(t,e){if(!this.styles||!t||""===t||void 0!==e&&!this.styles[e])return!1;var i=void 0===e?this.styles:{0:this.styles[e]};for(var r in i)for(var n in i[r])if(void 0!==i[r][n][t])return!0;return!1},cleanStyle:function(t){if(!this.styles||!t||""===t)return!1;var e,i,r,n=this.styles,o=0,a=!0,s=0;for(var l in n){for(var c in e=0,n[l]){var r=n[l][c],h=r.hasOwnProperty(t);o++,h?(i?r[t]!==i&&(a=!1):i=r[t],r[t]===this[t]&&delete r[t]):a=!1,0!==Object.keys(r).length?e++:delete n[l][c]}0===e&&delete n[l]}for(var u=0;u<this._textLines.length;u++)s+=this._textLines[u].length;a&&o===s&&(this[t]=i,this.removeStyle(t))},removeStyle:function(t){if(this.styles&&t&&""!==t){var e,i,r,n=this.styles;for(i in n){for(r in e=n[i])delete e[r][t],0===Object.keys(e[r]).length&&delete e[r];0===Object.keys(e).length&&delete n[i]}}},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),ec.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},get2DCursorLocation:function(t,e){void 0===t&&(t=this.selectionStart);for(var i=e?this._unwrappedTextLines:this._textLines,r=i.length,n=0;n<r;n++){if(t<=i[n].length)return{lineIndex:n,charIndex:t};t-=i[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:i[n-1].length<t?i[n-1].length:t}},getSelectionStyles:function(t,e,i){void 0===t&&(t=this.selectionStart||0),void 0===e&&(e=this.selectionEnd||t);for(var r=[],n=t;n<e;n++)r.push(this.getStyleAtPosition(n,i));return r},getStyleAtPosition:function(t,e){var i=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(t,e,i){void 0===e&&(e=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||e);for(var r=e;r<i;r++)this._extendStyles(r,t);return this._forceClearCache=!0,this},_getStyleDeclaration:function(t,e){var i=this.styles&&this.styles[t];return i?i[e]:null},getCompleteStyleDeclaration:function(t,e){for(var i,r=this._getStyleDeclaration(t,e)||{},n={},o=0;o<this._styleProperties.length;o++)n[i=this._styleProperties[o]]=void 0===r[i]?this[i]:r[i];return n},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return!!this.styles[t]},_setLineStyle:function(t){this.styles[t]={}},_deleteLineStyle:function(t){delete this.styles[t]}}),function(){var t=ec.controlsUtils,e=t.scaleSkewCursorStyleHandler,i=t.scaleCursorStyleHandler,r=t.scalingEqually,n=t.scalingYOrSkewingX,o=t.scalingXOrSkewingY,a=t.scaleOrSkewActionName,s=ec.Object.prototype.controls;if(s.ml=new ec.Control({x:-.5,y:0,cursorStyleHandler:e,actionHandler:o,getActionName:a}),s.mr=new ec.Control({x:.5,y:0,cursorStyleHandler:e,actionHandler:o,getActionName:a}),s.mb=new ec.Control({x:0,y:.5,cursorStyleHandler:e,actionHandler:n,getActionName:a}),s.mt=new ec.Control({x:0,y:-.5,cursorStyleHandler:e,actionHandler:n,getActionName:a}),s.tl=new ec.Control({x:-.5,y:-.5,cursorStyleHandler:i,actionHandler:r}),s.tr=new ec.Control({x:.5,y:-.5,cursorStyleHandler:i,actionHandler:r}),s.bl=new ec.Control({x:-.5,y:.5,cursorStyleHandler:i,actionHandler:r}),s.br=new ec.Control({x:.5,y:.5,cursorStyleHandler:i,actionHandler:r}),s.mtr=new ec.Control({x:0,y:-.5,actionHandler:t.rotationWithSnapping,cursorStyleHandler:t.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),ec.Textbox){var l=ec.Textbox.prototype.controls={};l.mtr=s.mtr,l.tr=s.tr,l.br=s.br,l.tl=s.tl,l.bl=s.bl,l.mt=s.mt,l.mb=s.mb,l.mr=new ec.Control({x:.5,y:0,actionHandler:t.changeWidth,cursorStyleHandler:e,actionName:"resizing"}),l.ml=new ec.Control({x:-.5,y:0,actionHandler:t.changeWidth,cursorStyleHandler:e,actionName:"resizing"})}}(),ec.Object.ENLIVEN_PROPS.push("eraser"),er=ec.Object.prototype._drawClipPath,en=ec.Object.prototype.needsItsOwnCache,eo=ec.Object.prototype.toObject,ec.Object.prototype.getSvgCommons,ec.Object.prototype._createBaseClipPathSVGMarkup,ec.Object.prototype._createBaseSVGMarkup,ec.Object.prototype.cacheProperties.push("eraser"),ec.Object.prototype.stateProperties.push("eraser"),ec.util.object.extend(ec.Object.prototype,{erasable:!0,eraser:void 0,needsItsOwnCache:function(){return en.call(this)||!!this.eraser},_drawClipPath:function(t,e){if(er.call(this,t,e),this.eraser){var i=this._getNonTransformedDimensions();this.eraser.isType("eraser")&&this.eraser.set({width:i.x,height:i.y}),er.call(this,t,this.eraser)}},toObject:function(t){var e=eo.call(this,["erasable"].concat(t));return this.eraser&&!this.eraser.excludeFromExport&&(e.eraser=this.eraser.toObject(t)),e}}),ea=ec.Group.prototype._restoreObjectsState,ec.util.object.extend(ec.Group.prototype,{_addEraserPathToObjects:function(t){this._objects.forEach(function(e){ec.EraserBrush.prototype._addPathToObjectEraser.call(ec.EraserBrush.prototype,e,t)})},applyEraserToObjects:function(){var t=this,e=this.eraser;if(e){delete this.eraser;var i=t.calcTransformMatrix();e.clone(function(e){var r=t.clipPath;e.getObjects("path").forEach(function(e){var n=ec.util.multiplyTransformMatrices(i,e.calcTransformMatrix());ec.util.applyTransformToObject(e,n),r?r.clone(function(r){var n=ec.EraserBrush.prototype.applyClipPathToPath.call(ec.EraserBrush.prototype,e,r,i);t._addEraserPathToObjects(n)},["absolutePositioned","inverted"]):t._addEraserPathToObjects(e)})})}},_restoreObjectsState:function(){return!0===this.erasable&&this.applyEraserToObjects(),ea.call(this)}}),ec.Eraser=ec.util.createClass(ec.Group,{type:"eraser",originX:"center",originY:"center",drawObject:function(t){t.save(),t.fillStyle="black",t.fillRect(-this.width/2,-this.height/2,this.width,this.height),t.restore(),this.callSuper("drawObject",t)},_getBounds:function(){}}),ec.Eraser.fromObject=function(t,e){var i=t.objects;ec.util.enlivenObjects(i,function(i){var r=ec.util.object.clone(t,!0);delete r.objects,ec.util.enlivenObjectEnlivables(t,r,function(){e&&e(new ec.Eraser(i,r,!0))})})},es=ec.Canvas.prototype._renderOverlay,ec.util.object.extend(ec.Canvas.prototype,{isErasing:function(){return this.isDrawingMode&&this.freeDrawingBrush&&"eraser"===this.freeDrawingBrush.type&&this.freeDrawingBrush._isErasing},_renderOverlay:function(t){es.call(this,t),this.isErasing()&&!this.freeDrawingBrush.inverted&&this.freeDrawingBrush._render()}}),ec.EraserBrush=ec.util.createClass(ec.PencilBrush,{type:"eraser",inverted:!1,_isErasing:!1,_isErasable:function(t){return!1!==t.erasable},_prepareCollectionTraversal:function(t,e,i){t.forEachObject(function(r){r.forEachObject&&"deep"===r.erasable?this._prepareCollectionTraversal(r,e,i):!this.inverted&&r.erasable&&r.visible?(r.visible=!1,t.dirty=!0,i.visibility.push(r),i.collection.push(t)):this.inverted&&r.visible&&(r.erasable&&r.eraser?(r.eraser.inverted=!0,r.dirty=!0,t.dirty=!0,i.eraser.push(r),i.collection.push(t)):(r.visible=!1,t.dirty=!0,i.visibility.push(r),i.collection.push(t)))},this)},preparePattern:function(){this._patternCanvas||(this._patternCanvas=ec.util.createCanvasElement());var t=this._patternCanvas;t.width=this.canvas.width,t.height=this.canvas.height;var e=t.getContext("2d");if(this.canvas._isRetinaScaling()){var i=this.canvas.getRetinaScaling();this.canvas.__initRetinaScaling(i,t,e)}var r=this.canvas.backgroundImage,n=r&&this._isErasable(r),o=this.canvas.overlayImage,a=o&&this._isErasable(o);if(!this.inverted&&(r&&!n||this.canvas.backgroundColor))n&&(this.canvas.backgroundImage=void 0),this.canvas._renderBackground(e),n&&(this.canvas.backgroundImage=r);else if(this.inverted&&r&&n){var s=this.canvas.backgroundColor;this.canvas.backgroundColor=void 0,this.canvas._renderBackground(e),this.canvas.backgroundColor=s}e.save(),e.transform.apply(e,this.canvas.viewportTransform);var l={visibility:[],eraser:[],collection:[]};if(this._prepareCollectionTraversal(this.canvas,e,l),this.canvas._renderObjects(e,this.canvas._objects),l.visibility.forEach(function(t){t.visible=!0}),l.eraser.forEach(function(t){t.eraser.inverted=!1,t.dirty=!0}),l.collection.forEach(function(t){t.dirty=!0}),e.restore(),!this.inverted&&(o&&!a||this.canvas.overlayColor))a&&(this.canvas.overlayImage=void 0),es.call(this.canvas,e),a&&(this.canvas.overlayImage=o);else if(this.inverted&&o&&a){var s=this.canvas.overlayColor;this.canvas.overlayColor=void 0,es.call(this.canvas,e),this.canvas.overlayColor=s}},_setBrushStyles:function(t){this.callSuper("_setBrushStyles",t),t.strokeStyle="black"},_saveAndTransform:function(t){this.callSuper("_saveAndTransform",t),this._setBrushStyles(t),t.globalCompositeOperation=t===this.canvas.getContext()?"destination-out":"source-over"},needsFullRender:function(){return!0},onMouseDown:function(t,e){this.canvas._isMainEvent(e.e)&&(this._prepareForDrawing(t),this._captureDrawingPath(t),this.preparePattern(),this._isErasing=!0,this.canvas.fire("erasing:start"),this._render())},_render:function(){this.inverted||(t=this.canvas.getContext(),this.callSuper("_render",t)),t=this.canvas.contextTop,this.canvas.clearContext(t),this.callSuper("_render",t),t.save();var t,e=1/this.canvas.getRetinaScaling();t.scale(e,e),t.globalCompositeOperation="source-in",t.drawImage(this._patternCanvas,0,0),t.restore()},createPath:function(t){var e=this.callSuper("createPath",t);return e.globalCompositeOperation=this.inverted?"source-over":"destination-out",e.stroke=this.inverted?"white":"black",e},applyClipPathToPath:function(t,e,i){var r=ec.util.invertTransform(t.calcTransformMatrix()),n=e.calcTransformMatrix(),o=e.absolutePositioned?r:ec.util.multiplyTransformMatrices(r,i);return e.absolutePositioned=!1,ec.util.applyTransformToObject(e,ec.util.multiplyTransformMatrices(o,n)),t.clipPath=t.clipPath?ec.util.mergeClipPaths(e,t.clipPath):e,t},clonePathWithClipPath:function(t,e,i){var r=e.calcTransformMatrix(),n=e.clipPath,o=this;t.clone(function(t){n.clone(function(e){i(o.applyClipPathToPath(t,e,r))},["absolutePositioned","inverted"])})},_addPathToObjectEraser:function(t,e){var i=this;if(t.forEachObject&&"deep"===t.erasable){var r=t._objects.filter(function(t){return t.erasable});r.length>0&&t.clipPath?this.clonePathWithClipPath(e,t,function(t){r.forEach(function(e){i._addPathToObjectEraser(e,t)})}):r.length>0&&r.forEach(function(t){i._addPathToObjectEraser(t,e)});return}var n=t.eraser;n||(n=new ec.Eraser,t.eraser=n),e.clone(function(e){var r=ec.util.multiplyTransformMatrices(ec.util.invertTransform(t.calcTransformMatrix()),e.calcTransformMatrix());ec.util.applyTransformToObject(e,r),n.addWithUpdate(e),t.set("dirty",!0),t.fire("erasing:end",{path:e}),t.group&&Array.isArray(i.__subTargets)&&i.__subTargets.push(t)})},applyEraserToCanvas:function(t){var e=this.canvas,i={};return["backgroundImage","overlayImage"].forEach(function(r){var n=e[r];n&&n.erasable&&(this._addPathToObjectEraser(n,t),i[r]=n)},this),i},_finalizeAndAddPath:function(){var t=this.canvas.contextTop,e=this.canvas;t.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate)),e.clearContext(e.contextTop),this._isErasing=!1;var i=this._points&&this._points.length>1?this.convertPointsToSVGPath(this._points):null;if(!i||this._isEmptySVGPath(i)){e.fire("erasing:end"),e.requestRenderAll();return}var r=this.createPath(i);r.setCoords(),e.fire("before:path:created",{path:r});var n=this.applyEraserToCanvas(r),o=this;this.__subTargets=[];var a=[];e.forEachObject(function(t){t.erasable&&t.intersectsWithObject(r,!0,!0)&&(o._addPathToObjectEraser(t,r),a.push(t))}),e.fire("erasing:end",{path:r,targets:a,subTargets:this.__subTargets,drawables:n}),delete this.__subTargets,e.requestRenderAll(),this._resetShadow(),e.fire("path:created",{path:r})}})},6734:function(){},6907:function(){},4866:function(){}},function(t){t.O(0,[774,937,866,609,980,445,617,943,50,888,179],function(){return t(t.s=8312)}),_N_E=t.O()}]);
//# sourceMappingURL=index-1a76b27dafc9b8ab.js.map